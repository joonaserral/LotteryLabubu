<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ä¸ªäººæˆå°± - Labubu å¹¸è¿æŠ½å¥– ğŸ†</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ†</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- VIPå®‰å…¨éªŒè¯ -->
    <script src="auth.js"></script>
    <script src="config.enc.js"></script>
    <!-- ç§»é™¤Google Fontsç¡®ä¿å¾®ä¿¡å…¼å®¹æ€§ -->
    <style>
        body,
        html,
        * {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
        }
    </style>
    <style>
        :root {
            --labu: #6b5b95;
            --labu2: #ffcc00;
        }

        body {
            font-family: 'Zen Maru Gothic', system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans SC', 'PingFang SC', 'Microsoft Yahei', sans-serif;
        }

        .labu-gradient {
            background-image: linear-gradient(135deg, rgba(107, 91, 149, .12), rgba(255, 204, 0, .12));
            position: relative;
            overflow: hidden;
        }

        /* è‡ªå®šä¹‰é¼ æ ‡æ ·å¼å’Œäº¤äº’æ•ˆæœ */
        * {
            cursor: none !important;
        }

        /* æ¢å¤æ–‡æœ¬è¾“å…¥å…ƒç´ çš„å…‰æ ‡ */
        input,
        textarea,
        [contenteditable="true"],
        .text-input {
            cursor: text !important;
        }

        /* æ¢å¤å¯ç‚¹å‡»å…ƒç´ çš„å…‰æ ‡ */
        button,
        a,
        [role="button"],
        .cursor-pointer,
        select {
            cursor: pointer !important;
        }

        .custom-cursor {
            position: fixed;
            width: 20px;
            height: 20px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ff69b4"><path d="M8 2C8 2 8.5 3 10.5 3C12.5 3 13 2 13 2C14 2 15 3 15 4C15 5 14 6 13 6C12 6 11 7 11 8C11 9 12 10 13 10C14 10 15 9 15 8C15 7 16 6 17 6C18 6 19 7 19 8C19 9 18 10 17 10C16 10 15 11 15 12C15 13 16 14 17 14C18 14 19 13 19 12C19 11 20 10 21 10C22 10 23 11 23 12C23 13 22 14 21 14C20 14 19 15 19 16C19 17 18 18 17 18C16 18 15 17 15 16C15 15 14 14 13 14C12 14 11 15 11 16C11 17 10 18 9 18C8 18 7 17 7 16C7 15 8 14 9 14C10 14 11 13 11 12C11 11 10 10 9 10C8 10 7 11 7 12C7 13 6 14 5 14C4 14 3 13 3 12C3 11 4 10 5 10C6 10 7 9 7 8C7 7 6 6 5 6C4 6 3 7 3 8C3 9 2 10 1 10C0 10 -1 9 -1 8C-1 7 0 6 1 6C2 6 3 5 3 4C3 3 4 2 5 2C6 2 7 3 7 4C7 5 8 6 9 6C10 6 11 5 11 4C11 3 10 2 9 2C8.5 2 8 2 8 2Z"/></svg>') no-repeat center;
            background-size: contain;
            pointer-events: none;
            z-index: 9999;
            transition: transform 0.1s ease;
            transform: translate(-50%, -50%);
        }

        .custom-cursor.clicking {
            transform: translate(-50%, -50%) scale(1.2);
        }

        .cursor-trail {
            position: fixed;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, rgba(255, 105, 180, 0.8) 0%, rgba(255, 105, 180, 0) 70%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9998;
            animation: cursorTrailFade 0.5s ease-out forwards;
        }

        @keyframes cursorTrailFade {
            0% {
                opacity: 1;
                transform: scale(1);
            }

            100% {
                opacity: 0;
                transform: scale(0.3);
            }
        }

        .enhanced-btn {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .enhanced-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .enhanced-btn:hover::before {
            left: 100%;
        }

        .enhanced-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(107, 91, 149, 0.3);
        }

        /* å‹‹ç« å¡ç‰‡åŠ¨ç”» */
        .achievement-card {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .achievement-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .achievement-card.unlocked {
            background: linear-gradient(135deg, #fef3c7, #fbbf24);
            border: 2px solid #f59e0b;
        }

        .achievement-card.locked {
            background: linear-gradient(135deg, #f3f4f6, #d1d5db);
            border: 2px solid #9ca3af;
            filter: grayscale(100%);
        }

        .achievement-icon {
            font-size: 3rem;
            transition: all 0.3s ease;
        }

        .achievement-card:hover .achievement-icon {
            transform: scale(1.1) rotate(5deg);
        }

        .achievement-card.locked .achievement-icon {
            opacity: 0.5;
        }

        /* é—ªå…‰æ•ˆæœ */
        .sparkle-effect {
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: sparkle 2s ease-in-out infinite;
        }

        @keyframes sparkle {
            0% {
                left: -100%;
            }

            50% {
                left: 100%;
            }

            100% {
                left: -100%;
            }
        }

        /* ç”¨æˆ·ä¿¡æ¯ç¼–è¾‘ */
        .profile-card {
            background: linear-gradient(135deg, rgba(107, 91, 149, 0.1), rgba(255, 204, 0, 0.1));
            border: 2px solid rgba(107, 91, 149, 0.2);
            border-radius: 1.5rem;
            backdrop-filter: blur(10px);
        }

        .edit-input {
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid rgba(107, 91, 149, 0.3);
            border-radius: 0.75rem;
            padding: 0.75rem;
            transition: all 0.3s ease;
        }

        .edit-input:focus {
            border-color: var(--labu);
            box-shadow: 0 0 0 3px rgba(107, 91, 149, 0.1);
            outline: none;
        }

        /* è¿›åº¦æ¡æ ·å¼ */
        .progress-bar {
            background: linear-gradient(90deg, #6b5b95, #ffcc00);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #34d399);
            border-radius: 4px;
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: progressShine 2s ease-in-out infinite;
        }

        @keyframes progressShine {
            0% {
                transform: translateX(-100%);
            }

            50% {
                transform: translateX(100%);
            }

            100% {
                transform: translateX(-100%);
            }
        }

        /* å¥½å‹ç³»ç»Ÿæ ·å¼ */
        .friend-card {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(107, 91, 149, 0.2);
            border-radius: 1rem;
            transition: all 0.3s ease;
        }

        .friend-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        /* é¡µé¢è¿‡æ¸¡åŠ¨ç”» */
        .page-transition {
            opacity: 0;
            transform: translateY(20px);
            animation: pageEnter 0.6s ease-out forwards;
        }

        @keyframes pageEnter {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .achievement-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            /* ç§»åŠ¨ç«¯å¯¼èˆªä¼˜åŒ– */
            header .max-w-6xl {
                padding: 0 15px;
            }

            header h1 {
                font-size: 16px;
            }

            nav {
                font-size: 12px;
                gap: 8px;
            }

            nav a {
                padding: 8px 4px;
            }

            /* ç§»åŠ¨ç«¯ä¸ªäººä¿¡æ¯å¡ç‰‡ä¼˜åŒ– */
            .profile-card {
                margin: 0 15px;
                border-radius: 16px;
            }

            .profile-card .grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            /* ç§»åŠ¨ç«¯æˆå°±å¡ç‰‡ä¼˜åŒ– */
            .achievement-card {
                padding: 16px;
                border-radius: 12px;
            }

            .achievement-icon {
                font-size: 2.5rem;
            }

            .achievement-card h3 {
                font-size: 16px;
            }

            .achievement-card p {
                font-size: 12px;
            }

            /* ç§»åŠ¨ç«¯å¥½å‹å¡ç‰‡ä¼˜åŒ– */
            .friend-card {
                border-radius: 12px;
                padding: 16px;
            }

            .friend-card .grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            /* ç§»åŠ¨ç«¯è¡¨å•ä¼˜åŒ– */
            .edit-input {
                min-height: 44px;
                font-size: 16px;
                border-radius: 8px;
            }

            .enhanced-btn {
                min-height: 44px;
                font-size: 14px;
            }

            /* ç§»åŠ¨ç«¯æ¨¡æ€æ¡†ä¼˜åŒ– */
            #achievementModal .bg-white {
                margin: 20px;
                border-radius: 16px;
                max-width: calc(100vw - 40px);
            }

            #modalIcon {
                font-size: 48px;
            }

            #modalTitle {
                font-size: 18px;
            }

            #modalDescription {
                font-size: 14px;
            }

            /* ç§»åŠ¨ç«¯å¤´åƒé€‰æ‹©ä¼˜åŒ– */
            .avatar-option {
                min-width: 44px;
                min-height: 44px;
                font-size: 18px;
            }
        }

        /* å°å±å¹•è®¾å¤‡ä¼˜åŒ– */
        @media (max-width: 480px) {
            header h1 {
                font-size: 14px;
            }

            nav {
                font-size: 11px;
                gap: 6px;
            }

            .achievement-icon {
                font-size: 2rem;
            }

            .achievement-card {
                padding: 12px;
            }

            .profile-card {
                margin: 0 10px;
                padding: 16px;
            }

            .enhanced-btn {
                font-size: 13px;
                padding: 12px 16px;
            }
        }

        /* è§¦æ‘¸è®¾å¤‡ä¼˜åŒ– */
        @media (hover: none) {
            .achievement-card:hover {
                transform: none;
            }

            .achievement-card:active {
                transform: scale(0.98);
            }

            .enhanced-btn:hover {
                transform: none;
            }

            .enhanced-btn:active {
                transform: scale(0.98);
            }

            .friend-card:hover {
                transform: none;
            }
        }

        /* é¡µé¢è¿‡æ¸¡åŠ¨ç”» */
        .page-transition-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(107, 91, 149, 0.9), rgba(255, 204, 0, 0.9));
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .page-transition-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .smooth-link {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .smooth-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .smooth-link:hover::before {
            left: 100%;
        }

        .smooth-link:hover {
            transform: translateY(-1px);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-900">
    <!-- é¡µé¢è¿‡æ¸¡åŠ¨ç”»è¦†ç›–å±‚ -->
    <div id="pageTransitionOverlay" class="page-transition-overlay">
        <div class="page-transition-content">
            <div class="transition-loader"></div>
            <h3 class="text-2xl font-bold mb-2">ğŸ† æ­£åœ¨è·³è½¬...</h3>
            <p class="text-lg opacity-90">æ­£åœ¨ä¸ºæ‚¨åŠ è½½æˆå°±ç³»ç»Ÿ</p>
        </div>
    </div>

    <!-- è‡ªå®šä¹‰é¼ æ ‡å…‰æ ‡ -->
    <div class="custom-cursor"></div>

    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <header class="sticky top-0 z-10 backdrop-blur bg-white/60 border-b border-slate-200">
        <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-9 h-9 rounded-xl bg-[var(--labu)] grid place-content-center text-white text-xl">ğŸ†</div>
                <h1 class="font-bold text-lg">ä¸ªäººæˆå°±ä¸­å¿ƒ</h1>
            </div>
            <nav class="flex items-center gap-6">
                <a href="index.html" class="hover:underline flex items-center gap-1 smooth-link page-link">ğŸ¯ è¿”å›æŠ½å¥–</a>
                <a href="shop.html" class="hover:underline flex items-center gap-1 smooth-link page-link">ğŸ›’ å•†åŸ</a>
                <a href="admin.html" class="hover:underline flex items-center gap-1 smooth-link page-link"
                    style="display: none;">âš™ï¸ ç®¡ç†</a>
            </nav>
        </div>
    </header>

    <div class="page-transition">
        <!-- ä¸ªäººä¿¡æ¯å¡ç‰‡ -->
        <section class="labu-gradient py-8">
            <div class="max-w-6xl mx-auto px-4">
                <div class="profile-card p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
                            ğŸ‘¤ ä¸ªäººä¿¡æ¯
                        </h2>
                        <button id="editProfileBtn"
                            class="enhanced-btn px-4 py-2 bg-[var(--labu)] text-white rounded-lg text-sm">
                            âœï¸ ç¼–è¾‘èµ„æ–™
                        </button>
                    </div>

                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <div class="flex items-center gap-4 mb-4">
                                <div
                                    class="w-16 h-16 rounded-full bg-gradient-to-br from-purple-400 to-pink-400 flex items-center justify-center text-2xl">
                                    <span id="userAvatar">ğŸ§¸</span>
                                </div>
                                <div>
                                    <h3 id="displayUserName" class="text-xl font-bold">VIPè‚¡ä¸œ</h3>
                                    <p class="text-sm text-slate-600">ğŸ¯ æŠ½å¥–è¾¾äºº Â· ğŸ† æˆå°±æ”¶é›†è€…</p>
                                </div>
                            </div>

                            <!-- ç¼–è¾‘è¡¨å•ï¼ˆé»˜è®¤éšè—ï¼‰ -->
                            <div id="editForm" class="hidden space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">ç”¨æˆ·å</label>
                                    <input type="text" id="editUserName" class="edit-input w-full"
                                        placeholder="è¯·è¾“å…¥æ‚¨çš„ç”¨æˆ·å">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">ä¸ªæ€§ç­¾å</label>
                                    <input type="text" id="editUserBio" class="edit-input w-full"
                                        placeholder="è¯·è¾“å…¥æ‚¨çš„ä¸ªæ€§ç­¾å">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">å¤´åƒè¡¨æƒ…</label>
                                    <div class="flex gap-2 flex-wrap">
                                        <button
                                            class="avatar-option p-2 bg-white rounded border-2 border-transparent hover:border-[var(--labu)]"
                                            data-avatar="ğŸ§¸">ğŸ§¸</button>
                                        <button
                                            class="avatar-option p-2 bg-white rounded border-2 border-transparent hover:border-[var(--labu)]"
                                            data-avatar="ğŸ®">ğŸ®</button>
                                        <button
                                            class="avatar-option p-2 bg-white rounded border-2 border-transparent hover:border-[var(--labu)]"
                                            data-avatar="ğŸ‘‘">ğŸ‘‘</button>
                                        <button
                                            class="avatar-option p-2 bg-white rounded border-2 border-transparent hover:border-[var(--labu)]"
                                            data-avatar="ğŸŒŸ">ğŸŒŸ</button>
                                        <button
                                            class="avatar-option p-2 bg-white rounded border-2 border-transparent hover:border-[var(--labu)]"
                                            data-avatar="ğŸ’">ğŸ’</button>
                                        <button
                                            class="avatar-option p-2 bg-white rounded border-2 border-transparent hover:border-[var(--labu)]"
                                            data-avatar="ğŸ†">ğŸ†</button>
                                        <button
                                            class="avatar-option p-2 bg-white rounded border-2 border-transparent hover:border-[var(--labu)]"
                                            data-avatar="ğŸ¯">ğŸ¯</button>
                                        <button
                                            class="avatar-option p-2 bg-white rounded border-2 border-transparent hover:border-[var(--labu)]"
                                            data-avatar="ğŸš€">ğŸš€</button>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <button id="saveProfileBtn"
                                        class="enhanced-btn px-4 py-2 bg-green-600 text-white rounded-lg text-sm">
                                        ğŸ’¾ ä¿å­˜
                                    </button>
                                    <button id="cancelEditBtn"
                                        class="enhanced-btn px-4 py-2 bg-gray-500 text-white rounded-lg text-sm">
                                        âŒ å–æ¶ˆ
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-4">
                            <div class="bg-white/50 rounded-lg p-4">
                                <h4 class="font-medium mb-2">ğŸ¯ æŠ½å¥–ç»Ÿè®¡</h4>
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <span class="text-slate-600">æ€»æŠ½å¥–æ¬¡æ•°</span>
                                        <p class="text-lg font-bold text-[var(--labu)]" id="totalDraws">0</p>
                                    </div>
                                    <div>
                                        <span class="text-slate-600">ä¸­å¥–æ¬¡æ•°</span>
                                        <p class="text-lg font-bold text-green-600" id="totalWins">0</p>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white/50 rounded-lg p-4">
                                <h4 class="font-medium mb-2">ğŸ† æˆå°±è¿›åº¦</h4>
                                <div class="space-y-2">
                                    <div class="flex justify-between text-sm">
                                        <span>æˆå°±å®Œæˆåº¦</span>
                                        <span id="achievementProgress">0/12</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- æˆå°±å‹‹ç« åŒºåŸŸ -->
        <section class="py-8">
            <div class="max-w-6xl mx-auto px-4">
                <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
                    ğŸ† æˆ‘çš„æˆå°±å‹‹ç« 
                    <span class="text-sm font-normal text-slate-600">(ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…)</span>
                </h2>

                <div id="achievementsGrid" class="achievement-grid grid md:grid-cols-3 lg:grid-cols-4 gap-6">
                    <!-- æˆå°±å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </section>

        <!-- å¥½å‹äº’åŠ¨æˆå°± -->
        <section class="py-8 bg-white/50">
            <div class="max-w-6xl mx-auto px-4">
                <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
                    ğŸ‘¥ å¥½å‹äº’åŠ¨æˆå°±
                </h2>

                <div class="grid md:grid-cols-2 gap-6">
                    <div class="friend-card p-6">
                        <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
                            ğŸ’ äº²å¯†å¥½å‹é‚€è¯·
                        </h3>
                        <p class="text-sm text-slate-600 mb-4">é‚€è¯·å¥½å‹åŠ å…¥VIPè‚¡ä¸œï¼Œä¸€èµ·åˆ†äº«æŠ½å¥–ä¹è¶£ï¼</p>

                        <div class="space-y-3">
                            <div class="flex justify-between text-sm">
                                <span>å·²é‚€è¯·å¥½å‹</span>
                                <span id="invitedFriends">0 äºº</span>
                            </div>
                            <button id="inviteFriendBtn"
                                class="enhanced-btn w-full py-2 bg-pink-500 text-white rounded-lg text-sm">
                                ğŸ’Œ é‚€è¯·å¥½å‹
                            </button>
                        </div>
                    </div>

                    <div class="friend-card p-6">
                        <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
                            ğŸ ç¤¼ç‰©åˆ†äº«
                        </h3>
                        <p class="text-sm text-slate-600 mb-4">ä¸å¥½å‹åˆ†äº«ä¸­å¥–å–œæ‚¦ï¼Œèµ é€å°ç¤¼å“ï¼</p>

                        <div class="space-y-3">
                            <div class="flex justify-between text-sm">
                                <span>å·²åˆ†äº«ç¤¼ç‰©</span>
                                <span id="sharedGifts">0 æ¬¡</span>
                            </div>
                            <button id="shareGiftBtn"
                                class="enhanced-btn w-full py-2 bg-orange-500 text-white rounded-lg text-sm">
                                ğŸ åˆ†äº«ç¤¼ç‰©
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- æˆå°±è¯¦æƒ…å¼¹çª— -->
    <div id="achievementModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4 transform transition-all">
            <div class="text-center">
                <div id="modalIcon" class="text-6xl mb-4">ğŸ†</div>
                <h3 id="modalTitle" class="text-xl font-bold mb-2">æˆå°±åç§°</h3>
                <p id="modalDescription" class="text-slate-600 mb-4">æˆå°±æè¿°</p>
                <div id="modalReward" class="text-sm text-green-600 mb-4">å¥–åŠ±ï¼š+100ç§¯åˆ†</div>
                <div id="modalProgress" class="mb-4">
                    <div class="progress-bar">
                        <div class="progress-fill" id="modalProgressFill" style="width: 0%"></div>
                    </div>
                    <p class="text-sm text-slate-600 mt-1" id="modalProgressText">è¿›åº¦ï¼š0/10</p>
                </div>
                <button id="closeModalBtn" class="enhanced-btn px-6 py-2 bg-[var(--labu)] text-white rounded-lg">
                    å…³é—­
                </button>
            </div>
        </div>
    </div>

    <script>
        // å®‰å…¨æ£€æŸ¥
        if (!window._secureConfig || !window._secureConfig.validate()) {
            window.location.href = 'index.html';
        }

        // æ£€æŸ¥æ¡æ¬¾åŒæ„çŠ¶æ€
        function checkTermsAgreement() {
            const agreed = localStorage.getItem('terms_agreed');
            if (!agreed) {
                window.location.href = 'welcome.html';
                return false;
            }

            const agreeTime = parseInt(agreed);
            const now = Date.now();
            const dayInMs = 24 * 60 * 60 * 1000;

            // æ¡æ¬¾åŒæ„æœ‰æ•ˆæœŸ7å¤©
            if (now - agreeTime > 7 * dayInMs) {
                localStorage.removeItem('terms_agreed');
                window.location.href = 'welcome.html';
                return false;
            }

            return true;
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æ¡æ¬¾
        if (!checkTermsAgreement()) {
            // å¦‚æœæ¡æ¬¾æ£€æŸ¥å¤±è´¥ï¼Œåœæ­¢åç»­æ‰§è¡Œ
        } else {

            // åŸºç¡€å‡½æ•°
            const $ = (selector) => document.querySelector(selector);
            const $$ = (selector) => document.querySelectorAll(selector);

            // é¡µé¢è¿‡æ¸¡åŠ¨ç”»åŠŸèƒ½
            function initPageTransitions() {
                $$('.page-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const href = link.getAttribute('href');
                        showPageTransition(() => {
                            window.location.href = href;
                        });
                    });
                });
            }

            function showPageTransition(callback) {
                const overlay = $('#pageTransitionOverlay');
                overlay.classList.add('active');

                setTimeout(() => {
                    if (callback) callback();
                }, 800);
            }

            function hidePageTransition() {
                const overlay = $('#pageTransitionOverlay');
                overlay.classList.remove('active');
            }

            // é¡µé¢åŠ è½½æ—¶éšè—è¿‡æ¸¡å±‚
            window.addEventListener('load', () => {
                setTimeout(hidePageTransition, 300);
            });

            // æˆå°±æ•°æ®
            const ACHIEVEMENTS = [
                {
                    id: 'first_draw',
                    name: 'åˆè¯•ç‰›åˆ€',
                    description: 'å®Œæˆç¬¬ä¸€æ¬¡æŠ½å¥–',
                    icon: 'ğŸ¯',
                    reward: 50,
                    condition: { type: 'draws', value: 1 },
                    category: 'basic'
                },
                {
                    id: 'draw_master',
                    name: 'æŠ½å¥–è¾¾äºº',
                    description: 'ç´¯è®¡æŠ½å¥–10æ¬¡',
                    icon: 'ğŸ®',
                    reward: 200,
                    condition: { type: 'draws', value: 10 },
                    category: 'basic'
                },
                {
                    id: 'lucky_star',
                    name: 'å¹¸è¿ä¹‹æ˜Ÿ',
                    description: 'é¦–æ¬¡ä¸­å¥–',
                    icon: 'â­',
                    reward: 100,
                    condition: { type: 'wins', value: 1 },
                    category: 'basic'
                },
                {
                    id: 'legendary_hunter',
                    name: 'ä¼ è¯´çŒäºº',
                    description: 'è·å¾—ä¼ è¯´çº§å¥–å“',
                    icon: 'ğŸ†',
                    reward: 500,
                    condition: { type: 'legendary_wins', value: 1 },
                    category: 'rare'
                },
                {
                    id: 'coin_collector',
                    name: 'è´§å¸æ”¶é›†è€…',
                    description: 'ç´¯è®¡è·å¾—100Uå¸',
                    icon: 'ğŸ’°',
                    reward: 300,
                    condition: { type: 'coins', value: 100 },
                    category: 'basic'
                },
                {
                    id: 'loyal_player',
                    name: 'å¿ å®ç©å®¶',
                    description: 'è¿ç»­7å¤©å‚ä¸æŠ½å¥–',
                    icon: 'ğŸ”¥',
                    reward: 400,
                    condition: { type: 'daily_streak', value: 7 },
                    category: 'rare'
                },
                {
                    id: 'social_butterfly',
                    name: 'ç¤¾äº¤è¾¾äºº',
                    description: 'é‚€è¯·5ä½å¥½å‹',
                    icon: 'ğŸ‘¥',
                    reward: 600,
                    condition: { type: 'friends', value: 5 },
                    category: 'friend'
                },
                {
                    id: 'gift_giver',
                    name: 'ç¤¼ç‰©è¾¾äºº',
                    description: 'åˆ†äº«ç¤¼ç‰©10æ¬¡',
                    icon: 'ğŸ',
                    reward: 350,
                    condition: { type: 'gifts', value: 10 },
                    category: 'friend'
                },
                {
                    id: 'comment_king',
                    name: 'ç•™è¨€ä¹‹ç‹',
                    description: 'å‘è¡¨20æ¡ç•™è¨€',
                    icon: 'ğŸ’¬',
                    reward: 250,
                    condition: { type: 'comments', value: 20 },
                    category: 'social'
                },
                {
                    id: 'perfectionist',
                    name: 'å®Œç¾ä¸»ä¹‰è€…',
                    description: 'æ”¶é›†æ‰€æœ‰ç¨€æœ‰ä»¥ä¸Šå¥–å“',
                    icon: 'ğŸ’',
                    reward: 1000,
                    condition: { type: 'rare_collection', value: 5 },
                    category: 'rare'
                },
                {
                    id: 'vip_supporter',
                    name: 'VIPæ”¯æŒè€…',
                    description: 'ç´¯è®¡ç§¯åˆ†è¾¾åˆ°5000',
                    icon: 'ğŸ‘‘',
                    reward: 800,
                    condition: { type: 'points', value: 5000 },
                    category: 'rare'
                },
                {
                    id: 'ultimate_collector',
                    name: 'ç»ˆææ”¶è—å®¶',
                    description: 'è§£é”æ‰€æœ‰æˆå°±',
                    icon: 'ğŸŒŸ',
                    reward: 2000,
                    condition: { type: 'achievements', value: 11 },
                    category: 'legendary'
                }
            ];

            // ç”¨æˆ·æ•°æ®ç®¡ç†
            class UserManager {
                constructor() {
                    this.userData = this.loadUserData();
                    this.initCustomCursor();
                }

                loadUserData() {
                    const defaultData = {
                        name: 'VIPè‚¡ä¸œ',
                        bio: 'ğŸ¯ æŠ½å¥–è¾¾äºº Â· ğŸ† æˆå°±æ”¶é›†è€…',
                        avatar: 'ğŸ§¸',
                        achievements: {},
                        stats: {
                            totalDraws: 0,
                            totalWins: 0,
                            coins: 0,
                            dailyStreak: 0,
                            friends: 0,
                            gifts: 0,
                            comments: 0,
                            points: 0
                        }
                    };

                    const saved = localStorage.getItem('userData_achievements');
                    return saved ? { ...defaultData, ...JSON.parse(saved) } : defaultData;
                }

                saveUserData() {
                    localStorage.setItem('userData_achievements', JSON.stringify(this.userData));
                    this.broadcastUpdate();
                }

                broadcastUpdate() {
                    if (window.dataSync) {
                        window.dataSync.postMessage({
                            type: 'userData_update',
                            data: this.userData
                        });
                    }
                }

                updateStats() {
                    // ä»æŠ½å¥–å†å²æ›´æ–°ç»Ÿè®¡æ•°æ®
                    const history = JSON.parse(localStorage.getItem('lotteryHistory') || '[]');
                    const wins = history.filter(item => item.prize !== 'å†æ¥å†å‰');

                    this.userData.stats.totalDraws = history.length;
                    this.userData.stats.totalWins = wins.length;

                    // è®¡ç®—è´§å¸æ€»æ•°
                    let totalCoins = 0;
                    wins.forEach(win => {
                        if (win.prize.includes('Uå¸')) {
                            const match = win.prize.match(/(\d+)Uå¸/);
                            if (match) totalCoins += parseInt(match[1]);
                        }
                    });
                    this.userData.stats.coins = totalCoins;

                    // è®¡ç®—ç§¯åˆ†
                    this.userData.stats.points = this.calculatePoints();

                    // æ£€æŸ¥æˆå°±
                    this.checkAchievements();
                    this.saveUserData();
                }

                calculatePoints() {
                    const history = JSON.parse(localStorage.getItem('lotteryHistory') || '[]');
                    let points = 0;

                    history.forEach(item => {
                        if (item.points) {
                            points += item.points;
                        }
                    });

                    // æ·»åŠ æˆå°±å¥–åŠ±ç§¯åˆ†
                    Object.values(this.userData.achievements).forEach(achievement => {
                        if (achievement.unlocked) {
                            const achievementData = ACHIEVEMENTS.find(a => a.id === achievement.id);
                            if (achievementData) points += achievementData.reward;
                        }
                    });

                    return points;
                }

                checkAchievements() {
                    ACHIEVEMENTS.forEach(achievement => {
                        if (!this.userData.achievements[achievement.id]) {
                            this.userData.achievements[achievement.id] = {
                                id: achievement.id,
                                unlocked: false,
                                progress: 0,
                                unlockedAt: null
                            };
                        }

                        const userAchievement = this.userData.achievements[achievement.id];
                        if (userAchievement.unlocked) return;

                        const progress = this.calculateProgress(achievement);
                        userAchievement.progress = progress;

                        if (progress >= achievement.condition.value) {
                            userAchievement.unlocked = true;
                            userAchievement.unlockedAt = new Date().toISOString();
                            this.showAchievementNotification(achievement);
                        }
                    });
                }

                calculateProgress(achievement) {
                    const { type, value } = achievement.condition;
                    const stats = this.userData.stats;

                    switch (type) {
                        case 'draws': return stats.totalDraws;
                        case 'wins': return stats.totalWins;
                        case 'legendary_wins': return this.countLegendaryWins();
                        case 'coins': return stats.coins;
                        case 'daily_streak': return stats.dailyStreak;
                        case 'friends': return stats.friends;
                        case 'gifts': return stats.gifts;
                        case 'comments': return this.countComments();
                        case 'points': return stats.points;
                        case 'rare_collection': return this.countRareCollection();
                        case 'achievements': return Object.values(this.userData.achievements).filter(a => a.unlocked).length;
                        default: return 0;
                    }
                }

                countLegendaryWins() {
                    const history = JSON.parse(localStorage.getItem('lotteryHistory') || '[]');
                    return history.filter(item =>
                        item.rarity === 'legendary' ||
                        item.rarity === 'mythic'
                    ).length;
                }

                countComments() {
                    const comments = JSON.parse(localStorage.getItem('comments') || '[]');
                    return comments.filter(comment => comment.userName === this.userData.name).length;
                }

                countRareCollection() {
                    const history = JSON.parse(localStorage.getItem('lotteryHistory') || '[]');
                    const rareItems = new Set();
                    history.forEach(item => {
                        if (item.rarity === 'rare' || item.rarity === 'epic' ||
                            item.rarity === 'legendary' || item.rarity === 'mythic') {
                            rareItems.add(item.prize);
                        }
                    });
                    return rareItems.size;
                }

                showAchievementNotification(achievement) {
                    // åˆ›å»ºæˆå°±è§£é”é€šçŸ¥
                    const notification = document.createElement('div');
                    notification.className = 'fixed top-20 right-4 bg-gradient-to-r from-yellow-400 to-orange-400 text-white p-4 rounded-lg shadow-lg z-50 transform transition-all duration-500 translate-x-full';
                    notification.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="text-2xl">${achievement.icon}</div>
                        <div>
                            <h4 class="font-bold">ğŸ‰ æˆå°±è§£é”ï¼</h4>
                            <p class="text-sm">${achievement.name}</p>
                            <p class="text-xs opacity-90">+${achievement.reward} ç§¯åˆ†</p>
                        </div>
                    </div>
                `;

                    document.body.appendChild(notification);

                    // åŠ¨ç”»æ•ˆæœ
                    setTimeout(() => {
                        notification.style.transform = 'translateX(0)';
                    }, 100);

                    setTimeout(() => {
                        notification.style.transform = 'translateX(100%)';
                        setTimeout(() => notification.remove(), 500);
                    }, 4000);
                }

                initCustomCursor() {
                    const cursor = $('.custom-cursor');
                    let trails = [];

                    document.addEventListener('mousemove', (e) => {
                        cursor.style.left = e.clientX + 'px';
                        cursor.style.top = e.clientY + 'px';

                        // åˆ›å»ºå…‰è¿¹
                        if (Math.random() > 0.7) {
                            const trail = document.createElement('div');
                            trail.className = 'cursor-trail';
                            trail.style.left = e.clientX + 'px';
                            trail.style.top = e.clientY + 'px';
                            document.body.appendChild(trail);

                            setTimeout(() => trail.remove(), 500);
                        }
                    });

                    document.addEventListener('mousedown', () => {
                        cursor.classList.add('clicking');
                    });

                    document.addEventListener('mouseup', () => {
                        cursor.classList.remove('clicking');
                    });
                }
            }

            // æˆå°±ç•Œé¢ç®¡ç†
            class AchievementUI {
                constructor(userManager) {
                    this.userManager = userManager;
                    this.init();
                }

                init() {
                    this.renderProfile();
                    this.renderAchievements();
                    this.bindEvents();
                    this.userManager.updateStats();
                    initPageTransitions(); // åˆå§‹åŒ–é¡µé¢è¿‡æ¸¡
                }

                renderProfile() {
                    const userData = this.userManager.userData;
                    $('#displayUserName').textContent = userData.name;
                    $('#userAvatar').textContent = userData.avatar;
                    $('#totalDraws').textContent = userData.stats.totalDraws;
                    $('#totalWins').textContent = userData.stats.totalWins;

                    // æ›´æ–°è¿›åº¦
                    const unlockedCount = Object.values(userData.achievements).filter(a => a.unlocked).length;
                    const totalCount = ACHIEVEMENTS.length;
                    const progressPercent = (unlockedCount / totalCount) * 100;

                    $('#achievementProgress').textContent = `${unlockedCount}/${totalCount}`;
                    $('#progressFill').style.width = `${progressPercent}%`;
                }

                renderAchievements() {
                    const grid = $('#achievementsGrid');
                    grid.innerHTML = '';

                    ACHIEVEMENTS.forEach(achievement => {
                        const userAchievement = this.userManager.userData.achievements[achievement.id];
                        const isUnlocked = userAchievement?.unlocked || false;
                        const progress = userAchievement?.progress || 0;
                        const progressPercent = Math.min((progress / achievement.condition.value) * 100, 100);

                        const card = document.createElement('div');
                        card.className = `achievement-card ${isUnlocked ? 'unlocked' : 'locked'} p-6 rounded-xl cursor-pointer`;
                        card.dataset.achievementId = achievement.id;

                        card.innerHTML = `
                        <div class="text-center">
                            <div class="achievement-icon mb-3">${achievement.icon}</div>
                            <h3 class="font-bold text-lg mb-2">${achievement.name}</h3>
                            <p class="text-sm text-slate-600 mb-3">${achievement.description}</p>
                            <div class="text-xs text-green-600 mb-3">å¥–åŠ±ï¼š+${achievement.reward}ç§¯åˆ†</div>
                            
                            ${!isUnlocked ? `
                                <div class="progress-bar mb-2">
                                    <div class="progress-fill" style="width: ${progressPercent}%"></div>
                                </div>
                                <div class="text-xs text-slate-500">
                                    è¿›åº¦ï¼š${progress}/${achievement.condition.value}
                                </div>
                            ` : `
                                <div class="text-xs text-green-600">
                                    âœ… å·²è§£é”
                                </div>
                            `}
                        </div>
                        ${isUnlocked ? '<div class="sparkle-effect"></div>' : ''}
                    `;

                        grid.appendChild(card);
                    });
                }

                bindEvents() {
                    // ç¼–è¾‘èµ„æ–™
                    $('#editProfileBtn').addEventListener('click', () => {
                        $('#editForm').classList.remove('hidden');
                        $('#editUserName').value = this.userManager.userData.name;
                        $('#editUserBio').value = this.userManager.userData.bio;

                        // é€‰ä¸­å½“å‰å¤´åƒ
                        $$('.avatar-option').forEach(btn => {
                            btn.classList.remove('border-[var(--labu)]');
                            if (btn.dataset.avatar === this.userManager.userData.avatar) {
                                btn.classList.add('border-[var(--labu)]');
                            }
                        });
                    });

                    // å¤´åƒé€‰æ‹©
                    $$('.avatar-option').forEach(btn => {
                        btn.addEventListener('click', () => {
                            $$('.avatar-option').forEach(b => b.classList.remove('border-[var(--labu)]'));
                            btn.classList.add('border-[var(--labu)]');
                        });
                    });

                    // ä¿å­˜èµ„æ–™
                    $('#saveProfileBtn').addEventListener('click', () => {
                        const newName = $('#editUserName').value.trim();
                        const newBio = $('#editUserBio').value.trim();
                        const selectedAvatar = $('.avatar-option.border-\\[var\\(--labu\\)\\]')?.dataset.avatar || this.userManager.userData.avatar;

                        if (newName) {
                            this.userManager.userData.name = newName;
                            this.userManager.userData.bio = newBio;
                            this.userManager.userData.avatar = selectedAvatar;
                            this.userManager.saveUserData();
                            this.renderProfile();

                            $('#editForm').classList.add('hidden');
                            this.showNotification('èµ„æ–™ä¿å­˜æˆåŠŸï¼', 'success');
                        }
                    });

                    // å–æ¶ˆç¼–è¾‘
                    $('#cancelEditBtn').addEventListener('click', () => {
                        $('#editForm').classList.add('hidden');
                    });

                    // æˆå°±å¡ç‰‡ç‚¹å‡»
                    $('#achievementsGrid').addEventListener('click', (e) => {
                        const card = e.target.closest('.achievement-card');
                        if (card) {
                            const achievementId = card.dataset.achievementId;
                            this.showAchievementModal(achievementId);
                        }
                    });

                    // å…³é—­æ¨¡æ€æ¡†
                    $('#closeModalBtn').addEventListener('click', () => {
                        $('#achievementModal').classList.add('hidden');
                    });

                    // å¥½å‹äº’åŠ¨
                    $('#inviteFriendBtn').addEventListener('click', () => {
                        this.inviteFriend();
                    });

                    $('#shareGiftBtn').addEventListener('click', () => {
                        this.shareGift();
                    });
                }

                showAchievementModal(achievementId) {
                    const achievement = ACHIEVEMENTS.find(a => a.id === achievementId);
                    const userAchievement = this.userManager.userData.achievements[achievementId];

                    if (!achievement) return;

                    $('#modalIcon').textContent = achievement.icon;
                    $('#modalTitle').textContent = achievement.name;
                    $('#modalDescription').textContent = achievement.description;
                    $('#modalReward').textContent = `å¥–åŠ±ï¼š+${achievement.reward}ç§¯åˆ†`;

                    const progress = userAchievement?.progress || 0;
                    const progressPercent = Math.min((progress / achievement.condition.value) * 100, 100);

                    $('#modalProgressFill').style.width = `${progressPercent}%`;
                    $('#modalProgressText').textContent = `è¿›åº¦ï¼š${progress}/${achievement.condition.value}`;

                    $('#achievementModal').classList.remove('hidden');
                }

                inviteFriend() {
                    this.userManager.userData.stats.friends += 1;
                    this.userManager.saveUserData();
                    this.userManager.updateStats();
                    $('#invitedFriends').textContent = `${this.userManager.userData.stats.friends} äºº`;
                    this.renderAchievements();
                    this.showNotification('å¥½å‹é‚€è¯·å‘é€æˆåŠŸï¼', 'success');
                }

                shareGift() {
                    this.userManager.userData.stats.gifts += 1;
                    this.userManager.saveUserData();
                    this.userManager.updateStats();
                    $('#sharedGifts').textContent = `${this.userManager.userData.stats.gifts} æ¬¡`;
                    this.renderAchievements();
                    this.showNotification('ç¤¼ç‰©åˆ†äº«æˆåŠŸï¼', 'success');
                }

                showNotification(message, type = 'info') {
                    const notification = document.createElement('div');
                    const bgColor = type === 'success' ? 'bg-green-500' : 'bg-blue-500';
                    notification.className = `fixed top-4 right-4 ${bgColor} text-white p-4 rounded-lg shadow-lg z-50 transform transition-all duration-300 translate-x-full`;
                    notification.textContent = message;

                    document.body.appendChild(notification);

                    setTimeout(() => {
                        notification.style.transform = 'translateX(0)';
                    }, 100);

                    setTimeout(() => {
                        notification.style.transform = 'translateX(100%)';
                        setTimeout(() => notification.remove(), 300);
                    }, 3000);
                }
            }

            // åˆå§‹åŒ–åº”ç”¨
            document.addEventListener('DOMContentLoaded', () => {
                if (checkTermsAgreement()) {
                    const userManager = new UserManager();
                    const achievementUI = new AchievementUI(userManager);
                }
            });
        } // å…³é—­æ¡æ¬¾æ£€æŸ¥çš„elseå—
    </script>
</body>

</html>