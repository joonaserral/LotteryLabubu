<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Labubu Âπ∏ËøêÊäΩÂ•ñ üß∏</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üß∏</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- VIPÂÆâÂÖ®È™åËØÅ -->
    <script src="auth.js"></script>
    <script src="config.enc.js"></script>
    <!-- ÁßªÈô§Google Fonts‰ª•ÈÅøÂÖçÂæÆ‰ø°ÁéØÂ¢É‰∏ãÁöÑÂä†ËΩΩÈóÆÈ¢ò -->
    <style>
        /* ‰ΩøÁî®Á≥ªÁªüÂ≠ó‰Ωì‰ª£ÊõøGoogle FontsÔºåÁ°Æ‰øùÂæÆ‰ø°ÂÖºÂÆπÊÄß */
        body,
        html,
        * {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji" !important;
        }
    </style>
    <style>
        :root {
            --labu: #6b5b95;
            --labu2: #ffcc00;
        }

        body {
            font-family: 'Zen Maru Gothic', system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans SC', 'PingFang SC', 'Microsoft Yahei', sans-serif;
        }

        .labu-gradient {
            background-image: linear-gradient(135deg, rgba(107, 91, 149, .12), rgba(255, 204, 0, .12));
            position: relative;
            overflow: hidden;
        }

        .labu-gradient::before {
            content: "üß∏‚ú®üéÄüí´üåü";
            position: absolute;
            top: 10%;
            left: -100%;
            font-size: 2rem;
            opacity: 0.3;
            animation: float-emojis 20s linear infinite;
        }

        .labu-gradient::after {
            content: "üéÅüç≠üé™üé®üéØ";
            position: absolute;
            bottom: 10%;
            right: -100%;
            font-size: 1.5rem;
            opacity: 0.2;
            animation: float-emojis-reverse 25s linear infinite;
        }

        @keyframes float-emojis {
            from {
                left: -100%;
            }

            to {
                left: 100%;
            }
        }

        @keyframes float-emojis-reverse {
            from {
                right: -100%;
            }

            to {
                right: 100%;
            }
        }

        .spin {
            animation: spin 1.5s cubic-bezier(.2, .7, .2, 1) 1;
        }

        .spin-legendary {
            animation: spin-legendary 2s cubic-bezier(.2, .7, .2, 1) 1;
        }

        .spin-rare {
            animation: spin-rare 1.8s cubic-bezier(.2, .7, .2, 1) 1;
        }

        .spin-common {
            animation: spin-common 1.2s cubic-bezier(.2, .7, .2, 1) 1;
        }

        @keyframes spin {
            0% {
                transform: rotate(-6deg) scale(.98);
            }

            25% {
                transform: rotate(3deg) scale(1.01);
            }

            50% {
                transform: rotate(6deg) scale(1.02);
            }

            75% {
                transform: rotate(-3deg) scale(1.01);
            }

            100% {
                transform: rotate(0) scale(1);
            }
        }

        @keyframes spin-legendary {
            0% {
                transform: rotate(-12deg) scale(.95);
                box-shadow: 0 0 0 rgba(255, 215, 0, 0.5);
            }

            25% {
                transform: rotate(8deg) scale(1.05);
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            }

            50% {
                transform: rotate(12deg) scale(1.08);
                box-shadow: 0 0 30px rgba(255, 215, 0, 1);
            }

            75% {
                transform: rotate(-8deg) scale(1.05);
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            }

            100% {
                transform: rotate(0) scale(1);
                box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
            }
        }

        @keyframes spin-rare {
            0% {
                transform: rotate(-10deg) scale(.96);
                box-shadow: 0 0 0 rgba(138, 43, 226, 0.5);
            }

            25% {
                transform: rotate(6deg) scale(1.03);
                box-shadow: 0 0 15px rgba(138, 43, 226, 0.7);
            }

            50% {
                transform: rotate(10deg) scale(1.06);
                box-shadow: 0 0 25px rgba(138, 43, 226, 0.9);
            }

            75% {
                transform: rotate(-6deg) scale(1.03);
                box-shadow: 0 0 15px rgba(138, 43, 226, 0.7);
            }

            100% {
                transform: rotate(0) scale(1);
                box-shadow: 0 0 8px rgba(138, 43, 226, 0.2);
            }
        }

        @keyframes spin-common {
            0% {
                transform: rotate(-4deg) scale(.98);
            }

            50% {
                transform: rotate(4deg) scale(1.02);
            }

            100% {
                transform: rotate(0) scale(1);
            }
        }

        .sparkle {
            animation: sparkle 1s ease-in-out infinite;
        }

        @keyframes sparkle {

            0%,
            100% {
                opacity: 0.3;
                transform: scale(1);
            }

            50% {
                opacity: 1;
                transform: scale(1.1);
            }
        }

        .bounce-in {
            animation: bounce-in 0.6s ease-out;
        }

        @keyframes bounce-in {
            0% {
                transform: scale(0.3);
                opacity: 0;
            }

            50% {
                transform: scale(1.05);
                opacity: 0.8;
            }

            70% {
                transform: scale(0.9);
                opacity: 0.9;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .floating {
            animation: floating 3s ease-in-out infinite;
        }

        @keyframes floating {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        /* Èü≥‰πêÊí≠ÊîæÂô®Ê†∑Âºè */
        .music-player {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
        }

        .music-player:hover {
            background: rgba(255, 255, 255, 0.95);
            transform: translateY(-2px);
        }

        .music-progress {
            background: linear-gradient(90deg, var(--labu) 0%, var(--labu2) 100%);
        }

        .volume-slider {
            background: linear-gradient(90deg, #ddd 0%, var(--labu) 100%);
        }

        /* ÁïôË®ÄÁ≥ªÁªüÊ†∑Âºè */
        .comment-bubble {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 250, 252, 0.9));
            backdrop-filter: blur(5px);
            transform: translateY(10px);
            opacity: 0;
            animation: slideIn 0.3s ease-out forwards;
        }

        @keyframes slideIn {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .comment-reply {
            border-left: 3px solid var(--labu);
            background: rgba(107, 91, 149, 0.05);
        }

        /* Ëá™ÂÆö‰πâÈº†Ê†áÊ†∑Âºè */
        * {
            cursor: none !important;
        }

        .custom-cursor {
            position: fixed;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #ff69b4 30%, transparent 70%);
            border: 2px solid #ff69b4;
            border-radius: 50%;
            pointer-events: none;
            z-index: 99999 !important;
            transition: transform 0.1s ease;
            transform: translate(-50%, -50%);
            opacity: 1 !important;
            display: block !important;
            visibility: visible !important;
            box-shadow: 0 0 10px rgba(255, 105, 180, 0.5), 0 0 20px rgba(255, 105, 180, 0.3);
        }

        .custom-cursor.clicking {
            transform: translate(-50%, -50%) scale(1.2);
        }

        .cursor-trail {
            position: fixed;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, rgba(255, 105, 180, 0.8) 0%, rgba(255, 105, 180, 0) 70%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9998;
            animation: cursorTrailFade 0.5s ease-out forwards;
        }

        @keyframes cursorTrailFade {
            0% {
                opacity: 1;
                transform: scale(1);
            }

            100% {
                opacity: 0;
                transform: scale(0.3);
            }
        }

        /* ‰æßËæπ‰∫íÂä®Âå∫Âüü */
        .side-interactive {
            position: fixed;
            top: 0;
            width: 100px;
            height: 100vh;
            z-index: 1;
            pointer-events: none;
        }

        .side-interactive.left {
            left: 0;
            background: linear-gradient(90deg, rgba(107, 91, 149, 0.03) 0%, transparent 100%);
        }

        .side-interactive.right {
            right: 0;
            background: linear-gradient(270deg, rgba(255, 204, 0, 0.03) 0%, transparent 100%);
        }

        .side-particle {
            position: absolute;
            width: 20px;
            height: 20px;
            font-size: 16px;
            opacity: 0;
            pointer-events: none;
            animation: sideParticleFloat 3s ease-out forwards;
        }

        @keyframes sideParticleFloat {
            0% {
                opacity: 0;
                transform: translateY(20px) scale(0.5);
            }

            20% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }

            100% {
                opacity: 0;
                transform: translateY(-100px) scale(0.8) rotate(180deg);
            }
        }

        /* ÊåâÈíÆÂ¢ûÂº∫ÊïàÊûú */
        .enhanced-btn {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .enhanced-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .enhanced-btn:hover::before {
            left: 100%;
        }

        .enhanced-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(107, 91, 149, 0.3);
        }

        .enhanced-btn:active {
            transform: translateY(0);
        }

        .btn-ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.6);
            transform: scale(0);
            animation: rippleEffect 0.6s linear;
            pointer-events: none;
        }

        @keyframes rippleEffect {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        /* ÊªöÂä®ËßíËâ≤Âä®Áîª */
        .scroll-character {
            position: fixed;
            font-size: 48px;
            z-index: 10;
            pointer-events: none;
            opacity: 0;
            animation: characterFloat 4s ease-out forwards;
        }

        @keyframes characterFloat {
            0% {
                opacity: 0;
                transform: translateX(-100px) rotate(-10deg);
            }

            20% {
                opacity: 1;
                transform: translateX(0) rotate(0deg);
            }

            80% {
                opacity: 1;
                transform: translateX(20px) rotate(5deg);
            }

            100% {
                opacity: 0;
                transform: translateX(100px) rotate(10deg);
            }
        }

        /* È≠îÊ≥ïÁ≤íÂ≠êÊïàÊûú */
        .magic-particle {
            position: fixed;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, #ffd700 0%, #ff69b4 50%, transparent 100%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9997;
            animation: magicParticle 2s ease-out forwards;
        }

        @keyframes magicParticle {
            0% {
                opacity: 1;
                transform: scale(0) rotate(0deg);
            }

            50% {
                opacity: 1;
                transform: scale(1) rotate(180deg);
            }

            100% {
                opacity: 0;
                transform: scale(0.2) rotate(360deg) translateY(-50px);
            }
        }

        /* È°µÈù¢‰ºòÂåñÊ†∑Âºè */
        .content-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .compact-section {
            padding: 60px 0;
        }

        .hero-compact {
            padding: 80px 0;
        }

        /* ÂìçÂ∫îÂºèÈó¥Ë∑ù‰ºòÂåñ */
        @media (max-width: 768px) {
            .compact-section {
                padding: 30px 0;
            }

            .hero-compact {
                padding: 40px 0;
            }

            /* ÁßªÂä®Á´ØÂØºËà™‰ºòÂåñ */
            header .max-w-5xl {
                padding: 0 15px;
            }

            header h1 {
                font-size: 16px;
            }

            nav {
                font-size: 12px;
                gap: 8px;
            }

            nav a {
                padding: 8px 4px;
            }

            /* ÁßªÂä®Á´ØËã±ÈõÑÂå∫‰ºòÂåñ */
            .content-container {
                padding: 0 15px;
            }

            .hero-compact h2 {
                font-size: 24px;
                line-height: 1.3;
            }

            .hero-compact p {
                font-size: 14px;
                line-height: 1.5;
            }

            /* ÁßªÂä®Á´ØÈü≥‰πêÊí≠ÊîæÂô®‰ºòÂåñ */
            #musicPlayer {
                bottom: 10px;
                right: 10px;
                width: 280px;
                font-size: 14px;
            }

            .music-player {
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            }

            /* ÁßªÂä®Á´ØÊåâÈíÆ‰ºòÂåñ */
            .enhanced-btn {
                min-height: 44px;
                /* iOSÊé®ËçêËß¶Êë∏ÁõÆÊ†áÂ§ßÂ∞è */
                font-size: 14px;
            }

            /* ÁßªÂä®Á´ØË°®Âçï‰ºòÂåñ */
            input,
            textarea,
            select {
                min-height: 44px;
                font-size: 16px;
                /* Èò≤Ê≠¢iOSÁº©Êîæ */
            }

            /* ÁßªÂä®Á´ØÂç°Áâá‰ºòÂåñ */
            .rounded-3xl {
                border-radius: 16px;
            }

            /* ÁßªÂä®Á´ØÈó¥Ë∑ùË∞ÉÊï¥ */
            .gap-8 {
                gap: 20px;
            }

            .gap-6 {
                gap: 15px;
            }

            .gap-4 {
                gap: 10px;
            }

            /* ÁßªÂä®Á´ØÊñáÂ≠óÂ§ßÂ∞èË∞ÉÊï¥ */
            .text-3xl {
                font-size: 20px;
            }

            .text-2xl {
                font-size: 18px;
            }

            .text-xl {
                font-size: 16px;
            }

            /* ÁßªÂä®Á´ØÂõæÊ†áË∞ÉÊï¥ */
            .text-7xl {
                font-size: 48px;
            }

            .text-8xl {
                font-size: 56px;
            }
        }

        /* Â∞èÂ±èÂπïËÆæÂ§á‰ºòÂåñ */
        @media (max-width: 480px) {
            header h1 {
                font-size: 14px;
            }

            nav {
                font-size: 11px;
                gap: 6px;
            }

            .hero-compact h2 {
                font-size: 20px;
            }

            #musicPlayer {
                width: 250px;
                bottom: 5px;
                right: 5px;
            }

            .enhanced-btn {
                font-size: 13px;
                padding: 12px 16px;
            }
        }

        /* È°µÈù¢ËøáÊ∏°Âä®Áîª */
        .page-transition-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(107, 91, 149, 0.9), rgba(255, 204, 0, 0.9));
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .page-transition-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .page-transition-content {
            text-align: center;
            color: white;
            transform: translateY(20px);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .page-transition-overlay.active .page-transition-content {
            transform: translateY(0);
        }

        .transition-loader {
            width: 60px;
            height: 60px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .smooth-link {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .smooth-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .smooth-link:hover::before {
            left: 100%;
        }

        .smooth-link:hover {
            transform: translateY(-1px);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-900">
    <!-- È°µÈù¢ËøáÊ∏°Âä®ÁîªË¶ÜÁõñÂ±Ç -->
    <div id="pageTransitionOverlay" class="page-transition-overlay">
        <div class="page-transition-content">
            <div class="transition-loader"></div>
            <h3 class="text-2xl font-bold mb-2">üß∏ Ê≠£Âú®Ë∑≥ËΩ¨...</h3>
            <p class="text-lg opacity-90">ËØ∑Á®çÂÄôÔºåÂç≥Â∞Ü‰∏∫ÊÇ®Âä†ËΩΩÁ≤æÂΩ©ÂÜÖÂÆπ</p>
        </div>
    </div>

    <!-- Ëá™ÂÆö‰πâÈº†Ê†áÂÖâÊ†á -->
    <div class="custom-cursor"></div>

    <!-- ‰æßËæπ‰∫íÂä®Âå∫Âüü -->
    <div class="side-interactive left"></div>
    <div class="side-interactive right"></div>

    <!-- È°∂ÈÉ®Ê†è -->
    <header class="sticky top-0 z-10 backdrop-blur bg-white/60 border-b border-slate-200">
        <div class="max-w-5xl mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-9 h-9 rounded-xl bg-[var(--labu)] grid place-content-center text-white text-xl sparkle">üß∏
                </div>
                <h1 class="font-bold text-lg">Labubu_Âü∫Èáë‰ºö ¬∑ VIPËÇ°‰∏ú‰∏ì‰∫´Á¶èÂà©</h1>
                <div class="hidden sm:flex gap-1">
                    <span class="floating">‚ú®</span>
                    <span class="floating" style="animation-delay: 0.2s;">üéÄ</span>
                    <span class="floating" style="animation-delay: 0.4s;">üí´</span>
                </div>
            </div>
            <nav class="text-sm flex items-center gap-4">
                <a href="#draw" class="hover:underline flex items-center gap-1 smooth-link">üéØ ‰∏ì‰∫´ÊäΩÂ•ñ</a>
                <a href="#history" class="hover:underline flex items-center gap-1 smooth-link">üìä ‰∏≠Â•ñËÆ∞ÂΩï</a>
                <a href="#exchange" class="hover:underline flex items-center gap-1 smooth-link">üîÑ ÁßØÂàÜÂÖëÊç¢</a>
                <a href="games.html" class="hover:underline flex items-center gap-1 smooth-link page-link">üéÆ Ê∏∏Êàè‰∏≠ÂøÉ</a>
                <a href="achievements.html" class="hover:underline flex items-center gap-1 smooth-link page-link">üèÜ
                    ‰∏™‰∫∫ÊàêÂ∞±</a>
                <a href="#comments" class="hover:underline flex items-center gap-1 smooth-link">üí¨ ËÇ°‰∏ú‰∫§ÊµÅ</a>
            </nav>
        </div>
    </header>

    <!-- Hero -->
    <section class="labu-gradient hero-compact">
        <div class="content-container px-4 grid md:grid-cols-2 gap-8 items-center">
            <div>
                <h2 class="text-3xl md:text-4xl font-extrabold leading-tight">
                    VIPËÇ°‰∏ú‰∏ì‰∫´Á¶èÂà©ÊäΩÂ•ñ
                    <span class="sparkle">üíé</span>
                </h2>
                <p class="mt-3 text-slate-700">
                    üåü <strong>ËÇ°‰∏ú‰∏ìÂ±ûÊùÉÁõä</strong>ÔºöÈ´òÁ∫ßÂ•ñÂìÅÊ±†Ôºå‰∏≠Â•ñÁéáÁøªÂÄç <br />
                    üí∞ <strong>Ë¥ßÂ∏ÅÂ•ñÂä±</strong>Ôºö1UÂ∏Å„ÄÅ3UÂ∏Å„ÄÅ5UÂ∏ÅÔºåÁõ¥Êé•Âà∞Ë¥¶ <br />
                    üéÅ <strong>ÂÆûÁâ©Á¶èÂà©</strong>ÔºöÈôêÈáèLabubu„ÄÅÂ•∂Ëå∂Âà∏„ÄÅÁÉ§ËÇâÂà∏Á≠â <br />
                    ‚ú® <strong>VIPÁâπÊùÉ</strong>ÔºöÊØèÊó•È¢ùÂ§ñÊäΩÂ•ñÊú∫‰ºöÔºå‰∏ì‰∫´ÂÆ¢ÊúçÊîØÊåÅ
                </p>
                <div class="mt-5 flex flex-wrap gap-3">
                    <a href="#draw"
                        class="enhanced-btn px-6 py-3 rounded-xl bg-[var(--labu)] text-white font-medium shadow flex items-center gap-2">
                        üíé VIP‰∏ì‰∫´ÊäΩÂ•ñ
                    </a>
                    <button id="exportCsvBtn"
                        class="enhanced-btn px-6 py-3 rounded-xl bg-gradient-to-r from-yellow-600 to-yellow-500 text-white font-medium shadow flex items-center gap-2">
                        üìä ÂØºÂá∫‰∏≠Â•ñËÆ∞ÂΩï
                    </button>
                </div>
                <div class="mt-4 text-sm text-slate-600">
                    <div class="flex flex-wrap gap-3">
                        <span class="flex items-center gap-1 px-3 py-1 bg-yellow-100 rounded-full">üîÆ Á•ûËØùÁ∫ß</span>
                        <span class="flex items-center gap-1 px-3 py-1 bg-red-100 rounded-full">üèÜ ‰º†ËØ¥Á∫ß</span>
                        <span class="flex items-center gap-1 px-3 py-1 bg-purple-100 rounded-full">üåü Âè≤ËØóÁ∫ß</span>
                        <span class="flex items-center gap-1 px-3 py-1 bg-blue-100 rounded-full">üíé Á®ÄÊúâÁ∫ß</span>
                        <span class="flex items-center gap-1 px-3 py-1 bg-gray-100 rounded-full">üéÄ ÊôÆÈÄöÁ∫ß</span>
                    </div>
                </div>
            </div>
            <div class="relative">
                <div
                    class="aspect-square rounded-3xl bg-white shadow-lg p-6 border border-slate-200 overflow-hidden relative">
                    <div class="h-full w-full grid place-content-center relative z-10">
                        <div class="text-7xl md:text-8xl select-none bounce-in">üß∏</div>
                        <div class="text-center mt-4 text-sm text-slate-600 flex items-center justify-center gap-2">
                            <span>Labubu ‰∏ªÈ¢òÊäΩÂ•ñ</span>
                            <span class="sparkle">‚ú®</span>
                        </div>
                    </div>
                    <!-- Ë£ÖÈ•∞ÂÖÉÁ¥† -->
                    <div class="absolute top-4 left-4 text-2xl opacity-60 floating">üéÄ</div>
                    <div class="absolute top-4 right-4 text-2xl opacity-60 floating" style="animation-delay: 0.5s;">üí´
                    </div>
                    <div class="absolute bottom-4 left-4 text-2xl opacity-60 floating" style="animation-delay: 1s;">üåü
                    </div>
                    <div class="absolute bottom-4 right-4 text-2xl opacity-60 floating" style="animation-delay: 1.5s;">
                        üéÅ</div>
                    <div class="absolute top-1/2 left-4 text-xl opacity-40 floating" style="animation-delay: 0.8s;">üé®
                    </div>
                    <div class="absolute top-1/2 right-4 text-xl opacity-40 floating" style="animation-delay: 1.2s;">üé™
                    </div>
                </div>
                <div class="absolute -z-10 inset-0 blur-3xl opacity-30"
                    style="background: radial-gradient(600px 200px at 20% 30%, var(--labu), transparent), radial-gradient(500px 200px at 80% 70%, var(--labu2), transparent);">
                </div>
                <!-- Âë®Âõ¥Ë£ÖÈ•∞ -->
                <div class="absolute -top-8 -left-8 text-4xl opacity-20 floating">üß∏</div>
                <div class="absolute -top-8 -right-8 text-3xl opacity-25 floating" style="animation-delay: 0.3s;">üéà
                </div>
                <div class="absolute -bottom-8 -left-8 text-3xl opacity-20 floating" style="animation-delay: 0.7s;">üç≠
                </div>
                <div class="absolute -bottom-8 -right-8 text-4xl opacity-25 floating" style="animation-delay: 1.1s;">üéØ
                </div>
            </div>
        </div>
    </section>

    <!-- ÊäΩÂ•ñÂç°Áâá -->
    <main id="draw" class="content-container px-4 compact-section">
        <div class="grid md:grid-cols-5 gap-6 items-start">
            <section class="md:col-span-3">
                <div class="rounded-3xl bg-white border border-slate-200 shadow">
                    <div class="p-5 border-b border-slate-100 flex items-center justify-between">
                        <h3 class="font-semibold">ÊäΩÂ•ñÈù¢Êùø</h3>
                        <div class="text-xs text-slate-500">
                            <div>Êú¨Âú∞Êó∂Èó¥Ôºö<span id="now"></span></div>
                            <div id="drawLimitInfo" class="mt-1">Ââ©‰ΩôÊäΩÂ•ñÊ¨°Êï∞Ôºö<span id="remainingDraws">‚Äî</span></div>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="grid gap-4">
                            <div class="rounded-2xl border border-dashed border-slate-300 p-6 text-center">
                                <div class="text-sm text-slate-600">
                                    <span id="drawModeIndicator">ÁÇπÂáªÊåâÈíÆÂºÄÂßãÊäΩÂ•ñ</span>
                                </div>
                                <div id="resultDisplay" class="text-3xl font-extrabold mt-2">‚Äî</div>
                                <div id="resultMeta" class="text-xs text-slate-500 mt-1">‚Äî</div>
                                <div id="trialNotice" class="text-xs text-orange-600 mt-2 hidden">
                                    üéØ ËøôÊòØËØïÊäΩÁªìÊûúÔºå‰∏ç‰ºöÊ∂àËÄóÂ∫ìÂ≠òÊàñËÆ°ÂÖ•ËÆ∞ÂΩï
                                </div>
                            </div>
                            <div class="flex gap-3 flex-wrap">
                                <button id="drawBtn"
                                    class="enhanced-btn px-5 py-3 rounded-2xl bg-[var(--labu)] text-white font-semibold shadow">Ê≠£ÂºèÊäΩÂ•ñ</button>
                                <button id="trialDrawBtn"
                                    class="enhanced-btn px-5 py-3 rounded-2xl bg-slate-100 text-slate-800 font-medium border border-slate-200">ËØïÊäΩ‰ΩìÈ™å</button>
                            </div>
                            <div class="text-xs text-slate-500">
                                <div>ËØ¥ÊòéÔºöÊ≠£ÂºèÊäΩÂ•ñ‰ºöÊ†πÊçÆÂ•ñÊ±†ÊùÉÈáç‰∏éÂ∫ìÂ≠òËøõË°åÔºåÂÆû‰ΩìÁ§ºÂìÅ‰ºöÊâ£ÂáèÂ∫ìÂ≠òÔºõÂà∏Á†Å‰ºöËá™Âä®ÁîüÊàêÂπ∂ÊòæÁ§∫„ÄÇ</div>
                                <div class="mt-1">ËØïÊäΩ‰ΩìÈ™åÔºö‰ªÖ‰æõ‰ΩìÈ™åÊ¶ÇÁéáÂàÜÂ∏ÉÔºå‰∏çÊ∂àËÄóÂ∫ìÂ≠ò„ÄÅ‰∏çËÆ°ÂÖ•ËÆ∞ÂΩï„ÄÅ‰∏çÂΩ±ÂìçÊäΩÂ•ñÊ¨°Êï∞„ÄÇ</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Â•ñÊ±†Ê¶ÇËßà -->
            <aside class="md:col-span-2">
                <div class="rounded-3xl bg-white border border-slate-200 shadow overflow-hidden">
                    <div class="p-5 border-b border-slate-100 flex items-center justify-between">
                        <h3 class="font-semibold">ÂΩìÂâçÂ•ñÊ±†</h3>
                    </div>
                    <div class="p-5">
                        <ul id="poolList" class="text-sm grid gap-2"></ul>
                    </div>
                </div>
            </aside>
        </div>

        <!-- ÂéÜÂè≤ËÆ∞ÂΩï -->
        <section id="history" class="mt-10">
            <div class="rounded-3xl bg-white border border-slate-200 shadow overflow-hidden">
                <div class="p-5 border-b border-slate-100 flex items-center justify-between">
                    <h3 class="font-semibold">ÊäΩÂ•ñÁªìÊûúÔºàËá™Âä®Ê†áËÆ∞Êó∂Èó¥Ôºâ</h3>
                    <div class="flex gap-2">
                        <button id="exportJsonBtn"
                            class="text-xs px-2 py-1 rounded-lg bg-slate-100 border border-slate-200">ÂØºÂá∫ JSON</button>
                    </div>
                </div>
                <div class="p-5 overflow-x-auto">
                    <table class="min-w-full text-sm">
                        <thead class="text-left text-slate-500">
                            <tr>
                                <th class="py-2 pr-4">Êó∂Èó¥</th>
                                <th class="py-2 pr-4">Â•ñÂìÅ</th>
                                <th class="py-2 pr-4">Á±ªÂûã</th>
                                <th class="py-2 pr-4">Âà∏Á†Å/Â§áÊ≥®</th>
                            </tr>
                        </thead>
                        <tbody id="historyBody" class="align-top"></tbody>
                    </table>
                </div>
            </div>
        </section>


    </main>

    <!-- ÁßØÂàÜÂÖëÊç¢Á≥ªÁªü -->
    <section id="exchange" class="content-container px-4 compact-section">
        <div class="rounded-3xl bg-white border border-slate-200 shadow overflow-hidden">
            <div class="p-5 border-b border-slate-100">
                <h3 class="font-semibold flex items-center gap-2 mb-2">
                    üîÑ VIPÁßØÂàÜÂÖëÊç¢‰∏≠ÂøÉ
                    <span class="text-xs text-slate-500">ÔºàÂ§öÂè™LabubuÂÖëÊç¢Á•ûËØùÂ§ßÂ•ñÔºâ</span>
                </h3>
                <div class="flex items-center justify-between text-sm">
                    <div class="flex items-center gap-4">
                        <span class="text-slate-600">ÂΩìÂâçÁßØÂàÜ: <span id="userPoints"
                                class="font-bold text-[var(--labu)]">0</span></span>
                        <span class="text-slate-600">ÂèØÂÖëÊç¢: <span id="exchangeableItems"
                                class="font-bold text-green-600">0</span> ‰ª∂</span>
                    </div>
                    <button id="calculatePointsBtn"
                        class="enhanced-btn px-4 py-2 bg-[var(--labu)] text-white rounded-lg text-sm">
                        üìä ËÆ°ÁÆóÊåÅÊúâÁßØÂàÜ
                    </button>
                </div>
            </div>

            <div class="p-5">
                <!-- ÂÖëÊç¢ÂïÜÂìÅÂ±ïÁ§∫ -->
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6" id="exchangeItems">
                    <!-- ÂÖëÊç¢ÂïÜÂìÅÂ∞ÜÈÄöËøáJavaScriptÁîüÊàê -->
                </div>

                <!-- ÊàëÁöÑÊî∂Ëóè -->
                <div class="border-t pt-5">
                    <h4 class="font-medium mb-3 flex items-center gap-2">
                        üß∏ ÊàëÁöÑLabubuÊî∂Ëóè
                        <span class="text-xs text-slate-500">ÔºàÂèØÁî®‰∫éÂÖëÊç¢ÁßØÂàÜÔºâ</span>
                    </h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3" id="myCollection">
                        <!-- Êî∂ËóèÂ∞ÜÈÄöËøáJavaScriptÁîüÊàê -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ÁïôË®ÄÁ≥ªÁªü -->
    <section id="comments" class="content-container px-4 compact-section">
        <div class="rounded-3xl bg-white border border-slate-200 shadow overflow-hidden">
            <div class="p-5 border-b border-slate-100 flex items-center justify-between">
                <h3 class="font-semibold flex items-center gap-2">
                    üí¨ ÁïôË®ÄÊùø
                    <span class="text-xs text-slate-500">ÔºàÂ§öÁî®Êà∑ÂÆûÊó∂ÂÖ±‰∫´Ôºâ</span>
                </h3>
                <div class="text-xs text-slate-500">ÂÆûÊó∂ÂêåÊ≠•‰∏≠ <span class="sparkle">‚ú®</span></div>
            </div>
            <div class="p-5">
                <!-- ÂèëË°®ÁïôË®Ä -->
                <div class="mb-6">
                    <div class="flex gap-3 mb-3">
                        <input type="text" id="userName" placeholder="ÊÇ®ÁöÑÊòµÁß∞"
                            class="px-3 py-2 rounded-lg border border-slate-300 text-sm focus:border-[var(--labu)] focus:outline-none">
                        <div class="flex-1"></div>
                    </div>
                    <textarea id="commentInput" rows="3" placeholder="ËØ¥ÁÇπ‰ªÄ‰πàÂêß... üéØ"
                        class="w-full px-3 py-2 rounded-lg border border-slate-300 text-sm focus:border-[var(--labu)] focus:outline-none resize-none"></textarea>
                    <div class="flex justify-between items-center mt-3">
                        <div class="text-xs text-slate-500">
                            <span id="commentCount">0</span> Êù°ÁïôË®Ä
                        </div>
                        <button id="submitComment"
                            class="enhanced-btn px-4 py-2 rounded-lg bg-[var(--labu)] text-white text-sm font-medium">
                            üí¨ ÂèëË°®ÁïôË®Ä
                        </button>
                    </div>
                </div>

                <!-- ÁïôË®ÄÂàóË°® -->
                <div id="commentsList" class="space-y-4">
                    <div class="text-center text-slate-400 py-8">
                        <div class="text-4xl mb-2">üí≠</div>
                        <div>ÊöÇÊó†ÁïôË®ÄÔºåÂø´Êù•ËØ¥ÁÇπ‰ªÄ‰πàÂêßÔºÅ</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Èü≥‰πêÊí≠ÊîæÂô® -->
    <div id="musicPlayer" class="fixed bottom-6 right-6 z-40 music-player transition-all duration-300 ease-in-out">
        <!-- Â∞èÊåâÈíÆÁä∂ÊÄÅÔºàÈªòËÆ§ÊòæÁ§∫Ôºâ -->
        <div id="musicPlayerMini"
            class="w-14 h-14 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full shadow-lg cursor-pointer flex items-center justify-center hover:scale-110 transition-transform duration-200">
            <div class="text-white text-xl animate-pulse" id="miniMusicIcon">üéµ</div>
        </div>

        <!-- ÂÆåÊï¥Êí≠ÊîæÂô®ÔºàÈªòËÆ§ÈöêËóèÔºâ -->
        <div id="musicPlayerFull"
            class="hidden w-80 bg-white/95 backdrop-blur-md rounded-2xl shadow-xl border border-white/20 p-4">
            <!-- Ê†áÈ¢òÊ†è -->
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-2">
                    <span class="text-lg">üéµ</span>
                    <span class="font-medium text-sm">Èü≥‰πêÊí≠ÊîæÂô®</span>
                </div>
                <button id="closePlayer" class="text-slate-400 hover:text-slate-600 text-xl">‚úï</button>
            </div>

            <!-- ÂΩìÂâçÊí≠Êîæ‰ø°ÊÅØ -->
            <div class="text-center mb-4">
                <div id="currentSong" class="font-medium text-sm text-slate-800 truncate">ÂáÜÂ§áÊí≠ÊîæÈü≥‰πê</div>
                <div id="currentArtist" class="text-xs text-slate-500 truncate">ÈÄâÊã©‰∏ÄÈ¶ñÊ≠åÂºÄÂßãÊí≠Êîæ</div>
            </div>

            <!-- ËøõÂ∫¶Êù° -->
            <div class="space-y-2 mb-4">
                <div class="flex justify-between text-xs text-slate-500">
                    <span id="currentTime">0:00</span>
                    <span id="totalTime">0:00</span>
                </div>
                <div class="w-full bg-slate-200 rounded-full h-1.5 cursor-pointer" id="progressContainer">
                    <div id="progressBar" class="music-progress h-1.5 rounded-full w-0 transition-all"></div>
                </div>
            </div>

            <!-- ÊéßÂà∂ÊåâÈíÆ -->
            <div class="flex items-center justify-center gap-6 mb-4">
                <button id="prevBtn" class="text-2xl hover:scale-110 transition-transform duration-200">‚èÆÔ∏è</button>
                <button id="playPauseBtn"
                    class="text-2xl hover:scale-110 transition-transform duration-200 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-full w-12 h-12 flex items-center justify-center shadow-lg">‚ñ∂Ô∏è</button>
                <button id="nextBtn" class="text-2xl hover:scale-110 transition-transform duration-200">‚è≠Ô∏è</button>
            </div>

            <!-- Èü≥ÈáèÊéßÂà∂ -->
            <div class="flex items-center gap-3 mb-4">
                <span class="text-sm">üîä</span>
                <input type="range" id="volumeSlider" min="0" max="100" value="50"
                    class="flex-1 h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
            </div>

            <!-- Êí≠ÊîæÂàóË°® -->
            <div class="max-h-32 overflow-y-auto">
                <div class="text-xs text-slate-500 mb-2 font-medium">Êí≠ÊîæÂàóË°®</div>
                <div id="playlist" class="space-y-1"></div>
            </div>
        </div>
    </div>

    <footer class="max-w-5xl mx-auto px-4 py-10 text-center text-xs text-slate-500">
        <div>¬© <span id="year"></span> LabubuÂü∫Èáë‰ºöÊäΩÂ•ñÔºàÊúÄÁªàËß£ÈáäÊùÉÂΩíÊú¨Âü∫Èáë‰ºöÊâÄÊúâÔºâ</div>
        <div class="mt-2">
            <a href="admin.html" class="text-slate-400 hover:text-slate-600 hover:underline transition-colors">Á≥ªÁªüÁÆ°ÁêÜ</a>
        </div>
    </footer>

    <script>
        // ‚Äî‚Äî Êú¨Âú∞Â≠òÂÇ®ÈîÆ ‚Äî‚Äî
        const LS_KEYS = {
            HISTORY: 'labubu_lottery_history',
            POOL: 'labubu_lottery_pool',
            DRAW_LIMIT: 'labubu_draw_limit',
            USER_DRAW_COUNT: 'labubu_user_draw_count'
        };

        // ‚Äî‚Äî Êï∞ÊçÆÂêåÊ≠•ÈÄöÈÅì ‚Äî‚Äî
        let dataChannel = null;
        let lastPoolUpdate = Date.now();
        let lastLimitUpdate = Date.now();
        let syncEnabled = false;

        // Ê£ÄÊü•ÊµèËßàÂô®ÂÖºÂÆπÊÄß
        if ('BroadcastChannel' in window) {
            try {
                dataChannel = new BroadcastChannel('labubu_data_sync');
                syncEnabled = true;
            } catch (error) {
                console.warn('BroadcastChannelÂàùÂßãÂåñÂ§±Ë¥•:', error);
                syncEnabled = false;
            }
        } else {
            console.warn('ÊµèËßàÂô®‰∏çÊîØÊåÅBroadcastChannelÔºåÂÆûÊó∂ÂêåÊ≠•ÂäüËÉΩÂ∞Ü‰∏çÂèØÁî®');
            syncEnabled = false;
        }

        // ‚Äî‚Äî VIP‰∏ì‰∫´Â•ñÊ±† (Âê´Ë∂ÖÁ®ÄÊúâ‰∏äËø™ÊåÇ‰ª∂) ‚Äî‚Äî
        const DEFAULT_POOL = [
            // ÊôÆÈÄöÂ•ñÂìÅ
            { name: "ÂÜçÊé•ÂÜçÂéâ", type: 'ÊäòÊâ£Âà∏', weight: 30, quantity: 50, rarity: 'common', points: 10, emoji: "üí™" },
            { name: "Â•∂Ëå∂‰∏ÄÊùØ", type: 'ÂÆû‰Ωì', weight: 25, quantity: 30, rarity: 'common', points: 20, emoji: "üßã" },
            { name: "ÁÉ§ËÇâÂà∏ÔºàÊ∏ÖÁúüËÆ∞ÂΩïÔºâ", type: 'ÂÆû‰Ωì', weight: 20, quantity: 25, rarity: 'common', points: 30, emoji: "ü•©" },
            { name: "ÁÉ§ËÇâÂà∏", type: 'ÂÆû‰Ωì', weight: 20, quantity: 20, rarity: 'common', points: 30, emoji: "üçñ" },
            { name: "Á≤æÂìÅÂ•∂Ëå∂Âà∏", type: 'ÂÆû‰Ωì', weight: 15, quantity: 15, rarity: 'rare', points: 50, emoji: "üßÉ" },
            { name: "1UÂ∏Å", type: 'ÂÆû‰Ωì', weight: 25, quantity: 100, rarity: 'common', points: 1, emoji: "üí∞" },
            { name: "3UÂ∏Å", type: 'ÂÆû‰Ωì', weight: 15, quantity: 60, rarity: 'common', points: 3, emoji: "üíµ" },
            { name: "5UÂ∏Å", type: 'ÂÆû‰Ωì', weight: 10, quantity: 40, rarity: 'rare', points: 5, emoji: "üí∏" },

            // LabubuÁ≥ªÂàóÊî∂Ëóè
            { name: "ÁªèÂÖ∏LabubuÂÖ¨‰ªî", type: 'ÂÆû‰Ωì', weight: 8, quantity: 10, rarity: 'rare', points: 100, image: "images/prizes/labubu/classic.jpg", emoji: "üß∏" },
            { name: "ÂΩ©ËôπLabubuÈôêÂÆö", type: 'ÂÆû‰Ωì', weight: 6, quantity: 8, rarity: 'epic', points: 150, image: "images/prizes/labubu/rainbow.jpg", emoji: "üåà" },
            { name: "‰∏áÂú£ËäÇLabubuÁâπÂà´Áâà", type: 'ÂÆû‰Ωì', weight: 4, quantity: 5, rarity: 'epic', points: 200, image: "images/prizes/labubu/halloween.jpg", emoji: "üéÉ" },
            { name: "ÈªÑÈáëLabubuÊî∂ËóèÁâà", type: 'ÂÆû‰Ωì', weight: 2, quantity: 3, rarity: 'legendary', points: 500, image: "images/prizes/labubu/gold.jpg", emoji: "üëë" },

            // Cookie AnnËø™Â£´Â∞ºÁ≥ªÂàó
            { name: "ÁîúÂøÉCookie AnnÂÖ¨‰ªî", type: 'ÂÆû‰Ωì', weight: 7, quantity: 8, rarity: 'rare', points: 120, image: "images/prizes/cookie-ann/sweet.jpg", emoji: "üç™" },
            { name: "ÂÖ¨‰∏ªCookie AnnÈôêÂÆö", type: 'ÂÆû‰Ωì', weight: 5, quantity: 6, rarity: 'epic', points: 180, image: "images/prizes/cookie-ann/princess.jpg", emoji: "üë∏" },
            { name: "Âú£ËØûCookie AnnÁâπÂà´Áâà", type: 'ÂÆû‰Ωì', weight: 3, quantity: 4, rarity: 'epic', points: 220, image: "images/prizes/cookie-ann/christmas.jpg", emoji: "üéÑ" },
            { name: "ÁÉòÁÑôÂ§ßÂ∏àCookie Ann", type: 'ÂÆû‰Ωì', weight: 1.5, quantity: 2, rarity: 'legendary', points: 600, image: "images/prizes/cookie-ann/baker.jpg", emoji: "üë©‚Äçüç≥" },

            // Pop MartÊΩÆÁé©Á≥ªÂàó
            { name: "MollyÁªèÂÖ∏Ê¨æ", type: 'ÂÆû‰Ωì', weight: 6, quantity: 7, rarity: 'rare', points: 110, image: "images/prizes/popmart/molly-classic.jpg", emoji: "üëß" },
            { name: "Dimoo‰∫ëÊúµÁ≥ªÂàó", type: 'ÂÆû‰Ωì', weight: 4, quantity: 5, rarity: 'epic', points: 160, image: "images/prizes/popmart/dimoo-cloud.jpg", emoji: "‚òÅÔ∏è" },
            { name: "SkullpandaÈ™∑È´ÖÁÜäÁå´", type: 'ÂÆû‰Ωì', weight: 2.5, quantity: 3, rarity: 'legendary', points: 450, image: "images/prizes/popmart/skullpanda.jpg", emoji: "üêº" },

            // Ë∂ÖÁ®ÄÊúâÁâπÂà´ÁâàÊåÇ‰ª∂ - ‰∏≠Â•ñÁéáÊûÅ‰Ωé (Âá†‰πé‰∏∫0)
            { name: "ÈôêÂÆöLabubu‰∏áÂú£ËäÇÊåÇ‰ª∂", type: 'ÂÆû‰Ωì', weight: 0.1, quantity: 1, rarity: 'mythic', points: 2000, image: "images/prizes/labubu/halloween-special.jpg", emoji: "üéÉ" },
            { name: "ÈôêÂÆöCookie AnnÂú£ËØûÊåÇ‰ª∂", type: 'ÂÆû‰Ωì', weight: 0.1, quantity: 1, rarity: 'mythic', points: 2000, image: "images/prizes/cookie-ann/christmas-special.jpg", emoji: "üéÑ" },
            { name: "ÈôêÂÆöMollyÂ§èÊó•Êµ∑Ê¥ãÊåÇ‰ª∂", type: 'ÂÆû‰Ωì', weight: 0.05, quantity: 1, rarity: 'mythic', points: 3000, image: "images/prizes/popmart/molly-ocean-special.jpg", emoji: "üåä" }
        ];

        // ‚Äî‚Äî Â∑•ÂÖ∑ÂáΩÊï∞ ‚Äî‚Äî
        const $ = (sel) => document.querySelector(sel);
        const $$ = (sel) => Array.from(document.querySelectorAll(sel));
        const nowStr = () => new Date().toLocaleString();
        const uid = (n = 8) => Math.random().toString(36).slice(2, 2 + n).toUpperCase();

        // ‚Äî‚Äî È°µÈù¢ËøáÊ∏°Âä®ÁîªÂäüËÉΩ ‚Äî‚Äî
        function initPageTransitions() {
            // ‰∏∫ÊâÄÊúâÈ°µÈù¢ÈìæÊé•Ê∑ªÂä†ËøáÊ∏°ÊïàÊûú
            $$('.page-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const href = link.getAttribute('href');
                    showPageTransition(() => {
                        window.location.href = href;
                    });
                });
            });

            // ‰∏∫ÂÖ∂‰ªñÂ§ñÈÉ®ÈìæÊé•‰πüÊ∑ªÂä†ËøáÊ∏°ÊïàÊûú
            $$('a[href$=".html"]').forEach(link => {
                if (!link.classList.contains('page-link')) {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const href = link.getAttribute('href');
                        showPageTransition(() => {
                            window.location.href = href;
                        });
                    });
                }
            });
        }

        function showPageTransition(callback) {
            const overlay = $('#pageTransitionOverlay');
            overlay.classList.add('active');

            // ÈöèÊú∫ÊòæÁ§∫‰∏çÂêåÁöÑÂä†ËΩΩÊñáÊ°à
            const loadingTexts = [
                { title: 'üß∏ Ê≠£Âú®Ë∑≥ËΩ¨...', subtitle: 'ËØ∑Á®çÂÄôÔºåÂç≥Â∞Ü‰∏∫ÊÇ®Âä†ËΩΩÁ≤æÂΩ©ÂÜÖÂÆπ' },
                { title: '‚ú® Âä†ËΩΩ‰∏≠...', subtitle: 'Ê≠£Âú®‰∏∫VIPËÇ°‰∏úÂáÜÂ§á‰∏ìÂ±û‰ΩìÈ™å' },
                { title: 'üéØ Âç≥Â∞ÜÂà∞Ëææ...', subtitle: 'ÊÇ®ÁöÑ‰∏ì‰∫´ÂäüËÉΩÊ≠£Âú®Ë∑Ø‰∏ä' },
                { title: 'üíé Á®çÁ≠âÁâáÂàª...', subtitle: 'Ê≠£Âú®Â±ïÂºÄÊÇ®ÁöÑ‰∏™‰∫∫ÊàêÂ∞±ÊÆøÂ†Ç' }
            ];

            const randomText = loadingTexts[Math.floor(Math.random() * loadingTexts.length)];
            overlay.querySelector('h3').textContent = randomText.title;
            overlay.querySelector('p').textContent = randomText.subtitle;

            // Âª∂ËøüÊâßË°åË∑≥ËΩ¨ÔºåËÆ©Áî®Êà∑ÁúãÂà∞ËøáÊ∏°Âä®Áîª
            setTimeout(() => {
                if (callback) callback();
            }, 800);
        }

        function hidePageTransition() {
            const overlay = $('#pageTransitionOverlay');
            overlay.classList.remove('active');
        }

        // È°µÈù¢Âä†ËΩΩÊó∂ÈöêËóèËøáÊ∏°Â±Ç
        window.addEventListener('load', () => {
            setTimeout(hidePageTransition, 300);
        });

        // ‚Äî‚Äî Á®ÄÊúâÂ∫¶ÈÖçÁΩÆ ‚Äî‚Äî
        function getPrizeRarity(prizeName, weight) {
            // ‰º†ËØ¥Á∫ßÔºàÊùÉÈáç ‚â§ 2ÔºåÊàñÁâπÂÆöÂ•ñÂìÅÔºâ
            if (weight <= 2 || prizeName.includes('ÈôêÈáè') || prizeName.includes('5UÂ∏Å')) {
                return 'legendary';
            }
            // Á®ÄÊúâÁ∫ßÔºàÊùÉÈáç ‚â§ 6Ôºâ
            if (weight <= 6 || prizeName.includes('3UÂ∏Å') || prizeName.includes('Á≤æÂìÅ')) {
                return 'rare';
            }
            // ÊôÆÈÄöÁ∫ß
            return 'common';
        }

        function getRarityConfig(rarity) {
            const configs = {
                legendary: {
                    animation: 'spin-legendary',
                    duration: 2000,
                    bgColor: 'from-yellow-400 to-orange-500',
                    textColor: 'text-yellow-100',
                    icon: 'üèÜ',
                    message: 'ÊÅ≠ÂñúËé∑Âæó‰º†ËØ¥Á∫ßÂ•ñÂìÅÔºÅ',
                    particles: '‚ú®üí´‚≠êüåüüíé',
                    sound: 'legendary'
                },
                rare: {
                    animation: 'spin-rare',
                    duration: 1800,
                    bgColor: 'from-purple-400 to-pink-500',
                    textColor: 'text-purple-100',
                    icon: 'üíé',
                    message: 'Ëé∑ÂæóÁ®ÄÊúâÂ•ñÂìÅÔºÅ',
                    particles: 'üíúüí´üîÆ‚ú®üéÄ',
                    sound: 'rare'
                },
                common: {
                    animation: 'spin-common',
                    duration: 1200,
                    bgColor: 'from-blue-400 to-green-500',
                    textColor: 'text-blue-100',
                    icon: 'üéÅ',
                    message: 'Ëé∑ÂæóÂ•ñÂìÅÔºÅ',
                    particles: 'üéÄüíôüíö‚ú®üéÅ',
                    sound: 'common'
                }
            };
            return configs[rarity] || configs.common;
        }

        function showRarityEffect(rarity, config) {
            // ÂàõÂª∫ÂÖ®Â±èÁ®ÄÊúâÂ∫¶ÊèêÁ§∫
            const overlay = document.createElement('div');
            overlay.className = 'fixed inset-0 z-50 flex items-center justify-center pointer-events-none';
            overlay.style.background = `linear-gradient(135deg, rgba(0,0,0,0.4), rgba(0,0,0,0.6))`;

            const effectContainer = document.createElement('div');
            effectContainer.className = `text-center bounce-in`;
            effectContainer.innerHTML = `
                <div class="text-6xl mb-4 sparkle">${config.icon}</div>
                <div class="text-2xl font-bold text-white mb-2">${config.message}</div>
                <div class="text-lg text-gray-200">Ëé∑Âæó‰∫ÜÁâπÊÆäÂ•ñÂìÅÔºÅ</div>
            `;

            overlay.appendChild(effectContainer);
            document.body.appendChild(overlay);

            // ÂàõÂª∫Á≤íÂ≠êÊïàÊûú
            createParticleEffect(config.particles);

            // 2ÁßíÂêéÁßªÈô§ÊïàÊûú
            setTimeout(() => {
                overlay.style.opacity = '0';
                setTimeout(() => {
                    if (document.body.contains(overlay)) {
                        document.body.removeChild(overlay);
                    }
                }, 300);
            }, 2000);
        }

        function createParticleEffect(particles) {
            const particleArray = particles.split('');
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.textContent = particleArray[Math.floor(Math.random() * particleArray.length)];
                    particle.className = 'fixed text-2xl pointer-events-none z-40';
                    particle.style.left = Math.random() * window.innerWidth + 'px';
                    particle.style.top = Math.random() * window.innerHeight + 'px';
                    particle.style.animation = 'sparkle 2s ease-out forwards';

                    document.body.appendChild(particle);

                    setTimeout(() => {
                        if (document.body.contains(particle)) {
                            document.body.removeChild(particle);
                        }
                    }, 2000);
                }, i * 100);
            }
        }

        function loadHistory() {
            try { return JSON.parse(localStorage.getItem(LS_KEYS.HISTORY)) || []; } catch { return []; }
        }
        function saveHistory(arr) { localStorage.setItem(LS_KEYS.HISTORY, JSON.stringify(arr)); }
        function loadPool() {
            try {
                const raw = localStorage.getItem(LS_KEYS.POOL);
                return raw ? JSON.parse(raw) : structuredClone(DEFAULT_POOL);
            } catch { return structuredClone(DEFAULT_POOL); }
        }
        function savePool(pool) { localStorage.setItem(LS_KEYS.POOL, JSON.stringify(pool)); }

        function poolToText(pool) {
            return pool.map(p => [p.name, p.type, p.weight, (p.quantity ?? -1)].join(',')).join('\n');
        }
        function textToPool(txt) {
            const lines = txt.split(/\n+/).map(l => l.trim()).filter(Boolean);

            if (lines.length === 0) {
                throw new Error('Â•ñÊ±†‰∏çËÉΩ‰∏∫Á©∫');
            }

            if (lines.length > 100) {
                throw new Error('Â•ñÊ±†È°πÁõÆ‰∏çËÉΩË∂ÖËøá100‰∏™');
            }

            return lines.map((line, i) => {
                const parts = line.split(',').map(s => s?.trim());

                if (parts.length < 3 || parts.length > 4) {
                    throw new Error(`Á¨¨ ${i + 1} Ë°åÊ†ºÂºè‰∏çÊ≠£Á°ÆÔºöÂ∫î‰∏∫ name,type,weight[,quantity]`);
                }

                const [name, type, weightStr, qtyStr] = parts;

                // ÂêçÁß∞È™åËØÅ
                if (!name || name.length > 50) {
                    throw new Error(`Á¨¨ ${i + 1} Ë°åÔºöÂ•ñÂìÅÂêçÁß∞‰∏çËÉΩ‰∏∫Á©∫‰∏î‰∏çËÉΩË∂ÖËøá50Â≠óÁ¨¶`);
                }

                // Á±ªÂûãÈ™åËØÅ
                if (!['ÊäµÊâ£Âà∏', 'ÂÆû‰Ωì', 'ÊäòÊâ£Âà∏'].includes(type)) {
                    throw new Error(`Á¨¨ ${i + 1} Ë°åÔºöÂ•ñÂìÅÁ±ªÂûãÂè™ËÉΩÊòØ ÊäµÊâ£Âà∏/ÂÆû‰Ωì/ÊäòÊâ£Âà∏`);
                }

                // ÊùÉÈáçÈ™åËØÅ
                const weight = Number(weightStr);
                if (!Number.isFinite(weight) || weight < 0 || weight > 10000) {
                    throw new Error(`Á¨¨ ${i + 1} Ë°åÔºöÊùÉÈáçÂøÖÈ°ªÊòØ0-10000‰πãÈó¥ÁöÑÊï∞Â≠ó`);
                }

                // Êï∞ÈáèÈ™åËØÅ
                let quantity = -1;
                if (qtyStr !== undefined && qtyStr !== '') {
                    quantity = Number(qtyStr);
                    if (!Number.isInteger(quantity) || quantity < -1 || quantity > 99999) {
                        throw new Error(`Á¨¨ ${i + 1} Ë°åÔºöÊï∞ÈáèÂøÖÈ°ªÊòØ-1Âà∞99999‰πãÈó¥ÁöÑÊï¥Êï∞`);
                    }
                }

                return { name, type, weight, quantity };
            });
        }

        function renderPoolList(pool) {
            const ul = $('#poolList');
            ul.innerHTML = '';
            const totalW = pool.reduce((s, p) => s + Math.max(0, p.weight || 0), 0) || 1;
            pool.forEach(p => {
                const left = p.quantity === -1 ? '‚àû' : p.quantity;
                const w = p.weight || 0;
                const pct = ((w / totalW) * 100).toFixed(1);
                const color = p.type === 'ÂÆû‰Ωì' ? 'bg-emerald-50 text-emerald-700 border-emerald-200' : (p.type === 'ÊäµÊâ£Âà∏' ? 'bg-indigo-50 text-indigo-700 border-indigo-200' : 'bg-amber-50 text-amber-700 border-amber-200');
                const li = document.createElement('li');
                li.className = `border rounded-xl p-3 flex items-center justify-between ${color}`;
                li.innerHTML = `<div class="font-medium">${p.name} <span class="ml-2 text-xs px-2 py-0.5 rounded-lg bg-white/60 border">${p.type}</span></div>
                        <div class="text-xs">ÊùÉÈáç ${w}Ôºà‚âà${pct}%Ôºâ ¬∑ Ââ©‰Ωô <b>${left}</b></div>`;
                ul.appendChild(li);
            });
        }

        function renderHistory() {
            const tb = $('#historyBody');
            tb.innerHTML = '';
            const hist = loadHistory();
            if (hist.length === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td class="py-3 text-slate-400" colspan="4">ÊöÇÊó†ËÆ∞ÂΩï</td>`;
                tb.appendChild(tr);
                return;
            }
            hist.slice().reverse().forEach(r => {
                const tr = document.createElement('tr');
                tr.className = 'border-t';
                tr.innerHTML = `<td class="py-3 pr-4 whitespace-nowrap">${r.time}</td>
                        <td class="py-3 pr-4">${r.prize}</td>
                        <td class="py-3 pr-4">${r.type}</td>
                        <td class="py-3 pr-4 text-slate-600 break-all">${r.code || r.note || ''}</td>`;
                tb.appendChild(tr);
            });
        }

        function weightedPick(pool) {
            const candidates = pool.filter(p => (p.quantity === -1 || p.quantity > 0) && (p.weight || 0) > 0);
            const sum = candidates.reduce((s, p) => s + p.weight, 0);
            if (sum <= 0 || candidates.length === 0) return null;
            let r = Math.random() * sum;
            for (const item of candidates) {
                if ((r -= item.weight) <= 0) return item;
            }
            return candidates[candidates.length - 1];
        }

        function onDraw() {
            uiSounds.playClickSound();
            performDraw(false); // Ê≠£ÂºèÊäΩÂ•ñ
        }

        function onTrialDraw() {
            uiSounds.playClickSound();
            performDraw(true); // ËØïÊäΩ‰ΩìÈ™å
        }

        function performDraw(isTrial = false) {
            const btn = isTrial ? $('#trialDrawBtn') : $('#drawBtn');
            const drawModeIndicator = $('#drawModeIndicator');
            const trialNotice = $('#trialNotice');

            // Êí≠ÊîæÊäΩÂ•ñÈü≥Êïà
            uiSounds.playDrawSound();

            btn.disabled = true; btn.classList.add('opacity-60');

            // Êõ¥Êñ∞Ê®°ÂºèÊåáÁ§∫Âô®
            if (isTrial) {
                drawModeIndicator.textContent = 'ËØïÊäΩ‰ΩìÈ™åÊ®°Âºè';
                trialNotice.classList.remove('hidden');
            } else {
                drawModeIndicator.textContent = 'Ê≠£ÂºèÊäΩÂ•ñÊ®°Âºè';
                trialNotice.classList.add('hidden');

                // Âè™ÊúâÊ≠£ÂºèÊäΩÂ•ñÊâçÊ£ÄÊü•Ê¨°Êï∞ÈôêÂà∂
                if (!canDraw()) {
                    const display = $('#resultDisplay');
                    const meta = $('#resultMeta');
                    display.textContent = 'ÊäΩÂ•ñÊ¨°Êï∞Â∑≤Áî®ÂÆå';
                    meta.textContent = '‰ªäÊó•ÊäΩÂ•ñÊ¨°Êï∞Â∑≤Ëææ‰∏äÈôêÔºåËØ∑ÊòéÊó•ÂÜçÊù•';
                    btn.disabled = false; btn.classList.remove('opacity-60');
                    return;
                }
            }

            const pool = loadPool();
            const picked = weightedPick(pool);
            const display = $('#resultDisplay');
            const meta = $('#resultMeta');

            if (!picked) {
                display.textContent = 'Â•ñÊ±†‰∏∫Á©∫ÊàñÂ∫ìÂ≠ò‰∏çË∂≥';
                meta.textContent = isTrial ? 'ËØïÊäΩÊó†Ê≥ïËøõË°åÔºåËØ∑ËÅîÁ≥ªÁÆ°ÁêÜÂëò' : 'ËØ∑ËÅîÁ≥ªÁÆ°ÁêÜÂëòÊ£ÄÊü•Â•ñÊ±†ËÆæÁΩÆ';
                btn.disabled = false; btn.classList.remove('opacity-60');
                return;
            }

            // Ëé∑ÂèñÁ®ÄÊúâÂ∫¶Âπ∂Â∫îÁî®ÂØπÂ∫îÂä®Êïà
            const rarity = getPrizeRarity(picked.name, picked.weight);
            const rarityConfig = getRarityConfig(rarity);

            // ÁßªÈô§ÊâÄÊúâÂèØËÉΩÁöÑÂä®ÁîªÁ±ª
            display.parentElement.classList.remove('spin', 'spin-legendary', 'spin-rare', 'spin-common');

            // Â∫îÁî®ÂØπÂ∫îÁ®ÄÊúâÂ∫¶ÁöÑÂä®Áîª
            display.parentElement.classList.add(rarityConfig.animation);

            // ÂàõÂª∫Á®ÄÊúâÂ∫¶ÊèêÁ§∫ÊïàÊûú
            if (!isTrial) {
                showRarityEffect(rarity, rarityConfig);
            }

            setTimeout(() => {
                display.parentElement.classList.remove(rarityConfig.animation);
            }, rarityConfig.duration);

            // ÁîüÊàêÂà∏Á†ÅÔºà‰ªÖÂà∏Á±ªÔºåËØïÊäΩÊó∂ÊòæÁ§∫Ê®°ÊãüÂà∏Á†ÅÔºâ
            let code = '';
            if (picked.type === 'ÊäµÊâ£Âà∏' || picked.type === 'ÊäòÊâ£Âà∏') {
                if (isTrial) {
                    code = `${picked.type === 'ÊäµÊâ£Âà∏' ? 'DK' : 'ZK'}-DEMO-${uid(4)}`; // ËØïÊäΩÊòæÁ§∫DEMOÂà∏Á†Å
                } else {
                    code = `${picked.type === 'ÊäµÊâ£Âà∏' ? 'DK' : 'ZK'}-${uid(4)}-${uid(4)}`;
                }
            }

            // Âè™ÊúâÊ≠£ÂºèÊäΩÂ•ñÊâçÊâ£ÂáèÂ∫ìÂ≠ò
            if (!isTrial && picked.quantity > 0) {
                picked.quantity -= 1;
                savePool(pool);
                renderPoolList(pool);
            }

            const record = {
                time: nowStr(),
                prize: picked.name,
                type: picked.type,
                code: code || undefined,
                note: picked.note || ''
            };

            // Âè™ÊúâÊ≠£ÂºèÊäΩÂ•ñÊâç‰øùÂ≠òËÆ∞ÂΩïÂíåÂ¢ûÂä†ËÆ°Êï∞
            if (!isTrial) {
                const hist = loadHistory();
                hist.push(record);
                saveHistory(hist);

                // Â¢ûÂä†Áî®Êà∑ÊäΩÂ•ñÊ¨°Êï∞ËÆ°Êï∞
                const userCount = loadUserDrawCount();
                saveUserDrawCount(userCount + 1);
                updateDrawLimitDisplay();
                renderHistory();
            }

            // Êí≠Êîæ‰∏≠Â•ñÈü≥Êïà
            setTimeout(() => {
                uiSounds.playWinSound();
            }, 1000);

            // ÊòæÁ§∫Â•ñÂìÅ - ‰ºòÂÖàÊòæÁ§∫ÂõæÁâáÔºåÂê¶ÂàôÊòæÁ§∫emoji
            if (picked.image) {
                display.innerHTML = `<div class="flex flex-col items-center gap-2">
                    <img src="${picked.image}" alt="${picked.name}" class="w-20 h-20 object-cover rounded-lg shadow-md">
                    <span class="text-lg font-bold">${picked.name}</span>
                </div>`;
            } else {
                display.innerHTML = `<div class="flex flex-col items-center gap-2">
                    <span class="text-4xl">${picked.emoji || 'üß∏'}</span>
                    <span class="text-lg font-bold">${picked.name}</span>
                </div>`;
            }

            let metaText = `${record.type}${record.code ? ' ¬∑ Âà∏Á†ÅÔºö' + record.code : ''}`;
            if (isTrial && code) {
                metaText += ' (Ê®°ÊãüÂà∏Á†Å)';
            }
            meta.textContent = metaText;

            setTimeout(() => {
                btn.disabled = false;
                btn.classList.remove('opacity-60');
                // ÊÅ¢Â§çÈªòËÆ§ÊòæÁ§∫
                drawModeIndicator.textContent = 'ÁÇπÂáªÊåâÈíÆÂºÄÂßãÊäΩÂ•ñ';
            }, 400);
        }

        function refreshNow() { $('#now').textContent = nowStr(); }

        // ‚Äî‚Äî ÊäΩÂ•ñÊ¨°Êï∞ÈôêÂà∂Áõ∏ÂÖ≥ ‚Äî‚Äî
        function loadDrawLimit() {
            try {
                const limit = localStorage.getItem(LS_KEYS.DRAW_LIMIT);
                return limit ? parseInt(limit) : 0; // 0Ë°®Á§∫‰∏çÈôêÂà∂
            } catch { return 0; }
        }

        function loadUserDrawCount() {
            try {
                const count = localStorage.getItem(LS_KEYS.USER_DRAW_COUNT);
                return count ? parseInt(count) : 0;
            } catch { return 0; }
        }

        function saveUserDrawCount(count) {
            localStorage.setItem(LS_KEYS.USER_DRAW_COUNT, count.toString());
        }

        function updateDrawLimitDisplay() {
            const limit = loadDrawLimit();
            const userCount = loadUserDrawCount();
            const remainingSpan = $('#remainingDraws');
            const drawLimitInfo = $('#drawLimitInfo');

            if (limit === 0) {
                drawLimitInfo.style.display = 'none'; // ‰∏çÈôêÂà∂Êó∂ÈöêËóè
            } else {
                drawLimitInfo.style.display = 'block';
                const remaining = Math.max(0, limit - userCount);
                remainingSpan.textContent = `${remaining}`;

                // Ê†πÊçÆÂâ©‰ΩôÊ¨°Êï∞ËÆæÁΩÆÈ¢úËâ≤
                if (remaining === 0) {
                    remainingSpan.className = 'text-red-600 font-medium';
                } else if (remaining <= 3) {
                    remainingSpan.className = 'text-orange-600 font-medium';
                } else {
                    remainingSpan.className = 'text-green-600 font-medium';
                }
            }
        }

        function canDraw() {
            const limit = loadDrawLimit();
            if (limit === 0) return true; // ‰∏çÈôêÂà∂

            const userCount = loadUserDrawCount();
            return userCount < limit;
        }



        function exportJSON() {
            const data = JSON.stringify(loadHistory(), null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `labubu_lottery_${Date.now()}.json`;
            a.click();
        }

        function exportCSV() {
            const rows = [['time', 'prize', 'type', 'code_or_note']].concat(
                loadHistory().map(r => [r.time, r.prize, r.type, r.code || r.note || ''])
            );
            const csv = rows.map(r => r.map(v => `"${String(v).replace(/"/g, '""')}"`).join(',')).join('\n');
            const blob = new Blob(["\ufeff" + csv], { type: 'text/csv;charset=utf-8;' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `labubu_lottery_${Date.now()}.csv`;
            a.click();
        }



        // ‚Äî‚Äî ‰∫ã‰ª∂ÁªëÂÆö ‚Äî‚Äî
        function bind() {
            $('#drawBtn').addEventListener('click', onDraw);
            $('#trialDrawBtn').addEventListener('click', onTrialDraw);
            $('#exportJsonBtn').addEventListener('click', exportJSON);
            $('#exportCsvBtn').addEventListener('click', exportCSV);
        }

        // ‚Äî‚Äî Êï∞ÊçÆÂêåÊ≠•ÁõëÂê¨ ‚Äî‚Äî
        function setupDataSync() {
            // ÁõëÂê¨ÁÆ°ÁêÜÂëòÁöÑÊï∞ÊçÆÊõ¥Êñ∞ÂπøÊí≠
            if (syncEnabled && dataChannel) {
                try {
                    dataChannel.addEventListener('message', (event) => {
                        const { type, data, timestamp } = event.data;

                        switch (type) {
                            case 'POOL_UPDATE':
                                if (timestamp > lastPoolUpdate) {
                                    lastPoolUpdate = timestamp;
                                    renderPoolList(loadPool());
                                    showUpdateNotification('Â•ñÊ±†ÈÖçÁΩÆÂ∑≤Êõ¥Êñ∞');
                                }
                                break;
                            case 'DRAW_LIMIT_UPDATE':
                                if (timestamp > lastLimitUpdate) {
                                    lastLimitUpdate = timestamp;
                                    updateDrawLimitDisplay();
                                    showUpdateNotification('ÊäΩÂ•ñÊ¨°Êï∞ÈôêÂà∂Â∑≤Êõ¥Êñ∞');
                                }
                                break;
                            case 'USER_COUNT_RESET':
                                updateDrawLimitDisplay();
                                showUpdateNotification('ÊäΩÂ•ñÊ¨°Êï∞Â∑≤ÈáçÁΩÆ');
                                break;
                            case 'SYSTEM_RESET':
                                location.reload(); // Á≥ªÁªüÈáçÁΩÆÊó∂ÂÆåÂÖ®Âà∑Êñ∞È°µÈù¢
                                break;
                        }
                    });
                } catch (error) {
                    console.error('ËÆæÁΩÆÊ∂àÊÅØÁõëÂê¨Â§±Ë¥•:', error);
                    syncEnabled = false;
                }
            }

            // ÁõëÂê¨localStorageÂèòÂåñÔºàË∑®Ê†áÁ≠æÈ°µÂêåÊ≠•Ôºâ
            window.addEventListener('storage', (event) => {
                if (event.key === LS_KEYS.POOL) {
                    renderPoolList(loadPool());
                    showUpdateNotification('Â•ñÊ±†ÈÖçÁΩÆÂ∑≤ÂêåÊ≠•');
                } else if (event.key === LS_KEYS.DRAW_LIMIT || event.key === LS_KEYS.USER_DRAW_COUNT) {
                    updateDrawLimitDisplay();
                    showUpdateNotification('ÊäΩÂ•ñÈôêÂà∂Â∑≤ÂêåÊ≠•');
                }
            });

            // ÂÆöÊúüÊ£ÄÊü•Êï∞ÊçÆÊõ¥Êñ∞ÔºàÂ§áÁî®Êú∫Âà∂Ôºâ
            setInterval(() => {
                const pool = loadPool();
                renderPoolList(pool);
                updateDrawLimitDisplay();
            }, 30000); // ÊØè30ÁßíÊ£ÄÊü•‰∏ÄÊ¨°
        }

        function showUpdateNotification(message) {
            // ÂàõÂª∫‰∏¥Êó∂ÈÄöÁü•
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-[var(--labu)] text-white px-4 py-2 rounded-lg shadow-lg z-50 text-sm transition-all duration-300';
            notification.textContent = `üì° ${message}`;
            document.body.appendChild(notification);

            // 3ÁßíÂêéËá™Âä®Ê∂àÂ§±
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        function init() {
            $('#year').textContent = new Date().getFullYear();
            refreshNow(); setInterval(refreshNow, 1000);
            const pool = loadPool();
            renderPoolList(pool);
            renderHistory();
            updateDrawLimitDisplay();
            setupDataSync(); // ÂêØÂä®Êï∞ÊçÆÂêåÊ≠•
        }

        // ‚Äî‚Äî Èü≥‰πêÊí≠ÊîæÂô®ÂäüËÉΩ ‚Äî‚Äî
        let musicLibrary = [
            // ÈªòËÆ§Èü≥‰πêÂ∫ìÔºåÂ∞ÜÈÄöËøáAPIÂä®ÊÄÅÂä†ËΩΩ
        ];

        // Jamendo APIÈÖçÁΩÆ
        const JAMENDO_CLIENT_ID = '709fa152'; // ÂÆòÊñπÊµãËØïID
        const JAMENDO_API_BASE = 'https://api.jamendo.com/v3.0';

        // Ê£ÄÊµãÂæÆ‰ø°ÁéØÂ¢É
        function isWeChatBrowser() {
            return /micromessenger/i.test(navigator.userAgent);
        }

        // Ëé∑ÂèñÊ¨ßÁæéÊµÅË°åÈü≥‰πêÔºàÂ¢ûÂä†ÂæÆ‰ø°ÂÖºÂÆπÊÄßÔºâ
        async function loadMusicFromAPI() {
            // ÂæÆ‰ø°ÁéØÂ¢ÉÁõ¥Êé•‰ΩøÁî®Â§áÁî®Èü≥‰πêÂ∫ì
            if (isWeChatBrowser()) {
                console.log('üéµ Ê£ÄÊµãÂà∞ÂæÆ‰ø°ÁéØÂ¢ÉÔºå‰ΩøÁî®ÂÜÖÁΩÆÈü≥‰πêÂ∫ì');
                musicLibrary = getWeChatMusicLibrary();
                return true;
            }

            try {
                // Ê∑ªÂä†Ë∂ÖÊó∂ÊéßÂà∂
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000); // 10ÁßíË∂ÖÊó∂

                // Ëé∑ÂèñÊµÅË°åÈü≥‰πêÂíåÁîµÂ≠êÈü≥‰πê
                const [popResponse, electroResponse, rockResponse] = await Promise.all([
                    fetch(`${JAMENDO_API_BASE}/tracks/?client_id=${JAMENDO_CLIENT_ID}&format=json&limit=5&tags=pop&include=musicinfo&audioformat=mp32`, {
                        signal: controller.signal,
                        mode: 'cors'
                    }),
                    fetch(`${JAMENDO_API_BASE}/tracks/?client_id=${JAMENDO_CLIENT_ID}&format=json&limit=3&tags=electronic&include=musicinfo&audioformat=mp32`, {
                        signal: controller.signal,
                        mode: 'cors'
                    }),
                    fetch(`${JAMENDO_API_BASE}/tracks/?client_id=${JAMENDO_CLIENT_ID}&format=json&limit=2&tags=rock&include=musicinfo&audioformat=mp32`, {
                        signal: controller.signal,
                        mode: 'cors'
                    })
                ]);

                clearTimeout(timeoutId);

                if (!popResponse.ok || !electroResponse.ok || !rockResponse.ok) {
                    throw new Error('APIËØ∑Ê±ÇÂ§±Ë¥•');
                }

                const popData = await popResponse.json();
                const electroData = await electroResponse.json();
                const rockData = await rockResponse.json();

                // ÂêàÂπ∂ÊâÄÊúâÈü≥‰πê
                const allTracks = [
                    ...(popData.results || []),
                    ...(electroData.results || []),
                    ...(rockData.results || [])
                ];

                if (allTracks.length === 0) {
                    throw new Error('Êú™Ëé∑ÂèñÂà∞Èü≥‰πêÊï∞ÊçÆ');
                }

                // ËΩ¨Êç¢‰∏∫Êàë‰ª¨ÁöÑÈü≥‰πêÂ∫ìÊ†ºÂºè
                musicLibrary = allTracks.map(track => ({
                    id: track.id,
                    title: track.name || 'Unknown Title',
                    artist: track.artist_name || 'Unknown Artist',
                    album: track.album_name || 'Unknown Album',
                    url: track.audio || track.audiodownload,
                    duration: formatDuration(track.duration),
                    image: track.album_image || track.image,
                    jamendoUrl: `https://www.jamendo.com/track/${track.id}`
                }));

                console.log('üéµ Â∑≤Âä†ËΩΩ', musicLibrary.length, 'È¶ñÂÖçË¥πÈü≥‰πê');
                return true;
            } catch (error) {
                console.error('‚ùå Âä†ËΩΩÈü≥‰πêÂ§±Ë¥•:', error);
                // ‰ΩøÁî®Â§áÁî®Èü≥‰πêÂ∫ì
                musicLibrary = getWeChatMusicLibrary();
                return false;
            }
        }

        // ÂÜÖÁΩÆÈü≥‰πêÂ∫ìÔºàÂåÖÂê´ÂÖçË¥πÂèØÊí≠ÊîæÁöÑÈü≥È¢ëÔºâ
        function getWeChatMusicLibrary() {
            return [
                {
                    title: "üéµ LabubuÂπ∏Ëøê‰πãÊ≠å",
                    artist: "Âü∫Èáë‰ºöÈü≥‰πêÂõ¢",
                    album: "ËÉåÊôØÈü≥‰πêÂêàÈõÜ",
                    url: "https://archive.org/download/testmp3testfile/mpthreetest.mp3",
                    duration: "3:24",
                    image: "",
                    jamendoUrl: "#"
                },
                {
                    title: "üé∂ ÊäΩÂ•ñËøõË°åÊõ≤",
                    artist: "Á≥ªÁªüÈü≥‰πê",
                    album: "‰∏ì‰∫´Èü≥‰πê",
                    url: "https://file-examples.com/storage/fe86ad9c094c8217c95bc2c/2017/11/file_example_MP3_700KB.mp3",
                    duration: "4:12",
                    image: "",
                    jamendoUrl: "#"
                },
                {
                    title: "üèÜ ËÉúÂà©Â∫ÜÂÖ∏",
                    artist: "Â∫ÜÁ•ùÈü≥‰πê",
                    album: "Ëé∑Â•ñÈü≥Êïà",
                    url: "https://www.soundjay.com/misc/sounds-777.wav",
                    duration: "2:48",
                    image: "",
                    jamendoUrl: "#"
                },
                {
                    title: "üå∏ Ê∏©È¶®ËÉåÊôØ",
                    artist: "ÁéØÂ¢ÉÈü≥‰πê",
                    album: "Ê∞õÂõ¥Èü≥‰πê",
                    url: "https://www.soundjay.com/misc/sounds-776.wav",
                    duration: "3:56",
                    image: "",
                    jamendoUrl: "#"
                },
                {
                    title: "üé† Ê¨¢‰πêÊó∂ÂÖâ",
                    artist: "Labubu‰πêÂõ¢",
                    album: "Âø´‰πêÂêàÈõÜ",
                    url: "https://www.w3schools.com/html/horse.mp3",
                    duration: "0:30",
                    image: "",
                    jamendoUrl: "#"
                },
                {
                    title: "üöÄ Ê¢¶ÊÉ≥Ëµ∑Ëà™",
                    artist: "Âä±ÂøóÈü≥‰πê",
                    album: "Ê≠£ËÉΩÈáè",
                    url: "https://www.learningcontainer.com/wp-content/uploads/2020/02/Kalimba.mp3",
                    duration: "5:30",
                    image: "",
                    jamendoUrl: "#"
                },
                {
                    title: "‚òÄÔ∏è ÂçàÂêéÈò≥ÂÖâ",
                    artist: "ËΩªÈü≥‰πê",
                    album: "ÊîæÊùæÊó∂ÂÖâ",
                    url: "https://samplelib.com/lib/preview/mp3/sample-6s.mp3",
                    duration: "0:06",
                    image: "",
                    jamendoUrl: "#"
                },
                {
                    title: "‚≠ê ÊòüÁ©∫‰∏ãÁöÑÊ¢¶",
                    artist: "Â§úÊõ≤Á≤æÈÄâ",
                    album: "ÂÆâÈùôÊóãÂæã",
                    url: "https://samplelib.com/lib/preview/mp3/sample-9s.mp3",
                    duration: "0:09",
                    image: "",
                    jamendoUrl: "#"
                },
                {
                    title: "üéÄ ÁîúÁæéÊóãÂæã",
                    artist: "ÂèØÁà±Èü≥‰πê",
                    album: "Labubu‰∏ìÂ±û",
                    url: "https://www.soundjay.com/misc/sounds-778.wav",
                    duration: "3:15",
                    image: "",
                    jamendoUrl: "#"
                },
                {
                    title: "üí´ Â•áÂπª‰πãÊóÖ",
                    artist: "È≠îÊ≥ïÈü≥‰πê",
                    album: "ÂπªÊÉ≥‰∏ñÁïå",
                    url: "https://www.soundjay.com/misc/sounds-779.wav",
                    duration: "4:20",
                    image: "",
                    jamendoUrl: "#"
                }
            ];
        }

        // Êó∂ÈïøÊ†ºÂºèÂåñ
        function formatDuration(seconds) {
            if (!seconds) return "0:00";
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        let currentSongIndex = 0;
        let isPlaying = false;
        let currentAudio = null;
        let isPlayerMinimized = true; // ÈªòËÆ§ÊúÄÂ∞èÂåñ

        // ÁÆÄÂçïÁöÑUIÈü≥ÊïàÁ≥ªÁªü
        class UISoundManager {
            constructor() {
                this.enabled = localStorage.getItem('ui_sound_enabled') !== 'false';
                this.audioContext = null;
                this.initAudioContext();
            }

            initAudioContext() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('Èü≥Êïà‰∏çÊîØÊåÅ');
                }
            }

            createBeep(frequency, duration, type = 'sine') {
                if (!this.audioContext || !this.enabled) return;

                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);

                oscillator.frequency.value = frequency;
                oscillator.type = type;

                gainNode.gain.setValueAtTime(0.05, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);

                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }

            playDrawSound() {
                this.createBeep(440, 0.1);
                setTimeout(() => this.createBeep(554.37, 0.1), 100);
                setTimeout(() => this.createBeep(659.25, 0.2), 200);
            }

            playWinSound() {
                this.createBeep(523.25, 0.15);
                setTimeout(() => this.createBeep(659.25, 0.15), 150);
                setTimeout(() => this.createBeep(783.99, 0.3), 300);
            }

            playClickSound() {
                this.createBeep(800, 0.1, 'square');
            }

            playNotificationSound() {
                this.createBeep(880, 0.15);
            }

            toggle() {
                this.enabled = !this.enabled;
                localStorage.setItem('ui_sound_enabled', this.enabled.toString());
                return this.enabled;
            }
        }

        const uiSounds = new UISoundManager();

        // Ëá™Âä®Êí≠ÊîæÂäüËÉΩ
        function startAutoPlay() {
            try {
                console.log('üéµ Â∞ùËØïËá™Âä®Êí≠ÊîæÈü≥‰πê...');

                // Ê£ÄÊü•ÊòØÂê¶ÊúâÈü≥È¢ëÂØπË±°
                if (currentAudio) {
                    // ÂÖàËÆæÁΩÆËæÉ‰ΩéÁöÑÈü≥ÈáèÔºåÈÅøÂÖçÁ™ÅÁÑ∂ÁöÑÂ§ßÂ£∞Èü≥‰πê
                    currentAudio.volume = 0.3;

                    const playPromise = currentAudio.play();
                    if (playPromise !== undefined) {
                        playPromise.then(() => {
                            isPlaying = true;
                            updatePlayButtons();
                            showMusicNotification('üéµ Ê¨¢ËøéÔºÅËÉåÊôØÈü≥‰πêÂ∑≤Ëá™Âä®ÂºÄÂßã', 'success');
                            console.log('üéµ Ëá™Âä®Êí≠ÊîæÊàêÂäü');
                        }).catch(error => {
                            console.log('üéµ Ëá™Âä®Êí≠ÊîæË¢´ÊµèËßàÂô®ÈòªÊ≠¢ÔºåÈúÄË¶ÅÁî®Êà∑‰∫§‰∫íÂêéÊâçËÉΩÊí≠Êîæ');

                            // Â¶ÇÊûúËá™Âä®Êí≠ÊîæË¢´ÈòªÊ≠¢ÔºåÊòæÁ§∫ÊèêÁ§∫Âπ∂ÂêØÁî®Áî®Êà∑ÁÇπÂáªÊí≠Êîæ
                            showMusicNotification('üéµ ÁÇπÂáª‰ªªÊÑè‰ΩçÁΩÆÂêØÁî®Èü≥‰πêÊí≠Êîæ', 'info');
                            enableUserInteractionPlay();
                        });
                    }
                } else {
                    // Â¶ÇÊûúÊ≤°ÊúâÈü≥È¢ëÂØπË±°ÔºåÂêØÂä®Ê®°ÊãüÊí≠Êîæ
                    console.log('üéµ ÂêØÂä®Ê®°ÊãüÊí≠ÊîæÊ®°Âºè');
                    isPlaying = true;
                    updatePlayButtons();
                    simulatePlayback();
                    showMusicNotification('üéµ Èü≥‰πêÊí≠ÊîæÂô®Â∑≤ÂêØÂä®ÔºàÊ®°ÊãüÊ®°ÂºèÔºâ', 'info');
                }
            } catch (error) {
                console.error('üéµ Ëá™Âä®Êí≠ÊîæÂ§±Ë¥•:', error);
                showMusicNotification('üéµ Èü≥‰πêÊí≠ÊîæÂô®ÂêØÂä®Â§±Ë¥•', 'error');
            }
        }

        // ÂêØÁî®Áî®Êà∑‰∫§‰∫íÊí≠ÊîæÔºàÂΩìËá™Âä®Êí≠ÊîæË¢´ÈòªÊ≠¢Êó∂Ôºâ
        function enableUserInteractionPlay() {
            const enableMusic = () => {
                if (!isPlaying && currentAudio) {
                    currentAudio.volume = 0.3;
                    const playPromise = currentAudio.play();
                    if (playPromise !== undefined) {
                        playPromise.then(() => {
                            isPlaying = true;
                            updatePlayButtons();
                            showMusicNotification('üéµ Èü≥‰πêÊí≠ÊîæÂ∑≤ÂêØÁî®', 'success');

                            // ÁßªÈô§‰∫ã‰ª∂ÁõëÂê¨Âô®
                            document.removeEventListener('click', enableMusic);
                            document.removeEventListener('touchstart', enableMusic);
                            document.removeEventListener('keydown', enableMusic);
                        }).catch(error => {
                            console.log('üéµ Êí≠ÊîæÂ§±Ë¥•:', error);
                        });
                    }
                }
            };

            // Ê∑ªÂä†Â§öÁßçÁî®Êà∑‰∫§‰∫í‰∫ã‰ª∂ÁõëÂê¨Âô®
            document.addEventListener('click', enableMusic, { once: true });
            document.addEventListener('touchstart', enableMusic, { once: true });
            document.addEventListener('keydown', enableMusic, { once: true });
        }

        async function initMusicPlayer() {
            try {
                // ÊòæÁ§∫ÁéØÂ¢É‰ø°ÊÅØ
                if (isWeChatBrowser()) {
                    showMusicNotification('üéµ ÂæÆ‰ø°ÁéØÂ¢ÉÂ∑≤‰ºòÂåñÔºåÈü≥‰πêÂäüËÉΩÊ≠£Â∏∏', 'success');
                }

                // ÂÖàÂä†ËΩΩÈü≥‰πêÂ∫ì
                const loadSuccess = await loadMusicFromAPI();
                if (loadSuccess) {
                    if (isWeChatBrowser()) {
                        console.log('üéµ ÂæÆ‰ø°ÁéØÂ¢É‰ΩøÁî®ÂÜÖÁΩÆÈü≥‰πêÂ∫ì');
                    } else {
                        console.log('üéµ ÊàêÂäüÂä†ËΩΩJamendoÈü≥‰πêÂ∫ì');
                    }
                } else {
                    console.log('üéµ ‰ΩøÁî®Â§áÁî®Èü≥‰πêÂ∫ì');
                }

                renderPlaylist();
                if (musicLibrary.length > 0) {
                    loadSong(0);

                    // Ëá™Âä®Êí≠ÊîæÂäüËÉΩ - Âª∂Ëøü1Áßí‰ª•Á°Æ‰øùÈ°µÈù¢ÂÆåÂÖ®Âä†ËΩΩ
                    setTimeout(() => {
                        startAutoPlay();
                    }, 1000);
                }

                // Á°Æ‰øùDOMÂÖÉÁ¥†Â≠òÂú®ÂêéÂÜçÂàùÂßãÂåñ
                const miniPlayer = $('#musicPlayerMini');
                const fullPlayer = $('#musicPlayerFull');
                const closeBtn = $('#closePlayer');

                if (miniPlayer && fullPlayer) {
                    // ÂàùÂßãÂåñ‰∏∫Â∞èÊåâÈíÆÁä∂ÊÄÅ
                    miniPlayer.classList.remove('hidden');
                    fullPlayer.classList.add('hidden');
                } else {
                    console.warn('üéµ Èü≥‰πêÊí≠ÊîæÂô®DOMÂÖÉÁ¥†Êú™ÊâæÂà∞');
                }

                // ÁªëÂÆöÊí≠ÊîæÂô®ÊéßÂà∂‰∫ã‰ª∂
                const playPauseBtn = $('#playPauseBtn');
                const prevBtn = $('#prevBtn');
                const nextBtn = $('#nextBtn');
                const volumeSlider = $('#volumeSlider');
                const progressContainer = $('#progressContainer');

                // Â∞èÊåâÈíÆÂíåÂÆåÊï¥Êí≠ÊîæÂô®ÂàáÊç¢
                if (miniPlayer) miniPlayer.addEventListener('click', showFullPlayer);
                if (closeBtn) closeBtn.addEventListener('click', showMiniPlayer);

                // Êí≠ÊîæÊéßÂà∂
                if (playPauseBtn) playPauseBtn.addEventListener('click', togglePlayPause);
                if (prevBtn) prevBtn.addEventListener('click', previousSong);
                if (nextBtn) nextBtn.addEventListener('click', nextSong);

                // Èü≥ÈáèÊéßÂà∂
                if (volumeSlider) volumeSlider.addEventListener('input', adjustVolume);

                // ËøõÂ∫¶Êù°ÁÇπÂáªË∑≥ËΩ¨
                if (progressContainer) progressContainer.addEventListener('click', seekToPosition);

                console.log('üéµ Èü≥‰πêÊí≠ÊîæÂô®ÂàùÂßãÂåñÂÆåÊàê');
            } catch (error) {
                console.error('üéµ Èü≥‰πêÊí≠ÊîæÂô®ÂàùÂßãÂåñÂ§±Ë¥•:', error);
                showMusicNotification('Èü≥‰πêÊí≠ÊîæÂô®ÂàùÂßãÂåñÂ§±Ë¥•', 'error');
            }
        }

        function renderPlaylist() {
            const playlist = $('#playlist');
            if (!playlist) return;

            playlist.innerHTML = '';

            if (musicLibrary.length === 0) {
                playlist.innerHTML = '<div class="text-xs text-slate-500 p-2">üéµ Ê≠£Âú®Âä†ËΩΩÈü≥‰πê...</div>';
                return;
            }

            musicLibrary.forEach((song, index) => {
                const songItem = document.createElement('div');
                songItem.className = `cursor-pointer p-2 rounded text-xs hover:bg-slate-100 transition-colors ${index === currentSongIndex ? 'bg-[var(--labu)] text-white' : ''}`;
                songItem.innerHTML = `
                    <div class="font-medium truncate">${song.title}</div>
                    <div class="text-xs opacity-75 truncate">${song.artist}</div>
                    <div class="text-xs opacity-60 truncate">${song.duration || ''}</div>
                `;
                songItem.addEventListener('click', () => loadSong(index));
                playlist.appendChild(songItem);
            });
        }

        function loadSong(index) {
            if (!musicLibrary || musicLibrary.length === 0) return;

            currentSongIndex = index;
            const song = musicLibrary[index];

            // ÂÅúÊ≠¢ÂΩìÂâçÊí≠Êîæ
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }

            // Êõ¥Êñ∞UI
            const currentSongEl = $('#currentSong');
            const currentArtistEl = $('#currentArtist');
            const miniSongNameEl = $('#miniSongName');
            const totalTimeEl = $('#totalTime');

            if (currentSongEl) currentSongEl.textContent = song.title;
            if (currentArtistEl) currentArtistEl.textContent = song.artist;
            if (miniSongNameEl) miniSongNameEl.textContent = `${song.title} - ${song.artist}`;
            if (totalTimeEl) totalTimeEl.textContent = song.duration || "0:00";

            // ÂàõÂª∫Êñ∞ÁöÑÈü≥È¢ëÂØπË±°ÔºàÂæÆ‰ø°ÁéØÂ¢É‰∏ãË∑≥ËøáÔºâ
            if (song.url && song.url !== '' && !isWeChatBrowser()) {
                try {
                    currentAudio = new Audio(song.url);
                    currentAudio.crossOrigin = "anonymous"; // Â§ÑÁêÜCORS

                    // Èü≥È¢ëÂä†ËΩΩÂÆåÊàê
                    currentAudio.addEventListener('loadeddata', () => {
                        console.log('üéµ Èü≥È¢ëÂ∑≤Âä†ËΩΩ:', song.title);
                        if (totalTimeEl) {
                            totalTimeEl.textContent = formatDuration(currentAudio.duration);
                        }
                    });

                    // Êí≠ÊîæÊó∂Êõ¥Êñ∞ËøõÂ∫¶
                    currentAudio.addEventListener('timeupdate', updateProgress);

                    // Êí≠ÊîæÁªìÊùüËá™Âä®‰∏ã‰∏ÄÈ¶ñ
                    currentAudio.addEventListener('ended', () => {
                        nextSong();
                    });

                    // ÈîôËØØÂ§ÑÁêÜ
                    currentAudio.addEventListener('error', (e) => {
                        console.warn('üéµ Èü≥È¢ëÂä†ËΩΩÂ§±Ë¥•:', song.title, e);
                        showMusicNotification('Èü≥È¢ëÂä†ËΩΩÂ§±Ë¥•ÔºåÂ∑≤Ë∑≥Âà∞‰∏ã‰∏ÄÈ¶ñ', 'error');
                        nextSong();
                    });
                } catch (error) {
                    console.warn('üéµ Èü≥È¢ëÂàõÂª∫Â§±Ë¥•:', error);
                }
            } else if (isWeChatBrowser() && song.url && song.url !== '') {
                // ÂæÆ‰ø°ÁéØÂ¢É‰∏ãÂ∞ùËØïÊí≠ÊîæÈü≥È¢ëÔºàÂ¶ÇÊûúÊúâURLÔºâ
                try {
                    currentAudio = new Audio(song.url);
                    currentAudio.volume = 0.3; // Èôç‰ΩéÈü≥ÈáèÈÅøÂÖçÁ™ÅÁÑ∂Êí≠Êîæ

                    currentAudio.addEventListener('loadeddata', () => {
                        console.log('üéµ ÂæÆ‰ø°Èü≥È¢ëÂ∑≤Âä†ËΩΩ:', song.title);
                        if (totalTimeEl) {
                            totalTimeEl.textContent = formatDuration(currentAudio.duration);
                        }
                    });

                    currentAudio.addEventListener('timeupdate', updateProgress);
                    currentAudio.addEventListener('ended', () => {
                        nextSong();
                    });

                    currentAudio.addEventListener('error', (e) => {
                        console.warn('üéµ ÂæÆ‰ø°Èü≥È¢ëÂä†ËΩΩÂ§±Ë¥•:', song.title, e);
                        nextSong();
                    });
                } catch (error) {
                    console.warn('üéµ ÂæÆ‰ø°Èü≥È¢ëÂàõÂª∫Â§±Ë¥•:', error);
                }
            } else {
                console.log('üéµ ÂΩìÂâçÊ≠åÊõ≤Êó†Èü≥È¢ëURL:', song.title);
            }

            renderPlaylist();
            isPlaying = false;
            updatePlayButtons();
        }

        // ÊòæÁ§∫ÂÆåÊï¥Êí≠ÊîæÂô®
        function showFullPlayer() {
            const miniPlayer = $('#musicPlayerMini');
            const fullPlayer = $('#musicPlayerFull');

            if (miniPlayer && fullPlayer) {
                miniPlayer.classList.add('hidden');
                fullPlayer.classList.remove('hidden');
                console.log('üéµ ÊòæÁ§∫ÂÆåÊï¥Êí≠ÊîæÂô®');
            }
        }

        // ÊòæÁ§∫Â∞èÊåâÈíÆÊí≠ÊîæÂô®
        function showMiniPlayer() {
            const miniPlayer = $('#musicPlayerMini');
            const fullPlayer = $('#musicPlayerFull');

            if (miniPlayer && fullPlayer) {
                fullPlayer.classList.add('hidden');
                miniPlayer.classList.remove('hidden');
                console.log('üéµ ÊòæÁ§∫Â∞èÊåâÈíÆÊí≠ÊîæÂô®');
            }
        }

        // Èü≥ÈáèÊéßÂà∂
        function adjustVolume(event) {
            const volume = event.target.value / 100;
            if (currentAudio) {
                currentAudio.volume = volume;
                console.log('üéµ Èü≥ÈáèË∞ÉËäÇËá≥:', Math.round(volume * 100) + '%');
            }
        }

        // ËøõÂ∫¶Êù°ÁÇπÂáªË∑≥ËΩ¨
        function seekToPosition(event) {
            if (!currentAudio || !currentAudio.duration) return;

            const progressContainer = event.currentTarget;
            const rect = progressContainer.getBoundingClientRect();
            const clickX = event.clientX - rect.left;
            const percentage = clickX / rect.width;
            const newTime = percentage * currentAudio.duration;

            currentAudio.currentTime = newTime;
            console.log('üéµ Ë∑≥ËΩ¨Âà∞:', formatDuration(newTime));
        }

        function togglePlayPause() {
            if (!currentAudio) {
                // Â¶ÇÊûúÊ≤°ÊúâÈü≥È¢ëÔºåÂ∞ùËØïÈáçÊñ∞Âä†ËΩΩÂΩìÂâçÊ≠åÊõ≤
                if (musicLibrary.length > 0) {
                    loadSong(currentSongIndex);
                    setTimeout(() => {
                        if (currentAudio) {
                            togglePlayPause();
                        } else {
                            showMusicNotification('üéµ Ê®°ÊãüÊí≠ÊîæÊ®°Âºè', 'info');
                            isPlaying = !isPlaying;
                            updatePlayButtons();
                            if (isPlaying) {
                                simulatePlayback();
                            }
                        }
                    }, 500);
                } else {
                    showMusicNotification('üéµ Ê®°ÊãüÊí≠ÊîæÊ®°Âºè', 'info');
                    isPlaying = !isPlaying;
                    updatePlayButtons();
                    if (isPlaying) {
                        simulatePlayback();
                    }
                }
                return;
            }

            if (isPlaying) {
                currentAudio.pause();
                isPlaying = false;
                showMusicNotification('‚è∏Ô∏è ÊöÇÂÅúÊí≠Êîæ', 'info');
            } else {
                const playPromise = currentAudio.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        isPlaying = true;
                        showMusicNotification('‚ñ∂Ô∏è ÂºÄÂßãÊí≠Êîæ', 'success');
                    }).catch(error => {
                        console.error('üéµ Êí≠ÊîæÂ§±Ë¥•:', error);
                        showMusicNotification('üéµ Ê®°ÊãüÊí≠ÊîæÊ®°Âºè', 'info');
                        isPlaying = true;
                        simulatePlayback();
                    });
                }
            }

            updatePlayButtons();
        }

        // Ê®°ÊãüÊí≠ÊîæÂäüËÉΩÔºàÂΩìÊ≤°ÊúâÁúüÂÆûÈü≥È¢ëÊó∂Ôºâ
        let simulationInterval;
        function simulatePlayback() {
            if (simulationInterval) clearInterval(simulationInterval);

            let simTime = 0;
            const maxTime = 180; // 3ÂàÜÈíü

            simulationInterval = setInterval(() => {
                if (!isPlaying) {
                    clearInterval(simulationInterval);
                    return;
                }

                simTime += 1;
                const progress = (simTime / maxTime) * 100;
                const progressBar = $('#progressBar');
                const currentTimeEl = $('#currentTime');

                if (progressBar) progressBar.style.width = Math.min(progress, 100) + '%';
                if (currentTimeEl) currentTimeEl.textContent = formatDuration(simTime);

                // Ê®°ÊãüÊí≠ÊîæÂÆåÊàê
                if (simTime >= maxTime) {
                    clearInterval(simulationInterval);
                    nextSong();
                }
            }, 1000);
        }

        function updatePlayButtons() {
            const playBtn = $('#playPauseBtn');
            const miniMusicIcon = $('#miniMusicIcon');

            if (playBtn) playBtn.textContent = isPlaying ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è';

            // Êõ¥Êñ∞Â∞èÊåâÈíÆÁöÑÁä∂ÊÄÅ
            if (miniMusicIcon) {
                if (isPlaying) {
                    miniMusicIcon.textContent = 'üéµ';
                    miniMusicIcon.classList.add('animate-pulse');
                } else {
                    miniMusicIcon.textContent = '‚è∏Ô∏è';
                    miniMusicIcon.classList.remove('animate-pulse');
                }
            }
        }

        function previousSong() {
            if (musicLibrary.length === 0) return;
            currentSongIndex = (currentSongIndex - 1 + musicLibrary.length) % musicLibrary.length;
            loadSong(currentSongIndex);
            if (isPlaying && currentAudio) {
                currentAudio.play().catch(console.error);
            }
        }

        function nextSong() {
            if (musicLibrary.length === 0) return;
            currentSongIndex = (currentSongIndex + 1) % musicLibrary.length;
            loadSong(currentSongIndex);
            if (isPlaying && currentAudio) {
                currentAudio.play().catch(console.error);
            }
        }

        // Êõ¥Êñ∞Êí≠ÊîæËøõÂ∫¶Ôºà‰ΩøÁî®ÁúüÂÆûÈü≥È¢ëÔºâ
        function updateProgress() {
            if (!currentAudio) return;

            const currentTime = currentAudio.currentTime;
            const duration = currentAudio.duration;

            if (duration) {
                const progress = (currentTime / duration) * 100;
                const progressBar = $('#progressBar');
                const currentTimeEl = $('#currentTime');

                if (progressBar) progressBar.style.width = progress + '%';
                if (currentTimeEl) currentTimeEl.textContent = formatDuration(currentTime);
            }
        }

        // Èü≥‰πêÈÄöÁü•
        function showMusicNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' :
                type === 'error' ? 'bg-red-500' : 'bg-blue-500';

            notification.className = `fixed top-20 left-4 ${bgColor} text-white px-4 py-2 rounded-lg shadow-lg z-50 text-sm transition-all duration-300 transform -translate-x-full`;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);

            setTimeout(() => {
                notification.style.transform = 'translateX(-100%)';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        // ‚Äî‚Äî ÁïôË®ÄÁ≥ªÁªüÂäüËÉΩ ‚Äî‚Äî
        const COMMENTS_API_URL = 'https://api.jsonbin.io/v3/b/67565e7bad19ca34f8cd4c52';
        const API_KEY = '$2a$10$VjQj.Gc8Q7q8q4k4K4k4Ou'; // ÂÖçË¥πAPIÂØÜÈí•Á§∫‰æã

        let comments = [];
        let currentUser = '';

        function initCommentSystem() {
            loadComments();

            $('#submitComment').addEventListener('click', submitComment);
            $('#commentInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && e.ctrlKey) {
                    submitComment();
                }
            });

            // ÊØè30ÁßíËá™Âä®Âà∑Êñ∞ÁïôË®Ä
            setInterval(loadComments, 30000);
        }

        function submitComment() {
            const userName = $('#userName').value.trim() || 'ÂåøÂêçÁî®Êà∑';
            const content = $('#commentInput').value.trim();

            if (!content) {
                alert('ËØ∑ËæìÂÖ•ÁïôË®ÄÂÜÖÂÆπ');
                return;
            }

            const comment = {
                id: Date.now().toString(),
                user: userName,
                content: content,
                timestamp: new Date().toLocaleString(),
                replies: []
            };

            comments.unshift(comment);
            saveComments();
            $('#commentInput').value = '';
            renderComments();
        }

        function replyToComment(commentId) {
            const replyContent = prompt('ÂõûÂ§çÂÜÖÂÆπÔºö');
            if (!replyContent) return;

            const userName = $('#userName').value.trim() || 'ÂåøÂêçÁî®Êà∑';
            const reply = {
                id: Date.now().toString(),
                user: userName,
                content: replyContent,
                timestamp: new Date().toLocaleString()
            };

            const comment = comments.find(c => c.id === commentId);
            if (comment) {
                comment.replies = comment.replies || [];
                comment.replies.push(reply);
                saveComments();
                renderComments();
            }
        }

        function deleteComment(commentId) {
            // Âè™ÊúâÁÆ°ÁêÜÂëòÂèØ‰ª•Âà†Èô§ÔºàËøôÈáåÁÆÄÂåñÊ£ÄÊü•Ôºâ
            if (!confirm('Á°ÆËÆ§Âà†Èô§Ê≠§ÁïôË®ÄÔºüÔºà‰ªÖÁÆ°ÁêÜÂëòÂèØÊìç‰ΩúÔºâ')) return;

            comments = comments.filter(c => c.id !== commentId);
            saveComments();
            renderComments();
        }

        function renderComments() {
            const container = $('#commentsList');

            if (comments.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-slate-400 py-8">
                        <div class="text-4xl mb-2">üí≠</div>
                        <div>ÊöÇÊó†ÁïôË®ÄÔºåÂø´Êù•ËØ¥ÁÇπ‰ªÄ‰πàÂêßÔºÅ</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = '';
            comments.forEach(comment => {
                const commentElement = document.createElement('div');
                commentElement.className = 'comment-bubble p-4 rounded-lg border border-slate-200';

                commentElement.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex items-center gap-2">
                            <span class="font-medium text-sm">${comment.user}</span>
                            <span class="text-xs text-slate-500">${comment.timestamp}</span>
                        </div>
                        <div class="flex gap-1">
                            <button onclick="replyToComment('${comment.id}')" class="text-xs text-blue-600 hover:underline">ÂõûÂ§ç</button>
                            <button onclick="deleteComment('${comment.id}')" class="text-xs text-red-600 hover:underline">Âà†Èô§</button>
                        </div>
                    </div>
                    <div class="text-sm text-slate-700 mb-2">${comment.content}</div>
                    ${comment.replies && comment.replies.length > 0 ? `
                        <div class="space-y-2 mt-3">
                            ${comment.replies.map(reply => `
                                <div class="comment-reply p-2 rounded text-xs">
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="font-medium">${reply.user}</span>
                                        <span class="text-slate-500">${reply.timestamp}</span>
                                    </div>
                                    <div class="text-slate-700">${reply.content}</div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                `;

                container.appendChild(commentElement);
            });

            $('#commentCount').textContent = comments.length;
        }

        function loadComments() {
            // Ê®°Êãü‰ªéAPIÂä†ËΩΩÊï∞ÊçÆÔºàÂÆûÈôÖÈ°πÁõÆ‰∏≠ÈúÄË¶ÅÁúüÂÆûAPIÔºâ
            const savedComments = localStorage.getItem('labubu_comments');
            if (savedComments) {
                comments = JSON.parse(savedComments);
                renderComments();
            }
        }

        function saveComments() {
            // Ê®°Êãü‰øùÂ≠òÂà∞APIÔºàÂÆûÈôÖÈ°πÁõÆ‰∏≠ÈúÄË¶ÅÁúüÂÆûAPIÔºâ
            localStorage.setItem('labubu_comments', JSON.stringify(comments));
        }

        // Êõ¥Êñ∞ÂØºËà™ÈìæÊé•
        function updateNavigation() {
            const nav = $('nav');
            const commentsLink = document.createElement('a');
            commentsLink.href = '#comments';
            commentsLink.className = 'hover:underline flex items-center gap-1';
            commentsLink.innerHTML = 'üí¨ ÁïôË®Ä';
            nav.appendChild(commentsLink);
        }

        // Èü≥‰πêÊí≠ÊîæÂô®ÂíåÁïôË®ÄÁ≥ªÁªüÂàùÂßãÂåñÂÆåÊàê
        // Ëøô‰∏™initÂáΩÊï∞Â∑≤ÁªèÂêàÂπ∂Âà∞‰∏ãÈù¢ÁöÑ‰∏ªinitÂáΩÊï∞‰∏≠

        // ‚Äî‚Äî Ëá™ÂÆö‰πâÈº†Ê†áÂíå‰∫§‰∫íÊïàÊûú ‚Äî‚Äî
        let cursorInitialized = false; // Èò≤Ê≠¢ÈáçÂ§çÂàùÂßãÂåñ

        function initCustomCursor() {
            // Â¶ÇÊûúÂ∑≤ÁªèÂàùÂßãÂåñËøáÔºåÁõ¥Êé•ËøîÂõû
            if (cursorInitialized) {
                console.log('üñ±Ô∏è Ëá™ÂÆö‰πâÂÖâÊ†áÂ∑≤ÂàùÂßãÂåñÔºåË∑≥ËøáÈáçÂ§çÂàùÂßãÂåñ');
                return;
            }

            const cursor = $('.custom-cursor');
            if (!cursor) {
                console.warn('üñ±Ô∏è Ëá™ÂÆö‰πâÂÖâÊ†áÂÖÉÁ¥†Êú™ÊâæÂà∞');
                return;
            }

            let mouseX = 0, mouseY = 0;

            // ÂàùÂßãÂåñÂÖâÊ†á‰ΩçÁΩÆ
            cursor.style.left = '0px';
            cursor.style.top = '0px';
            cursor.style.display = 'block';

            // Èº†Ê†áÁßªÂä®Ë∑üË∏™
            document.addEventListener('mousemove', (e) => {
                mouseX = e.clientX;
                mouseY = e.clientY;
                cursor.style.left = mouseX + 'px';
                cursor.style.top = mouseY + 'px';

                // ÂàõÂª∫Â∞æÈöèÂÖâÊïà
                createCursorTrail(mouseX, mouseY);

                // ‰æßËæπ‰∫íÂä®Ê£ÄÊµã
                if (mouseX < 100) {
                    createSideParticle('left', mouseY);
                } else if (mouseX > window.innerWidth - 100) {
                    createSideParticle('right', mouseY);
                }
            });

            // ÁÇπÂáªÊïàÊûú
            document.addEventListener('mousedown', () => {
                cursor.classList.add('clicking');
                createMagicParticles(mouseX, mouseY);
            });

            document.addEventListener('mouseup', () => {
                cursor.classList.remove('clicking');
            });

            cursorInitialized = true;
            console.log('üñ±Ô∏è Ëá™ÂÆö‰πâÂÖâÊ†áÂàùÂßãÂåñÂÆåÊàê');

            // ÊòæÁ§∫ÂÖâÊ†áÁä∂ÊÄÅÈÄöÁü•
            setTimeout(() => {
                showMusicNotification('üñ±Ô∏è Ëá™ÂÆö‰πâÂÖâÊ†áÂ∑≤ÂêØÁî®', 'success');
            }, 500);
        }

        function createCursorTrail(x, y) {
            const trail = document.createElement('div');
            trail.className = 'cursor-trail';
            trail.style.left = (x - 4) + 'px';
            trail.style.top = (y - 4) + 'px';
            document.body.appendChild(trail);

            setTimeout(() => {
                if (document.body.contains(trail)) {
                    document.body.removeChild(trail);
                }
            }, 500);
        }

        function createSideParticle(side, y) {
            if (Math.random() > 0.95) { // 5% Ê¶ÇÁéáËß¶Âèë
                const particle = document.createElement('div');
                particle.className = 'side-particle';
                particle.textContent = ['üß∏', '‚ú®', 'üéÄ', 'üí´', 'üåü', 'üéÅ'][Math.floor(Math.random() * 6)];
                particle.style.top = (y - 50 + Math.random() * 100) + 'px';

                if (side === 'left') {
                    particle.style.left = '20px';
                    $('.side-interactive.left').appendChild(particle);
                } else {
                    particle.style.right = '20px';
                    $('.side-interactive.right').appendChild(particle);
                }

                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, 3000);
            }
        }

        function createMagicParticles(x, y) {
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'magic-particle';
                    particle.style.left = (x + Math.random() * 40 - 20) + 'px';
                    particle.style.top = (y + Math.random() * 40 - 20) + 'px';
                    document.body.appendChild(particle);

                    setTimeout(() => {
                        if (document.body.contains(particle)) {
                            document.body.removeChild(particle);
                        }
                    }, 2000);
                }, i * 50);
            }
        }

        // ‚Äî‚Äî ÊåâÈíÆÊ≥¢Á∫πÊïàÊûú ‚Äî‚Äî
        function initButtonEffects() {
            document.querySelectorAll('.enhanced-btn').forEach(button => {
                button.addEventListener('click', createRipple);
            });
        }

        function createRipple(event) {
            const button = event.currentTarget;
            const rect = button.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = event.clientX - rect.left - size / 2;
            const y = event.clientY - rect.top - size / 2;

            const ripple = document.createElement('div');
            ripple.className = 'btn-ripple';
            ripple.style.width = ripple.style.height = size + 'px';
            ripple.style.left = x + 'px';
            ripple.style.top = y + 'px';

            button.appendChild(ripple);

            setTimeout(() => {
                if (button.contains(ripple)) {
                    button.removeChild(ripple);
                }
            }, 600);
        }

        // ‚Äî‚Äî ÊªöÂä®ËßíËâ≤Âä®Áîª ‚Äî‚Äî
        function initScrollCharacters() {
            let lastScrollY = window.scrollY;
            let scrollDirection = 'down';

            window.addEventListener('scroll', () => {
                const currentScrollY = window.scrollY;
                scrollDirection = currentScrollY > lastScrollY ? 'down' : 'up';
                lastScrollY = currentScrollY;

                // ÈöèÊú∫Ëß¶ÂèëËßíËâ≤Âä®Áîª
                if (Math.random() > 0.98) { // 2% Ê¶ÇÁéá
                    createScrollCharacter(scrollDirection);
                }
            });
        }

        function createScrollCharacter(direction) {
            const characters = ['üê≠', 'üê∞', 'ü¶Ñ', 'üêØ', 'ü¶Å', 'üêª', 'üêº', 'üê®', 'üê∏', 'üê∑'];
            const character = document.createElement('div');
            character.className = 'scroll-character';
            character.textContent = characters[Math.floor(Math.random() * characters.length)];

            const startY = Math.random() * (window.innerHeight - 100) + 50;
            character.style.top = startY + 'px';

            if (direction === 'down') {
                character.style.left = '-100px';
            } else {
                character.style.right = '-100px';
                character.style.transform = 'scaleX(-1)';
            }

            document.body.appendChild(character);

            setTimeout(() => {
                if (document.body.contains(character)) {
                    document.body.removeChild(character);
                }
            }, 4000);
        }

        // ‚Äî‚Äî È°µÈù¢Âä†ËΩΩÂä®Áîª‰ºòÂåñ ‚Äî‚Äî
        function initPageAnimations() {
            // ‰∏∫ÊâÄÊúâsectionÊ∑ªÂä†ËøõÂÖ•Âä®Áîª
            const sections = document.querySelectorAll('section, main');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.animation = 'slideIn 0.6s ease-out forwards';
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: '50px'
            });

            sections.forEach(section => {
                observer.observe(section);
            });
        }

        // ‚Äî‚Äî Èü≥‰πêÊí≠ÊîæÂô®‰ΩçÁΩÆ‰ºòÂåñ ‚Äî‚Äî
        function optimizeMusicPlayer() {
            const player = $('#musicPlayer');
            if (player) {
                // Ê£ÄÊµãÂ±èÂπïÂ∞∫ÂØ∏ÔºåÁßªÂä®Á´ØÊó∂Ë∞ÉÊï¥‰ΩçÁΩÆ
                if (window.innerWidth < 768) {
                    player.style.width = '280px';
                    player.style.bottom = '20px';
                    player.style.right = '20px';
                }
            }
        }

        // ÂÆâÂÖ®ÂàùÂßãÂåñÂáΩÊï∞ (Èò≤ÁØ°Êîπ)
        const _0x9f2e = function () {
            // VIPÊùÉÈôêÈ™åËØÅ - Âè™Âú®È¶ñÊ¨°ËÆøÈóÆÊó∂È™åËØÅ
            if (!window.checkVIPAccess || !window.checkVIPAccess()) {
                return false;
            }

            // ÊòæÁ§∫VIPÊ†áËØÜÔºàÂè™ÊòæÁ§∫‰∏ÄÊ¨°Ôºâ
            if (window.showVIPBadge) {
                window.showVIPBadge();
            }

            // ÂüüÂêçÈ™åËØÅ
            if (!window._secureConfig.validate()) {
                console.log('üéµ Ê¨¢ËøéËÆøÈóÆLabubuÂü∫Èáë‰ºöVIPÁ≥ªÁªü');
                return false;
            }

            return true;
        };

        function init() {
            // ÂÆâÂÖ®Ê£ÄÊü•
            if (!_0x9f2e()) return;

            $('#year').textContent = new Date().getFullYear();
            renderHistory();
            updateDrawLimitDisplay();
            setupDataSync();

            // ÂàùÂßãÂåñ‰∫§‰∫íÊïàÊûú
            setTimeout(() => {
                initCustomCursor();
                initButtonEffects();
                initScrollCharacters();
                initPageAnimations();
                optimizeMusicPlayer();
            }, 100);
        }

        // ‚Äî‚Äî ÁßØÂàÜÂÖëÊç¢Á≥ªÁªü ‚Äî‚Äî
        const EXCHANGE_ITEMS = [
            {
                id: 1,
                name: "ÈôêÂÆöLabubu‰∏áÂú£ËäÇÊåÇ‰ª∂",
                emoji: "üéÉ",
                image: "images/prizes/labubu/halloween-special.jpg",
                description: "Ë∂ÖÁ®ÄÊúâ‰∏áÂú£ËäÇÈôêÂÆöÊåÇ‰ª∂",
                cost: 6000,
                rarity: 'mythic',
                available: 1,
                requirements: "ÈúÄË¶Å3Âè™‰º†ËØ¥Á∫ßËßíËâ≤ + 1000ÁßØÂàÜ"
            },
            {
                id: 2,
                name: "ÈôêÂÆöCookie AnnÂú£ËØûÊåÇ‰ª∂",
                emoji: "üéÑ",
                image: "images/prizes/cookie-ann/christmas-special.jpg",
                description: "Ëø™Â£´Â∞ºÂú£ËØûÈôêÂÆöÊåÇ‰ª∂",
                cost: 6000,
                rarity: 'mythic',
                available: 1,
                requirements: "ÈúÄË¶Å3Âè™‰º†ËØ¥Á∫ßËßíËâ≤ + 1000ÁßØÂàÜ"
            },
            {
                id: 3,
                name: "ÈôêÂÆöMollyÂ§èÊó•Êµ∑Ê¥ãÊåÇ‰ª∂",
                emoji: "üåä",
                image: "images/prizes/popmart/molly-ocean-special.jpg",
                description: "2025Â§èÊó•Êµ∑Ê¥ãÈôêÂÆöÊåÇ‰ª∂",
                cost: 8000,
                rarity: 'mythic',
                available: 1,
                requirements: "ÈúÄË¶Å4Âè™‰º†ËØ¥Á∫ßËßíËâ≤ + 2000ÁßØÂàÜ"
            },
            {
                id: 4,
                name: "ÁôΩÈáëLabubuËá≥Â∞äÁâà",
                emoji: "üíé",
                image: "images/prizes/labubu/platinum.jpg",
                description: "ÁªàÊûÅÊî∂ËóèÁâàLabubu",
                cost: 4000,
                rarity: 'legendary',
                available: 3,
                requirements: "ÈúÄË¶Å4Âè™Âè≤ËØóÁ∫ßËßíËâ≤"
            },
            {
                id: 5,
                name: "Cookie AnnÂÖ¨‰∏ªÁ§ºÁõí",
                emoji: "üë∏",
                image: "images/prizes/cookie-ann/royal-set.jpg",
                description: "Ëø™Â£´Â∞ºÂÖ¨‰∏ª‰∏ªÈ¢òÈôêÂÆöÂ•óË£Ö",
                cost: 3500,
                rarity: 'legendary',
                available: 2,
                requirements: "ÈúÄË¶Å3Âè™Âè≤ËØóÁ∫ßËßíËâ≤"
            },
            {
                id: 6,
                name: "Pop MartËÅîÂêçÁ§ºÂåÖ",
                emoji: "üéÅ",
                description: "ÂåÖÂê´Molly+DimooÈôêÂÆöÂë®Ëæπ",
                cost: 2000,
                rarity: 'epic',
                available: 5,
                requirements: "ÈúÄË¶Å3Âè™Á®ÄÊúâÁ∫ßËßíËâ≤"
            }
        ];

        let userInventory = JSON.parse(localStorage.getItem('labubu_inventory') || '[]');
        let userPoints = 0;

        // ËÆ°ÁÆóÁî®Êà∑ÁßØÂàÜ
        function calculateUserPoints() {
            const history = loadHistory();
            userPoints = 0;

            history.forEach(record => {
                const pool = loadPool();
                const prize = pool.find(p => p.name === record.prize);
                if (prize && prize.points) {
                    userPoints += prize.points;
                }
            });

            // Êõ¥Êñ∞ÊòæÁ§∫
            $('#userPoints').textContent = userPoints;
            updateExchangeableItems();
            return userPoints;
        }

        // Êõ¥Êñ∞ÂèØÂÖëÊç¢Áâ©ÂìÅÊï∞Èáè
        function updateExchangeableItems() {
            const canExchange = EXCHANGE_ITEMS.filter(item => userPoints >= item.cost).length;
            $('#exchangeableItems').textContent = canExchange;
        }

        // Ê∏≤ÊüìÂÖëÊç¢ÂïÜÂìÅ
        function renderExchangeItems() {
            const container = $('#exchangeItems');

            container.innerHTML = EXCHANGE_ITEMS.map(item => {
                const canAfford = userPoints >= item.cost;
                const rarityConfig = getRarityConfig(item.rarity);

                return `
                    <div class="border border-slate-200 rounded-2xl p-4 ${canAfford ? 'bg-white' : 'bg-gray-50 opacity-60'}">
                        <div class="flex items-center gap-3 mb-3">
                            <div class="text-3xl">${item.emoji}</div>
                            <div class="flex-1">
                                <h4 class="font-medium text-sm">${item.name}</h4>
                                <div class="text-xs" style="color: ${rarityConfig.color}">
                                    ${rarityConfig.emoji} ${rarityConfig.name}Á∫ß
                                </div>
                            </div>
                        </div>
                        
                        <p class="text-xs text-slate-600 mb-3">${item.description}</p>
                        
                        <div class="text-xs text-slate-500 mb-3">
                            ${item.requirements}
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div class="text-sm">
                                <span class="font-bold text-[var(--labu)]">${item.cost}</span> ÁßØÂàÜ
                            </div>
                            <button onclick="exchangeItem(${item.id})" 
                                    class="enhanced-btn px-3 py-1 text-xs rounded-lg ${canAfford ? 'bg-[var(--labu)] text-white' : 'bg-gray-200 text-gray-500'}"
                                    ${!canAfford ? 'disabled' : ''}>
                                ${canAfford ? 'üîÑ ÂÖëÊç¢' : '‚ùå ÁßØÂàÜ‰∏çË∂≥'}
                            </button>
                        </div>
                        
                        <div class="text-xs text-slate-400 mt-2">
                            Ââ©‰Ωô: ${item.available} ‰ª∂
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Ê∏≤ÊüìÊàëÁöÑÊî∂Ëóè
        function renderMyCollection() {
            const container = $('#myCollection');
            const history = loadHistory();
            const pool = loadPool();

            // ÁªüËÆ°Êî∂Ëóè
            const collection = {};
            history.forEach(record => {
                const prize = pool.find(p => p.name === record.prize);
                if (prize && prize.rarity && prize.rarity !== 'common') {
                    collection[record.prize] = (collection[record.prize] || 0) + 1;
                }
            });

            if (Object.keys(collection).length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-8 text-slate-400">
                        <div class="text-3xl mb-2">üß∏</div>
                        <div class="text-sm">ÊöÇÊó†Êî∂ËóèÔºåÂø´ÂéªÊäΩÂ•ñËé∑ÂæóLabubuÂêßÔºÅ</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = Object.entries(collection).map(([name, count]) => {
                const prize = pool.find(p => p.name === name);
                const rarityConfig = getRarityConfig(prize.rarity);

                return `
                    <div class="bg-white border border-slate-200 rounded-xl p-3 text-center">
                        <div class="text-2xl mb-1">${getLabubuEmoji(name)}</div>
                        <div class="text-xs font-medium mb-1">${name}</div>
                        <div class="text-xs mb-2" style="color: ${rarityConfig.color}">
                            ${rarityConfig.emoji} ${rarityConfig.name}
                        </div>
                        <div class="text-xs font-bold">Êï∞Èáè: ${count}</div>
                        <div class="text-xs text-slate-500">‰ª∑ÂÄº: ${(prize.points || 0) * count}ÂàÜ</div>
                    </div>
                `;
            }).join('');
        }

        // Ëé∑ÂèñLabubuË°®ÊÉÖ
        function getLabubuEmoji(name) {
            const emojiMap = {
                'ÁªèÂÖ∏LabubuÂÖ¨‰ªî': 'üß∏',
                'ÂΩ©ËôπLabubuÈôêÂÆö': 'üåà',
                'Âú£ËØûLabubuÁâπÂà´Áâà': 'üéÑ',
                'ÈªÑÈáëLabubuÊî∂ËóèÁâà': 'üëë',
                '24‰∏äËø™‰∏áÂú£ËäÇÈ•ºÈ•ºÊåÇ‰ª∂': 'üéÉ',
                '24‰∏äËø™‰∏áÂú£ËäÇÈú≤Èú≤ÊåÇ‰ª∂': 'üëª',
                '25‰∏äËø™Â§èÊó•Êµ∑Ê¥ãÈ•ºÈ•ºÊåÇ‰ª∂': 'üåä'
            };
            return emojiMap[name] || 'üß∏';
        }

        // ÂÖëÊç¢Áâ©ÂìÅ
        function exchangeItem(itemId) {
            const item = EXCHANGE_ITEMS.find(i => i.id === itemId);
            if (!item || userPoints < item.cost || item.available <= 0) {
                alert('ÂÖëÊç¢Â§±Ë¥•ÔºöÁßØÂàÜ‰∏çË∂≥ÊàñÂ∫ìÂ≠ò‰∏çË∂≥');
                return;
            }

            if (confirm(`Á°ÆËÆ§ÂÖëÊç¢ ${item.name}Ôºü\nÊ∂àËÄó ${item.cost} ÁßØÂàÜ`)) {
                // Êâ£Èô§ÁßØÂàÜ
                userPoints -= item.cost;
                item.available--;

                // Ê∑ªÂä†Âà∞ÂéÜÂè≤ËÆ∞ÂΩï
                const history = loadHistory();
                const exchangeRecord = {
                    id: Date.now(),
                    prize: item.name,
                    code: generateCode(),
                    time: new Date().toLocaleString(),
                    type: 'exchange'
                };
                history.unshift(exchangeRecord);
                saveHistory(history);

                // Êõ¥Êñ∞ÊòæÁ§∫
                renderExchangeItems();
                renderMyCollection();
                renderHistory();
                $('#userPoints').textContent = userPoints;

                // ÊòæÁ§∫ÂÖëÊç¢ÊàêÂäü
                showExchangeSuccess(item.name, exchangeRecord.code);

                // ÂàõÂª∫Â∫ÜÁ•ùÊïàÊûú
                createCelebrationEffect();
            }
        }

        // ÊòæÁ§∫ÂÖëÊç¢ÊàêÂäü
        function showExchangeSuccess(itemName, code) {
            const popup = document.createElement('div');
            popup.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center';
            popup.innerHTML = `
                <div class="bg-white rounded-3xl p-8 mx-4 max-w-md w-full text-center">
                    <div class="text-6xl mb-4">üéâ</div>
                    <h3 class="text-xl font-bold mb-2">ÂÖëÊç¢ÊàêÂäüÔºÅ</h3>
                    <p class="text-slate-600 mb-4">ÊÅ≠ÂñúËé∑ÂæóÔºö${itemName}</p>
                    <div class="bg-gray-100 rounded-lg p-3 mb-4">
                        <div class="text-xs text-slate-500 mb-1">ÂÖëÊç¢Á†Å</div>
                        <div class="font-mono text-lg font-bold">${code}</div>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            class="enhanced-btn px-6 py-2 bg-[var(--labu)] text-white rounded-xl font-medium">
                        Á°ÆÂÆö
                    </button>
                </div>
            `;
            document.body.appendChild(popup);
        }

        // ÂàùÂßãÂåñÁßØÂàÜÂÖëÊç¢Á≥ªÁªü
        function initExchangeSystem() {
            calculateUserPoints();
            renderExchangeItems();
            renderMyCollection();

            // ÁªëÂÆö‰∫ã‰ª∂
            $('#calculatePointsBtn').addEventListener('click', () => {
                calculateUserPoints();
                showNotification('‚úÖ ÁßØÂàÜÂ∑≤ÈáçÊñ∞ËÆ°ÁÆó');
            });
        }

        // ÊòæÁ§∫ÈÄöÁü•
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg z-50';
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 3000);
        }

        // ÂàõÂª∫Â∫ÜÁ•ùÊïàÊûú
        function createCelebrationEffect() {
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'magic-particle';
                    particle.style.left = (window.innerWidth / 2 + Math.random() * 200 - 100) + 'px';
                    particle.style.top = (window.innerHeight / 2 + Math.random() * 200 - 100) + 'px';
                    document.body.appendChild(particle);

                    setTimeout(() => {
                        if (document.body.contains(particle)) {
                            document.body.removeChild(particle);
                        }
                    }, 2000);
                }, i * 100);
            }
        }

        // Ê£ÄÊü•Êù°Ê¨æÂêåÊÑèÁä∂ÊÄÅ
        function checkTermsAgreement() {
            const agreed = localStorage.getItem('terms_agreed');
            if (!agreed) {
                window.location.href = 'welcome.html';
                return false;
            }

            const agreeTime = parseInt(agreed);
            const now = Date.now();
            const dayInMs = 24 * 60 * 60 * 1000;

            // Êù°Ê¨æÂêåÊÑèÊúâÊïàÊúü7Â§©
            if (now - agreeTime > 7 * dayInMs) {
                localStorage.removeItem('terms_agreed');
                window.location.href = 'welcome.html';
                return false;
            }

            return true;
        }

        // Êõ¥Êñ∞‰∏ªË¶ÅÁöÑinitÂáΩÊï∞ 
        function init() {
            if (!_0x9f2e()) return;
            if (!checkTermsAgreement()) return;

            loadData();
            renderHistory();
            updateDrawLimitDisplay();
            setupDataSync();
            initExchangeSystem(); // ÂàùÂßãÂåñÂÖëÊç¢Á≥ªÁªü

            // ÂàùÂßãÂåñÈü≥‰πêÊí≠ÊîæÂô®
            initMusicPlayer();
            initCommentSystem();
            updateNavigation();

            setTimeout(() => {
                // initCustomCursor(); // Â∑≤Âú®bind()ÂáΩÊï∞‰∏≠ÂàùÂßãÂåñÔºåÈÅøÂÖçÈáçÂ§ç
                initButtonEffects();
                initScrollCharacters();
                initPageAnimations();
                initPageTransitions(); // ÂàùÂßãÂåñÈ°µÈù¢ËøáÊ∏°
                optimizeMusicPlayer();
            }, 100);
        }

        // ÁªëÂÆöÊñ∞ÂäüËÉΩ
        window.replyToComment = replyToComment;
        window.deleteComment = deleteComment;
        window.exchangeItem = exchangeItem;

        bind();
        init();
    </script>
</body>

</html>