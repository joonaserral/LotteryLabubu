<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人中心 - Labubu 幸运抽奖 🧸</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🧸</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    <style>
        :root {
            --labu: #6b5b95;
            --labu2: #ffcc00;
        }

        .labu-gradient {
            background-image: linear-gradient(135deg, rgba(107, 91, 149, .15), rgba(255, 204, 0, .15));
        }

        .sparkle {
            animation: sparkle 2s ease-in-out infinite alternate;
        }

        @keyframes sparkle {
            0% {
                transform: scale(1) rotate(0deg);
            }

            100% {
                transform: scale(1.1) rotate(5deg);
            }
        }

        /* 自定义鼠标样式 */
        * {
            cursor: none !important;
        }

        /* 恢复文本输入元素的光标 */
        input,
        textarea,
        [contenteditable="true"],
        .text-input {
            cursor: text !important;
        }

        /* 恢复可点击元素的光标 */
        button,
        a,
        [role="button"],
        .cursor-pointer,
        select {
            cursor: pointer !important;
        }

        .custom-cursor {
            position: fixed;
            width: 20px;
            height: 20px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ff69b4"><path d="M8 2C8 2 8.5 3 10.5 3C12.5 3 13 2 13 2C14 2 15 3 15 4C15 5 14 6 13 6C12 6 11 7 11 8C11 9 12 10 13 10C14 10 15 9 15 8C15 7 16 6 17 6C18 6 19 7 19 8C19 9 18 10 17 10C16 10 15 11 15 12C15 13 16 14 17 14C18 14 19 13 19 12C19 11 20 10 21 10C22 10 23 11 23 12C23 13 22 14 21 14C20 14 19 15 19 16C19 17 18 18 17 18C16 18 15 17 15 16C15 15 14 14 13 14C12 14 11 15 11 16C11 17 10 18 9 18C8 18 7 17 7 16C7 15 8 14 9 14C10 14 11 13 11 12C11 11 10 10 9 10C8 10 7 11 7 12C7 13 6 14 5 14C4 14 3 13 3 12C3 11 4 10 5 10C6 10 7 9 7 8C7 7 6 6 5 6C4 6 3 7 3 8C3 9 2 10 1 10C0 10 -1 9 -1 8C-1 7 0 6 1 6C2 6 3 5 3 4C3 3 4 2 5 2C6 2 7 3 7 4C7 5 8 6 9 6C10 6 11 5 11 4C11 3 10 2 9 2C8.5 2 8 2 8 2Z"/></svg>') no-repeat center;
            background-size: contain;
            pointer-events: none;
            z-index: 9999;
            transition: transform 0.1s ease;
            transform: translate(-50%, -50%);
        }

        .custom-cursor.clicking {
            transform: translate(-50%, -50%) scale(1.2);
        }

        .cursor-trail {
            position: fixed;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, rgba(255, 105, 180, 0.8) 0%, rgba(255, 105, 180, 0) 70%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9998;
            animation: cursorTrailFade 0.5s ease-out forwards;
        }

        @keyframes cursorTrailFade {
            0% {
                opacity: 1;
                transform: scale(1);
            }

            100% {
                opacity: 0;
                transform: scale(0.3);
            }
        }

        /* 等级进度条 */
        .level-progress {
            background: linear-gradient(90deg, var(--labu) 0%, var(--labu2) 100%);
            height: 8px;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* 成就徽章 */
        .achievement-badge {
            transition: all 0.3s ease;
        }

        .achievement-badge:hover {
            transform: scale(1.1) rotate(5deg);
        }

        .achievement-unlocked {
            background: linear-gradient(45deg, #ffd700, #ffed4a);
            color: #8b5a00;
        }

        .achievement-locked {
            background: #e2e8f0;
            color: #64748b;
        }

        /* 统计卡片动画 */
        .stat-card {
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
        }

        /* 签到日历 */
        .calendar-day {
            transition: all 0.3s ease;
        }

        .calendar-day.signed {
            background: linear-gradient(45deg, var(--labu), var(--labu2));
            color: white;
        }

        .calendar-day.today {
            border: 2px solid var(--labu);
            box-shadow: 0 0 10px rgba(107, 91, 149, 0.3);
        }

        /* 按钮增强效果 */
        .enhanced-btn {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .enhanced-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .enhanced-btn:hover::before {
            left: 100%;
        }

        .enhanced-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(107, 91, 149, 0.3);
        }

        /* 收藏品展示 */
        .collection-item {
            transition: all 0.3s ease;
            position: relative;
        }

        .collection-item:hover {
            transform: scale(1.05);
        }

        .collection-item.owned {
            opacity: 1;
        }

        .collection-item.not-owned {
            opacity: 0.3;
            filter: grayscale(100%);
        }

        /* 粒子效果 */
        .magic-particle {
            position: fixed;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, #ffd700 0%, #ff69b4 50%, transparent 100%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9997;
            animation: magicParticle 2s ease-out forwards;
        }

        @keyframes magicParticle {
            0% {
                opacity: 1;
                transform: scale(0) rotate(0deg);
            }

            50% {
                opacity: 1;
                transform: scale(1) rotate(180deg);
            }

            100% {
                opacity: 0;
                transform: scale(0.2) rotate(360deg) translateY(-50px);
            }
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-900">
    <!-- 自定义鼠标光标 -->
    <div class="custom-cursor"></div>

    <!-- 顶部导航 -->
    <header class="sticky top-0 z-30 backdrop-blur bg-white/90 border-b border-slate-200 shadow-sm">
        <div class="max-w-6xl mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div
                        class="w-10 h-10 rounded-xl bg-[var(--labu)] grid place-content-center text-white text-xl sparkle">
                        🧸</div>
                    <div>
                        <h1 class="font-bold text-lg">个人中心</h1>
                        <p class="text-xs text-slate-500">Labubu 收集家 ✨</p>
                    </div>
                </div>
                <nav class="flex items-center gap-6">
                    <a href="index.html" class="text-slate-600 hover:text-[var(--labu)] transition-colors">🎯 抽奖</a>
                    <a href="shop.html" class="text-slate-600 hover:text-[var(--labu)] transition-colors">🛒 商城</a>
                    <a href="tasks.html" class="text-slate-600 hover:text-[var(--labu)] transition-colors">📋 任务</a>
                </nav>
            </div>
        </div>
    </header>

    <div class="max-w-6xl mx-auto px-4 py-8">
        <!-- 用户信息卡片 -->
        <section class="labu-gradient rounded-3xl p-8 mb-8">
            <div class="flex items-center gap-6">
                <div class="relative group cursor-pointer" id="avatarContainer">
                    <div class="w-24 h-24 rounded-2xl bg-white/80 grid place-content-center text-4xl sparkle overflow-hidden"
                        id="userAvatar">
                        🧸
                    </div>
                    <div
                        class="absolute inset-0 bg-black/50 rounded-2xl flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                        <span class="text-white text-xs">点击编辑</span>
                    </div>
                </div>
                <div class="flex-1">
                    <div class="flex items-center gap-3 mb-2">
                        <h2 class="text-2xl font-bold" id="userName">Labubu收集家</h2>
                        <div class="px-3 py-1 bg-[var(--labu)] text-white rounded-full text-sm font-medium">
                            Lv.<span id="userLevel">5</span>
                        </div>
                    </div>
                    <p class="text-slate-600 mb-3">已加入 <span id="joinDays">127</span> 天 | 今日活跃度 <span
                            class="text-[var(--labu)] font-semibold">85%</span></p>

                    <!-- 等级进度条 -->
                    <div class="mb-4">
                        <div class="flex justify-between text-sm mb-1">
                            <span>距离下一级还需</span>
                            <span id="expNeeded">350/1000 EXP</span>
                        </div>
                        <div class="w-full bg-white/50 rounded-full h-2">
                            <div class="level-progress w-1/3"></div>
                        </div>
                    </div>

                    <div class="flex gap-4">
                        <button id="editProfileBtn" class="enhanced-btn px-4 py-2 bg-white/80 rounded-xl font-medium">✏️
                            编辑资料</button>
                        <button id="dailyCheckinBtn"
                            class="enhanced-btn px-4 py-2 bg-[var(--labu)] text-white rounded-xl font-medium">🎁
                            每日签到</button>
                        <button id="logoutBtn"
                            class="enhanced-btn px-4 py-2 bg-red-500 text-white rounded-xl font-medium hidden">🚪
                            退出登录</button>
                    </div>

                    <!-- 用户状态指示器 -->
                    <div class="flex items-center gap-2 mt-2">
                        <div id="userStatus" class="w-3 h-3 bg-gray-400 rounded-full"></div>
                        <span id="userStatusText" class="text-sm text-gray-600">未登录</span>
                    </div>
                </div>

                <!-- 今日运势 -->
                <div class="text-center bg-white/80 rounded-2xl p-4">
                    <div class="text-3xl mb-2">🔮</div>
                    <div class="text-sm font-medium mb-1">今日运势</div>
                    <div class="text-2xl font-bold text-[var(--labu)]" id="luckyRate">87%</div>
                    <div class="text-xs text-slate-600">抽奖大吉！</div>
                </div>
            </div>
        </section>

        <div class="grid md:grid-cols-3 gap-6">
            <!-- 左侧 - 统计信息 -->
            <div class="md:col-span-1 space-y-6">
                <!-- 个人统计 -->
                <div class="bg-white rounded-3xl p-6 shadow-sm">
                    <h3 class="font-semibold mb-4 flex items-center gap-2">
                        📊 个人统计
                    </h3>
                    <div class="space-y-4">
                        <div class="stat-card flex items-center justify-between p-3 bg-slate-50 rounded-xl">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">🎯</div>
                                <div>
                                    <div class="text-sm text-slate-600">总抽奖次数</div>
                                    <div class="font-semibold" id="totalDraws">156</div>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card flex items-center justify-between p-3 bg-slate-50 rounded-xl">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">🏆</div>
                                <div>
                                    <div class="text-sm text-slate-600">获得奖品</div>
                                    <div class="font-semibold" id="totalPrizes">89</div>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card flex items-center justify-between p-3 bg-slate-50 rounded-xl">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">💎</div>
                                <div>
                                    <div class="text-sm text-slate-600">稀有度总分</div>
                                    <div class="font-semibold" id="rarityScore">2,345</div>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card flex items-center justify-between p-3 bg-slate-50 rounded-xl">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">🔥</div>
                                <div>
                                    <div class="text-sm text-slate-600">连续签到</div>
                                    <div class="font-semibold" id="streakDays">23天</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 快速操作 -->
                <div class="bg-white rounded-3xl p-6 shadow-sm">
                    <h3 class="font-semibold mb-4 flex items-center gap-2">
                        ⚡ 快速操作
                    </h3>
                    <div class="space-y-3">
                        <button
                            class="enhanced-btn w-full p-3 bg-[var(--labu)] text-white rounded-xl flex items-center justify-center gap-2">
                            🎯 立即抽奖
                        </button>
                        <button
                            class="enhanced-btn w-full p-3 bg-slate-100 rounded-xl flex items-center justify-center gap-2">
                            🛒 前往商城
                        </button>
                        <button
                            class="enhanced-btn w-full p-3 bg-slate-100 rounded-xl flex items-center justify-center gap-2">
                            📋 查看任务
                        </button>
                        <button
                            class="enhanced-btn w-full p-3 bg-slate-100 rounded-xl flex items-center justify-center gap-2">
                            🎮 小游戏
                        </button>
                    </div>
                </div>
            </div>

            <!-- 中间 - 主要内容 -->
            <div class="md:col-span-2 space-y-6">
                <!-- 成就系统 -->
                <div class="bg-white rounded-3xl p-6 shadow-sm">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-semibold flex items-center gap-2">
                            🏅 成就徽章
                        </h3>
                        <span class="text-sm text-slate-500" id="achievementCount">8/15 已解锁</span>
                    </div>

                    <div class="grid grid-cols-5 gap-4" id="achievementGrid">
                        <!-- 成就徽章将通过JavaScript生成 -->
                    </div>
                </div>

                <!-- Labubu收藏册 -->
                <div class="bg-white rounded-3xl p-6 shadow-sm">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-semibold flex items-center gap-2">
                            📚 Labubu 收藏册
                        </h3>
                        <span class="text-sm text-slate-500" id="collectionCount">12/24 已收集</span>
                    </div>

                    <div class="grid grid-cols-6 gap-4" id="collectionGrid">
                        <!-- 收藏品将通过JavaScript生成 -->
                    </div>
                </div>

                <!-- 最近获得 -->
                <div class="bg-white rounded-3xl p-6 shadow-sm">
                    <h3 class="font-semibold mb-4 flex items-center gap-2">
                        ⭐ 最近获得
                    </h3>

                    <div class="space-y-3" id="recentPrizes">
                        <!-- 最近奖品将通过JavaScript生成 -->
                    </div>
                </div>

                <!-- 每日签到日历 -->
                <div class="bg-white rounded-3xl p-6 shadow-sm">
                    <h3 class="font-semibold mb-4 flex items-center gap-2">
                        📅 签到日历
                        <span class="text-sm font-normal text-slate-500">本月已签到 <span id="monthlyCheckins">15</span>
                            天</span>
                    </h3>

                    <div class="grid grid-cols-7 gap-2 text-center">
                        <div class="text-xs text-slate-500 p-2">日</div>
                        <div class="text-xs text-slate-500 p-2">一</div>
                        <div class="text-xs text-slate-500 p-2">二</div>
                        <div class="text-xs text-slate-500 p-2">三</div>
                        <div class="text-xs text-slate-500 p-2">四</div>
                        <div class="text-xs text-slate-500 p-2">五</div>
                        <div class="text-xs text-slate-500 p-2">六</div>

                        <div id="calendarGrid" class="col-span-7 grid grid-cols-7 gap-2">
                            <!-- 日历将通过JavaScript生成 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 登录/注册模态框 -->
    <div id="authModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl max-w-md w-full mx-4 overflow-hidden">
            <div class="p-6 border-b border-slate-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-bold text-slate-800" id="authModalTitle">登录账户</h3>
                    <button id="closeAuthModal" class="text-slate-400 hover:text-slate-600 text-2xl">×</button>
                </div>
            </div>

            <div class="p-6">
                <!-- 登录表单 -->
                <form id="loginForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">邮箱地址</label>
                        <input type="email" id="loginEmail" required
                            class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:border-[var(--labu)] focus:outline-none transition-colors">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">密码</label>
                        <input type="password" id="loginPassword" required
                            class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:border-[var(--labu)] focus:outline-none transition-colors">
                    </div>
                    <button type="submit"
                        class="w-full py-3 bg-[var(--labu)] text-white rounded-xl font-medium hover:bg-opacity-90 transition-colors">
                        登录
                    </button>
                </form>

                <!-- 注册表单 -->
                <form id="registerForm" class="space-y-4 hidden">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">用户名</label>
                        <input type="text" id="registerName" required
                            class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:border-[var(--labu)] focus:outline-none transition-colors">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">邮箱地址</label>
                        <input type="email" id="registerEmail" required
                            class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:border-[var(--labu)] focus:outline-none transition-colors">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">密码</label>
                        <input type="password" id="registerPassword" required minlength="6"
                            class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:border-[var(--labu)] focus:outline-none transition-colors">
                    </div>
                    <button type="submit"
                        class="w-full py-3 bg-[var(--labu)] text-white rounded-xl font-medium hover:bg-opacity-90 transition-colors">
                        注册
                    </button>
                </form>

                <div class="mt-4 text-center">
                    <button id="switchAuthMode" class="text-[var(--labu)] hover:underline">
                        还没有账户？立即注册
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 编辑资料模态框 -->
    <div id="editProfileModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-slate-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-bold text-slate-800">编辑个人资料</h3>
                    <button id="closeProfileModal" class="text-slate-400 hover:text-slate-600 text-2xl">×</button>
                </div>
            </div>

            <form id="profileForm" class="p-6 space-y-6">
                <!-- 头像上传 -->
                <div class="text-center">
                    <div class="relative inline-block">
                        <div id="avatarPreview"
                            class="w-24 h-24 rounded-2xl bg-slate-100 grid place-content-center text-4xl mx-auto mb-4 overflow-hidden cursor-pointer">
                            🧸
                        </div>
                        <input type="file" id="avatarUpload" accept="image/*" class="hidden">
                        <button type="button" id="uploadAvatarBtn"
                            class="absolute -bottom-1 -right-1 w-8 h-8 bg-[var(--labu)] text-white rounded-full flex items-center justify-center text-sm">
                            📷
                        </button>
                    </div>
                    <p class="text-xs text-slate-500">点击上传头像（最大2MB）</p>
                </div>

                <!-- 基本信息 -->
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">用户名</label>
                        <input type="text" id="profileName" required
                            class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:border-[var(--labu)] focus:outline-none transition-colors">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">个人简介</label>
                        <textarea id="profileBio" rows="3" placeholder="写点什么介绍一下自己..."
                            class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:border-[var(--labu)] focus:outline-none transition-colors resize-none"></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">个性签名</label>
                        <input type="text" id="profileSignature" placeholder="例如：Labubu收集家 🧸"
                            class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:border-[var(--labu)] focus:outline-none transition-colors">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">生日</label>
                        <input type="date" id="profileBirthday"
                            class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:border-[var(--labu)] focus:outline-none transition-colors">
                    </div>
                </div>

                <!-- 按钮组 -->
                <div class="flex gap-3 pt-4">
                    <button type="button" id="cancelProfile"
                        class="flex-1 py-3 px-4 border border-slate-300 text-slate-700 rounded-xl hover:bg-slate-50 transition-colors">
                        取消
                    </button>
                    <button type="submit"
                        class="flex-1 py-3 px-4 bg-[var(--labu)] text-white rounded-xl hover:bg-opacity-90 transition-colors font-medium">
                        保存
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // 工具函数
        const $ = (selector) => document.querySelector(selector);
        const $$ = (selector) => document.querySelectorAll(selector);

        // Firebase配置
        const firebaseConfig = {
            apiKey: "AIzaSyAPUti6enwvI57jiOqE3kC9SMBG4GL2FfE",
            authDomain: "labubu-lottery.firebaseapp.com",
            projectId: "llabubu- lottery - b8cfd",
            storageBucket: "labubu-lottery.appspot.com",
            messagingSenderId: "1040839447881",
            appId: "1:1040839447881:web:a25f503a3182e9b020b698"
        };

        // 初始化Firebase
        let app, auth, db, storage;
        try {
            app = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            storage = firebase.storage();
        } catch (error) {
            console.warn('Firebase初始化失败，使用本地模式:', error);
        }

        // 当前用户
        let currentUser = null;
        let isLoggedIn = false;

        // 默认用户数据
        let userData = {
            uid: null,
            name: 'Labubu收集家',
            avatar: null,
            bio: '',
            signature: 'Labubu收集家 🧸',
            birthday: null,
            level: 5,
            exp: 350,
            maxExp: 1000,
            joinDays: 127,
            totalDraws: 156,
            totalPrizes: 89,
            rarityScore: 2345,
            streakDays: 23,
            luckyRate: 87,
            createdAt: new Date(),
            updatedAt: new Date()
        };

        // 成就数据
        const achievements = [
            { id: 1, name: '初心者', icon: '🔰', description: '完成第一次抽奖', unlocked: true },
            { id: 2, name: '幸运儿', icon: '🍀', description: '连续3次抽中奖品', unlocked: true },
            { id: 3, name: '收集家', icon: '📦', description: '收集10种不同奖品', unlocked: true },
            { id: 4, name: '坚持者', icon: '💪', description: '连续签到7天', unlocked: true },
            { id: 5, name: '土豪', icon: '💰', description: '单日抽奖超过20次', unlocked: true },
            { id: 6, name: '传说', icon: '🌟', description: '抽中传说级奖品', unlocked: true },
            { id: 7, name: '社交达人', icon: '💬', description: '发表10条留言', unlocked: true },
            { id: 8, name: '购物狂', icon: '🛒', description: '商城购买满500元', unlocked: true },
            { id: 9, name: '完美主义', icon: '💎', description: '收集齐全套Labubu', unlocked: false },
            { id: 10, name: '月度之星', icon: '🌙', description: '月度抽奖次数第一', unlocked: false },
            { id: 11, name: '分享达人', icon: '📤', description: '分享给10位好友', unlocked: false },
            { id: 12, name: '评论家', icon: '📝', description: '给商品写50条评价', unlocked: false },
            { id: 13, name: '游戏高手', icon: '🎮', description: '小游戏获得满分', unlocked: false },
            { id: 14, name: '慈善家', icon: '❤️', description: '参与慈善抽奖活动', unlocked: false },
            { id: 15, name: 'Labubu之王', icon: '👑', description: '达成所有成就', unlocked: false }
        ];

        // 收藏品数据
        const collections = [
            { id: 1, name: '经典款', emoji: '🧸', owned: true, rarity: 'common' },
            { id: 2, name: '粉色梦幻', emoji: '💖', owned: true, rarity: 'common' },
            { id: 3, name: '蓝色海洋', emoji: '🌊', owned: true, rarity: 'common' },
            { id: 4, name: '绿色森林', emoji: '🌲', owned: true, rarity: 'common' },
            { id: 5, name: '彩虹系列', emoji: '🌈', owned: true, rarity: 'rare' },
            { id: 6, name: '夏日海滩', emoji: '🏖️', owned: true, rarity: 'rare' },
            { id: 7, name: '宇宙星空', emoji: '🌌', owned: true, rarity: 'rare' },
            { id: 8, name: '圣诞特别', emoji: '🎄', owned: true, rarity: 'epic' },
            { id: 9, name: '万圣节', emoji: '🎃', owned: true, rarity: 'epic' },
            { id: 10, name: '咖啡主题', emoji: '☕', owned: true, rarity: 'epic' },
            { id: 11, name: '黄金限定', emoji: '🏆', owned: true, rarity: 'legendary' },
            { id: 12, name: '钻石典藏', emoji: '💎', owned: true, rarity: 'legendary' },
            { id: 13, name: '独角兽', emoji: '🦄', owned: false, rarity: 'rare' },
            { id: 14, name: '龙年特别', emoji: '🐉', owned: false, rarity: 'epic' },
            { id: 15, name: '太空漫游', emoji: '🚀', owned: false, rarity: 'epic' },
            { id: 16, name: '魔法师', emoji: '🧙', owned: false, rarity: 'rare' },
            { id: 17, name: '机器人', emoji: '🤖', owned: false, rarity: 'common' },
            { id: 18, name: '超级英雄', emoji: '🦸', owned: false, rarity: 'epic' },
            { id: 19, name: '公主系列', emoji: '👸', owned: false, rarity: 'rare' },
            { id: 20, name: '武士道', emoji: '🥷', owned: false, rarity: 'epic' },
            { id: 21, name: '天使之翼', emoji: '👼', owned: false, rarity: 'legendary' },
            { id: 22, name: '恶魔之角', emoji: '😈', owned: false, rarity: 'legendary' },
            { id: 23, name: '时光旅者', emoji: '⏰', owned: false, rarity: 'legendary' },
            { id: 24, name: '终极形态', emoji: '🌟', owned: false, rarity: 'mythic' }
        ];

        // 最近获得奖品
        const recentPrizes = [
            { name: '钻石典藏 Labubu', emoji: '💎', rarity: 'legendary', time: '2小时前' },
            { name: '咖啡主题 Labubu', emoji: '☕', rarity: 'epic', time: '1天前' },
            { name: '3U币', emoji: '🪙', rarity: 'common', time: '2天前' },
            { name: '彩虹系列 Labubu', emoji: '🌈', rarity: 'rare', time: '3天前' },
            { name: '烤肉券', emoji: '🥩', rarity: 'common', time: '4天前' }
        ];

        // 用户认证和数据管理类
        class UserManager {
            constructor() {
                this.authModal = $('#authModal');
                this.editProfileModal = $('#editProfileModal');
                this.isLoginMode = true;
                this.initAuthListeners();
                this.initProfileListeners();
                this.setupAuthStateListener();
            }

            // 设置认证状态监听
            setupAuthStateListener() {
                if (auth) {
                    auth.onAuthStateChanged((user) => {
                        currentUser = user;
                        isLoggedIn = !!user;
                        this.updateUIForAuthState(user);

                        if (user) {
                            this.loadUserData(user.uid);
                        } else {
                            this.loadLocalData();
                        }
                    });
                } else {
                    // 如果Firebase不可用，使用本地数据
                    this.loadLocalData();
                    this.showAuthModal();
                }
            }

            // 更新UI以反映认证状态
            updateUIForAuthState(user) {
                const statusIndicator = $('#userStatus');
                const statusText = $('#userStatusText');
                const logoutBtn = $('#logoutBtn');
                const editBtn = $('#editProfileBtn');

                if (user) {
                    statusIndicator.className = 'w-3 h-3 bg-green-400 rounded-full';
                    statusText.textContent = '已登录';
                    logoutBtn.classList.remove('hidden');
                    editBtn.textContent = '✏️ 编辑资料';
                } else {
                    statusIndicator.className = 'w-3 h-3 bg-gray-400 rounded-full';
                    statusText.textContent = '未登录';
                    logoutBtn.classList.add('hidden');
                    editBtn.textContent = '🔑 登录账户';
                }
            }

            // 显示认证模态框
            showAuthModal() {
                this.authModal.classList.remove('hidden');
                this.switchToLogin();
            }

            // 隐藏认证模态框
            hideAuthModal() {
                this.authModal.classList.add('hidden');
            }

            // 切换到登录模式
            switchToLogin() {
                this.isLoginMode = true;
                $('#authModalTitle').textContent = '登录账户';
                $('#loginForm').classList.remove('hidden');
                $('#registerForm').classList.add('hidden');
                $('#switchAuthMode').textContent = '还没有账户？立即注册';
            }

            // 切换到注册模式
            switchToRegister() {
                this.isLoginMode = false;
                $('#authModalTitle').textContent = '注册账户';
                $('#loginForm').classList.add('hidden');
                $('#registerForm').classList.remove('hidden');
                $('#switchAuthMode').textContent = '已有账户？立即登录';
            }

            // 登录
            async login(email, password) {
                try {
                    if (!auth) throw new Error('Firebase未初始化');

                    const result = await auth.signInWithEmailAndPassword(email, password);
                    this.hideAuthModal();
                    this.showSuccess('登录成功！');
                    return result.user;
                } catch (error) {
                    this.showError('登录失败: ' + error.message);
                    throw error;
                }
            }

            // 注册
            async register(email, password, displayName) {
                try {
                    if (!auth) throw new Error('Firebase未初始化');

                    const result = await auth.createUserWithEmailAndPassword(email, password);

                    // 更新用户显示名
                    await result.user.updateProfile({
                        displayName: displayName
                    });

                    // 创建用户数据
                    await this.createUserData(result.user.uid, displayName);

                    this.hideAuthModal();
                    this.showSuccess('注册成功！');
                    return result.user;
                } catch (error) {
                    this.showError('注册失败: ' + error.message);
                    throw error;
                }
            }

            // 退出登录
            async logout() {
                try {
                    if (auth) {
                        await auth.signOut();
                    }
                    this.showSuccess('已退出登录');
                } catch (error) {
                    this.showError('退出失败: ' + error.message);
                }
            }

            // 创建用户数据
            async createUserData(uid, displayName) {
                if (!db) return;

                const newUserData = {
                    ...userData,
                    uid: uid,
                    name: displayName,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                try {
                    await db.collection('users').doc(uid).set(newUserData);
                    userData = newUserData;
                } catch (error) {
                    console.error('创建用户数据失败:', error);
                }
            }

            // 加载用户数据
            async loadUserData(uid) {
                if (!db) return this.loadLocalData();

                try {
                    const doc = await db.collection('users').doc(uid).get();

                    if (doc.exists) {
                        userData = { ...userData, ...doc.data() };
                    } else {
                        // 如果用户数据不存在，创建新的
                        await this.createUserData(uid, currentUser.displayName || 'Labubu收集家');
                    }

                    renderUserData();
                } catch (error) {
                    console.error('加载用户数据失败:', error);
                    this.loadLocalData();
                }
            }

            // 加载本地数据
            loadLocalData() {
                const savedData = localStorage.getItem('userData');
                if (savedData) {
                    userData = { ...userData, ...JSON.parse(savedData) };
                }
                renderUserData();
            }

            // 保存用户数据
            async saveUserData() {
                userData.updatedAt = new Date();

                // 保存到本地
                localStorage.setItem('userData', JSON.stringify(userData));

                // 保存到云端
                if (db && currentUser) {
                    try {
                        await db.collection('users').doc(currentUser.uid).update({
                            ...userData,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        this.showSuccess('数据保存成功！');
                    } catch (error) {
                        console.error('保存到云端失败:', error);
                        this.showSuccess('数据已保存到本地');
                    }
                } else {
                    this.showSuccess('数据已保存到本地');
                }
            }

            // 上传头像
            async uploadAvatar(file) {
                if (!storage || !currentUser) {
                    // 如果没有Firebase，使用Base64存储到本地
                    return new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            userData.avatar = e.target.result;
                            resolve(e.target.result);
                        };
                        reader.readAsDataURL(file);
                    });
                }

                try {
                    const storageRef = storage.ref(`avatars/${currentUser.uid}`);
                    const snapshot = await storageRef.put(file);
                    const downloadURL = await snapshot.ref.getDownloadURL();

                    userData.avatar = downloadURL;
                    return downloadURL;
                } catch (error) {
                    console.error('头像上传失败:', error);
                    throw error;
                }
            }

            // 显示成功消息
            showSuccess(message) {
                this.showNotification(message, 'success');
            }

            // 显示错误消息
            showError(message) {
                this.showNotification(message, 'error');
            }

            // 显示通知
            showNotification(message, type = 'success') {
                const notification = document.createElement('div');
                const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
                notification.className = `fixed top-4 right-4 ${bgColor} text-white px-6 py-3 rounded-xl z-50 transform translate-x-full transition-transform duration-300`;
                notification.textContent = message;
                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.style.transform = 'translateX(0)';
                }, 100);

                setTimeout(() => {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (document.body.contains(notification)) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            }

            // 初始化认证事件监听
            initAuthListeners() {
                // 关闭认证模态框
                $('#closeAuthModal').addEventListener('click', () => {
                    this.hideAuthModal();
                });

                // 切换登录/注册模式
                $('#switchAuthMode').addEventListener('click', () => {
                    if (this.isLoginMode) {
                        this.switchToRegister();
                    } else {
                        this.switchToLogin();
                    }
                });

                // 登录表单提交
                $('#loginForm').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const email = $('#loginEmail').value;
                    const password = $('#loginPassword').value;

                    try {
                        await this.login(email, password);
                    } catch (error) {
                        console.error('登录失败:', error);
                    }
                });

                // 注册表单提交
                $('#registerForm').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const name = $('#registerName').value;
                    const email = $('#registerEmail').value;
                    const password = $('#registerPassword').value;

                    try {
                        await this.register(email, password, name);
                    } catch (error) {
                        console.error('注册失败:', error);
                    }
                });

                // 退出登录
                $('#logoutBtn').addEventListener('click', () => {
                    if (confirm('确定要退出登录吗？')) {
                        this.logout();
                    }
                });
            }

            // 初始化个人资料事件监听
            initProfileListeners() {
                // 打开编辑资料模态框
                $('#editProfileBtn').addEventListener('click', () => {
                    if (isLoggedIn) {
                        this.showEditProfileModal();
                    } else {
                        this.showAuthModal();
                    }
                });

                // 头像点击编辑
                $('#avatarContainer').addEventListener('click', () => {
                    if (isLoggedIn) {
                        this.showEditProfileModal();
                    } else {
                        this.showAuthModal();
                    }
                });

                // 关闭编辑资料模态框
                $('#closeProfileModal').addEventListener('click', () => {
                    this.hideEditProfileModal();
                });

                $('#cancelProfile').addEventListener('click', () => {
                    this.hideEditProfileModal();
                });

                // 头像上传
                $('#uploadAvatarBtn').addEventListener('click', () => {
                    $('#avatarUpload').click();
                });

                $('#avatarPreview').addEventListener('click', () => {
                    $('#avatarUpload').click();
                });

                $('#avatarUpload').addEventListener('change', async (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        await this.handleAvatarUpload(file);
                    }
                });

                // 个人资料表单提交
                $('#profileForm').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    await this.handleProfileUpdate();
                });
            }

            // 显示编辑资料模态框
            showEditProfileModal() {
                // 填充当前数据
                $('#profileName').value = userData.name;
                $('#profileBio').value = userData.bio || '';
                $('#profileSignature').value = userData.signature || '';
                $('#profileBirthday').value = userData.birthday || '';

                // 设置头像预览
                this.updateAvatarPreview(userData.avatar);

                this.editProfileModal.classList.remove('hidden');
            }

            // 隐藏编辑资料模态框
            hideEditProfileModal() {
                this.editProfileModal.classList.add('hidden');
            }

            // 处理头像上传
            async handleAvatarUpload(file) {
                if (file.size > 2 * 1024 * 1024) {
                    this.showError('图片大小不能超过2MB');
                    return;
                }

                try {
                    const avatarUrl = await this.uploadAvatar(file);
                    this.updateAvatarPreview(avatarUrl);
                    this.showSuccess('头像上传成功！');
                } catch (error) {
                    this.showError('头像上传失败: ' + error.message);
                }
            }

            // 更新头像预览
            updateAvatarPreview(avatarUrl) {
                const preview = $('#avatarPreview');
                const userAvatar = $('#userAvatar');

                if (avatarUrl) {
                    const img = `<img src="${avatarUrl}" alt="头像" class="w-full h-full object-cover">`;
                    preview.innerHTML = img;
                    userAvatar.innerHTML = img;
                } else {
                    preview.innerHTML = '🧸';
                    userAvatar.innerHTML = '🧸';
                }
            }

            // 处理个人资料更新
            async handleProfileUpdate() {
                userData.name = $('#profileName').value;
                userData.bio = $('#profileBio').value;
                userData.signature = $('#profileSignature').value;
                userData.birthday = $('#profileBirthday').value;

                try {
                    await this.saveUserData();
                    renderUserData();
                    this.hideEditProfileModal();
                } catch (error) {
                    this.showError('保存失败: ' + error.message);
                }
            }
        }

        // 创建用户管理实例
        const userManager = new UserManager();

        // 初始化
        function init() {
            renderUserData();
            renderAchievements();
            renderCollection();
            renderRecentPrizes();
            renderCalendar();
            initEventListeners();
            initCustomCursor();
        }

        // 渲染用户数据
        function renderUserData() {
            $('#userName').textContent = userData.name;
            $('#userLevel').textContent = userData.level;
            $('#joinDays').textContent = userData.joinDays;
            $('#totalDraws').textContent = userData.totalDraws;
            $('#totalPrizes').textContent = userData.totalPrizes;
            $('#rarityScore').textContent = userData.rarityScore.toLocaleString();
            $('#streakDays').textContent = userData.streakDays + '天';
            $('#luckyRate').textContent = userData.luckyRate + '%';
            $('#expNeeded').textContent = `${userData.exp}/${userData.maxExp} EXP`;

            // 更新进度条
            const progressBar = $('.level-progress');
            progressBar.style.width = (userData.exp / userData.maxExp * 100) + '%';

            // 更新头像显示
            userManager.updateAvatarPreview(userData.avatar);
        }

        // 渲染成就
        function renderAchievements() {
            const grid = $('#achievementGrid');
            const unlockedCount = achievements.filter(a => a.unlocked).length;

            $('#achievementCount').textContent = `${unlockedCount}/${achievements.length} 已解锁`;

            grid.innerHTML = achievements.map(achievement => `
                <div class="achievement-badge ${achievement.unlocked ? 'achievement-unlocked' : 'achievement-locked'} 
                           w-16 h-16 rounded-2xl flex flex-col items-center justify-center text-center p-2"
                     title="${achievement.name}: ${achievement.description}">
                    <div class="text-2xl">${achievement.icon}</div>
                    <div class="text-xs font-medium mt-1">${achievement.name}</div>
                </div>
            `).join('');
        }

        // 渲染收藏册
        function renderCollection() {
            const grid = $('#collectionGrid');
            const ownedCount = collections.filter(c => c.owned).length;

            $('#collectionCount').textContent = `${ownedCount}/${collections.length} 已收集`;

            grid.innerHTML = collections.map(item => `
                <div class="collection-item ${item.owned ? 'owned' : 'not-owned'} 
                           bg-slate-50 rounded-xl p-3 text-center border ${getRarityBorder(item.rarity)}"
                     title="${item.name} - ${getRarityName(item.rarity)}">
                    <div class="text-3xl mb-1">${item.emoji}</div>
                    <div class="text-xs font-medium">${item.name}</div>
                    <div class="text-xs text-slate-500 mt-1">${getRarityName(item.rarity)}</div>
                </div>
            `).join('');
        }

        // 获取稀有度名称
        function getRarityName(rarity) {
            const names = {
                'common': '普通',
                'rare': '稀有',
                'epic': '史诗',
                'legendary': '传说',
                'mythic': '神话'
            };
            return names[rarity] || '未知';
        }

        // 获取稀有度边框
        function getRarityBorder(rarity) {
            const borders = {
                'common': 'border-slate-300',
                'rare': 'border-blue-400',
                'epic': 'border-purple-400',
                'legendary': 'border-yellow-400',
                'mythic': 'border-red-400'
            };
            return borders[rarity] || 'border-slate-300';
        }

        // 渲染最近奖品
        function renderRecentPrizes() {
            const container = $('#recentPrizes');

            container.innerHTML = recentPrizes.map(prize => `
                <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl">
                    <div class="text-2xl">${prize.emoji}</div>
                    <div class="flex-1">
                        <div class="font-medium">${prize.name}</div>
                        <div class="text-sm text-slate-500">${getRarityName(prize.rarity)} • ${prize.time}</div>
                    </div>
                </div>
            `).join('');
        }

        // 渲染签到日历
        function renderCalendar() {
            const grid = $('#calendarGrid');
            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const firstDay = new Date(year, month, 1).getDay();

            // 获取签到记录
            const checkinHistory = JSON.parse(localStorage.getItem('checkinHistory') || '{}');
            const todayString = today.toDateString();
            const lastCheckin = localStorage.getItem('lastCheckin');

            let html = '';
            let signedCount = 0;

            // 填充空白日期
            for (let i = 0; i < firstDay; i++) {
                html += '<div></div>';
            }

            // 填充实际日期
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateString = date.toDateString();
                const isToday = day === today.getDate();
                const isSigned = checkinHistory[dateString] || (dateString === lastCheckin);

                if (isSigned) signedCount++;

                html += `
                    <div class="calendar-day w-8 h-8 rounded-lg flex items-center justify-center text-sm font-medium
                               ${isToday ? 'today' : ''} ${isSigned ? 'signed' : 'bg-slate-100'}">
                        ${day}
                    </div>
                `;
            }

            grid.innerHTML = html;

            // 更新签到统计
            $('#monthlyCheckins').textContent = signedCount;
        }

        // 初始化事件监听
        function initEventListeners() {
            // 每日签到按钮
            $('#dailyCheckinBtn').addEventListener('click', () => {
                performDailyCheckin();
            });

            // 快速操作按钮
            $$('.enhanced-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (btn.textContent.includes('立即抽奖')) {
                        window.location.href = 'index.html#draw';
                    } else if (btn.textContent.includes('前往商城')) {
                        window.location.href = 'shop.html';
                    } else if (btn.textContent.includes('查看任务')) {
                        window.location.href = 'tasks.html';
                    } else if (btn.textContent.includes('小游戏')) {
                        window.location.href = 'games.html';
                    }
                });
            });

            // 成就悬浮效果
            $$('.achievement-badge').forEach(badge => {
                badge.addEventListener('mouseenter', () => {
                    createMagicParticles(badge.getBoundingClientRect().left + 32, badge.getBoundingClientRect().top + 32);
                });
            });
        }

        // 执行每日签到
        async function performDailyCheckin() {
            // 检查今日是否已签到
            const today = new Date().toDateString();
            const lastCheckin = localStorage.getItem('lastCheckin');

            if (lastCheckin === today) {
                userManager.showError('今日已签到，请明天再来！');
                return;
            }

            // 更新用户经验
            userData.exp += 10;
            userData.streakDays += 1;

            let leveledUp = false;
            if (userData.exp >= userData.maxExp) {
                userData.level++;
                userData.exp = userData.exp - userData.maxExp;
                userData.maxExp = Math.floor(userData.maxExp * 1.2);
                leveledUp = true;
            }

            // 保存签到记录
            localStorage.setItem('lastCheckin', today);

            // 保存到签到历史
            const checkinHistory = JSON.parse(localStorage.getItem('checkinHistory') || '{}');
            checkinHistory[today] = true;
            localStorage.setItem('checkinHistory', JSON.stringify(checkinHistory));

            // 保存用户数据
            try {
                await userManager.saveUserData();
            } catch (error) {
                console.error('保存签到数据失败:', error);
            }

            // 显示签到成功提示
            userManager.showSuccess('✅ 签到成功！获得 10 EXP');

            // 如果升级了，显示升级提示
            if (leveledUp) {
                setTimeout(() => {
                    const levelUp = document.createElement('div');
                    levelUp.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
                    levelUp.innerHTML = `
                        <div class="bg-white rounded-3xl p-8 text-center animate-bounce">
                            <div class="text-6xl mb-4">🎉</div>
                            <div class="text-2xl font-bold text-[var(--labu)] mb-2">恭喜升级！</div>
                            <div class="text-lg">您现在是 Lv.${userData.level} 了！</div>
                        </div>
                    `;
                    document.body.appendChild(levelUp);

                    setTimeout(() => {
                        if (document.body.contains(levelUp)) {
                            document.body.removeChild(levelUp);
                        }
                    }, 3000);
                }, 1000);
            }

            renderUserData();
            renderCalendar(); // 重新渲染日历以显示今日签到
        }

        // 自定义鼠标效果
        function initCustomCursor() {
            const cursor = $('.custom-cursor');
            let mouseX = 0, mouseY = 0;

            document.addEventListener('mousemove', (e) => {
                mouseX = e.clientX;
                mouseY = e.clientY;
                cursor.style.left = mouseX + 'px';
                cursor.style.top = mouseY + 'px';

                createCursorTrail(mouseX, mouseY);
            });

            document.addEventListener('mousedown', () => {
                cursor.classList.add('clicking');
            });

            document.addEventListener('mouseup', () => {
                cursor.classList.remove('clicking');
            });
        }

        function createCursorTrail(x, y) {
            const trail = document.createElement('div');
            trail.className = 'cursor-trail';
            trail.style.left = (x - 4) + 'px';
            trail.style.top = (y - 4) + 'px';
            document.body.appendChild(trail);

            setTimeout(() => {
                if (document.body.contains(trail)) {
                    document.body.removeChild(trail);
                }
            }, 500);
        }

        function createMagicParticles(x, y) {
            for (let i = 0; i < 6; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'magic-particle';
                    particle.style.left = (x + Math.random() * 40 - 20) + 'px';
                    particle.style.top = (y + Math.random() * 40 - 20) + 'px';
                    document.body.appendChild(particle);

                    setTimeout(() => {
                        if (document.body.contains(particle)) {
                            document.body.removeChild(particle);
                        }
                    }, 2000);
                }, i * 50);
            }
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>