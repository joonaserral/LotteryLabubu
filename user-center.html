<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªäººä¸­å¿ƒ - Labubu å¹¸è¿æŠ½å¥– ğŸ§¸</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ§¸</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    <style>
        :root {
            --labu: #6b5b95;
            --labu2: #ffcc00;
        }

        .labu-gradient {
            background-image: linear-gradient(135deg, rgba(107, 91, 149, .15), rgba(255, 204, 0, .15));
        }

        .sparkle {
            animation: sparkle 2s ease-in-out infinite alternate;
        }

        @keyframes sparkle {
            0% {
                transform: scale(1) rotate(0deg);
            }

            100% {
                transform: scale(1.1) rotate(5deg);
            }
        }

        /* è‡ªå®šä¹‰é¼ æ ‡æ ·å¼ */
        * {
            cursor: none !important;
        }

        /* æ¢å¤æ–‡æœ¬è¾“å…¥å…ƒç´ çš„å…‰æ ‡ */
        input,
        textarea,
        [contenteditable="true"],
        .text-input {
            cursor: text !important;
        }

        /* æ¢å¤å¯ç‚¹å‡»å…ƒç´ çš„å…‰æ ‡ */
        button,
        a,
        [role="button"],
        .cursor-pointer,
        select {
            cursor: pointer !important;
        }

        .custom-cursor {
            position: fixed;
            width: 20px;
            height: 20px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ff69b4"><path d="M8 2C8 2 8.5 3 10.5 3C12.5 3 13 2 13 2C14 2 15 3 15 4C15 5 14 6 13 6C12 6 11 7 11 8C11 9 12 10 13 10C14 10 15 9 15 8C15 7 16 6 17 6C18 6 19 7 19 8C19 9 18 10 17 10C16 10 15 11 15 12C15 13 16 14 17 14C18 14 19 13 19 12C19 11 20 10 21 10C22 10 23 11 23 12C23 13 22 14 21 14C20 14 19 15 19 16C19 17 18 18 17 18C16 18 15 17 15 16C15 15 14 14 13 14C12 14 11 15 11 16C11 17 10 18 9 18C8 18 7 17 7 16C7 15 8 14 9 14C10 14 11 13 11 12C11 11 10 10 9 10C8 10 7 11 7 12C7 13 6 14 5 14C4 14 3 13 3 12C3 11 4 10 5 10C6 10 7 9 7 8C7 7 6 6 5 6C4 6 3 7 3 8C3 9 2 10 1 10C0 10 -1 9 -1 8C-1 7 0 6 1 6C2 6 3 5 3 4C3 3 4 2 5 2C6 2 7 3 7 4C7 5 8 6 9 6C10 6 11 5 11 4C11 3 10 2 9 2C8.5 2 8 2 8 2Z"/></svg>') no-repeat center;
            background-size: contain;
            pointer-events: none;
            z-index: 9999;
            transition: transform 0.1s ease;
            transform: translate(-50%, -50%);
        }

        .custom-cursor.clicking {
            transform: translate(-50%, -50%) scale(1.2);
        }

        .cursor-trail {
            position: fixed;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, rgba(255, 105, 180, 0.8) 0%, rgba(255, 105, 180, 0) 70%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9998;
            animation: cursorTrailFade 0.5s ease-out forwards;
        }

        @keyframes cursorTrailFade {
            0% {
                opacity: 1;
                transform: scale(1);
            }

            100% {
                opacity: 0;
                transform: scale(0.3);
            }
        }

        /* ç­‰çº§è¿›åº¦æ¡ */
        .level-progress {
            background: linear-gradient(90deg, var(--labu) 0%, var(--labu2) 100%);
            height: 8px;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* æˆå°±å¾½ç«  */
        .achievement-badge {
            transition: all 0.3s ease;
        }

        .achievement-badge:hover {
            transform: scale(1.1) rotate(5deg);
        }

        .achievement-unlocked {
            background: linear-gradient(45deg, #ffd700, #ffed4a);
            color: #8b5a00;
        }

        .achievement-locked {
            background: #e2e8f0;
            color: #64748b;
        }

        /* ç»Ÿè®¡å¡ç‰‡åŠ¨ç”» */
        .stat-card {
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
        }

        /* ç­¾åˆ°æ—¥å† */
        .calendar-day {
            transition: all 0.3s ease;
        }

        .calendar-day.signed {
            background: linear-gradient(45deg, var(--labu), var(--labu2));
            color: white;
        }

        .calendar-day.today {
            border: 2px solid var(--labu);
            box-shadow: 0 0 10px rgba(107, 91, 149, 0.3);
        }

        /* æŒ‰é’®å¢å¼ºæ•ˆæœ */
        .enhanced-btn {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .enhanced-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .enhanced-btn:hover::before {
            left: 100%;
        }

        .enhanced-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(107, 91, 149, 0.3);
        }

        /* æ”¶è—å“å±•ç¤º */
        .collection-item {
            transition: all 0.3s ease;
            position: relative;
        }

        .collection-item:hover {
            transform: scale(1.05);
        }

        .collection-item.owned {
            opacity: 1;
        }

        .collection-item.not-owned {
            opacity: 0.3;
            filter: grayscale(100%);
        }

        /* ç²’å­æ•ˆæœ */
        .magic-particle {
            position: fixed;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, #ffd700 0%, #ff69b4 50%, transparent 100%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9997;
            animation: magicParticle 2s ease-out forwards;
        }

        @keyframes magicParticle {
            0% {
                opacity: 1;
                transform: scale(0) rotate(0deg);
            }

            50% {
                opacity: 1;
                transform: scale(1) rotate(180deg);
            }

            100% {
                opacity: 0;
                transform: scale(0.2) rotate(360deg) translateY(-50px);
            }
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-900">
    <!-- è‡ªå®šä¹‰é¼ æ ‡å…‰æ ‡ -->
    <div class="custom-cursor"></div>

    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <header class="sticky top-0 z-30 backdrop-blur bg-white/90 border-b border-slate-200 shadow-sm">
        <div class="max-w-6xl mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div
                        class="w-10 h-10 rounded-xl bg-[var(--labu)] grid place-content-center text-white text-xl sparkle">
                        ğŸ§¸</div>
                    <div>
                        <h1 class="font-bold text-lg">ä¸ªäººä¸­å¿ƒ</h1>
                        <p class="text-xs text-slate-500">Labubu æ”¶é›†å®¶ âœ¨</p>
                    </div>
                </div>
                <nav class="flex items-center gap-6">
                    <a href="index.html" class="text-slate-600 hover:text-[var(--labu)] transition-colors">ğŸ¯ æŠ½å¥–</a>
                    <a href="shop.html" class="text-slate-600 hover:text-[var(--labu)] transition-colors">ğŸ›’ å•†åŸ</a>
                    <a href="tasks.html" class="text-slate-600 hover:text-[var(--labu)] transition-colors">ğŸ“‹ ä»»åŠ¡</a>
                </nav>
            </div>
        </div>
    </header>

    <div class="max-w-6xl mx-auto px-4 py-8">
        <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
        <section class="labu-gradient rounded-3xl p-8 mb-8">
            <div class="flex items-center gap-6">
                <div class="relative group cursor-pointer" id="avatarContainer">
                    <div class="w-24 h-24 rounded-2xl bg-white/80 grid place-content-center text-4xl sparkle overflow-hidden"
                        id="userAvatar">
                        ğŸ§¸
                    </div>
                    <div
                        class="absolute inset-0 bg-black/50 rounded-2xl flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                        <span class="text-white text-xs">ç‚¹å‡»ç¼–è¾‘</span>
                    </div>
                </div>
                <div class="flex-1">
                    <div class="flex items-center gap-3 mb-2">
                        <h2 class="text-2xl font-bold" id="userName">Labubuæ”¶é›†å®¶</h2>
                        <div class="px-3 py-1 bg-[var(--labu)] text-white rounded-full text-sm font-medium">
                            Lv.<span id="userLevel">5</span>
                        </div>
                    </div>
                    <p class="text-slate-600 mb-3">å·²åŠ å…¥ <span id="joinDays">127</span> å¤© | ä»Šæ—¥æ´»è·ƒåº¦ <span
                            class="text-[var(--labu)] font-semibold">85%</span></p>

                    <!-- ç­‰çº§è¿›åº¦æ¡ -->
                    <div class="mb-4">
                        <div class="flex justify-between text-sm mb-1">
                            <span>è·ç¦»ä¸‹ä¸€çº§è¿˜éœ€</span>
                            <span id="expNeeded">350/1000 EXP</span>
                        </div>
                        <div class="w-full bg-white/50 rounded-full h-2">
                            <div class="level-progress w-1/3"></div>
                        </div>
                    </div>

                    <div class="flex gap-4">
                        <button id="editProfileBtn" class="enhanced-btn px-4 py-2 bg-white/80 rounded-xl font-medium">âœï¸
                            ç¼–è¾‘èµ„æ–™</button>
                        <button id="dailyCheckinBtn"
                            class="enhanced-btn px-4 py-2 bg-[var(--labu)] text-white rounded-xl font-medium">ğŸ
                            æ¯æ—¥ç­¾åˆ°</button>
                        <button id="logoutBtn"
                            class="enhanced-btn px-4 py-2 bg-red-500 text-white rounded-xl font-medium hidden">ğŸšª
                            é€€å‡ºç™»å½•</button>
                    </div>

                    <!-- ç”¨æˆ·çŠ¶æ€æŒ‡ç¤ºå™¨ -->
                    <div class="flex items-center gap-2 mt-2">
                        <div id="userStatus" class="w-3 h-3 bg-gray-400 rounded-full"></div>
                        <span id="userStatusText" class="text-sm text-gray-600">æœªç™»å½•</span>
                    </div>
                </div>

                <!-- ä»Šæ—¥è¿åŠ¿ -->
                <div class="text-center bg-white/80 rounded-2xl p-4">
                    <div class="text-3xl mb-2">ğŸ”®</div>
                    <div class="text-sm font-medium mb-1">ä»Šæ—¥è¿åŠ¿</div>
                    <div class="text-2xl font-bold text-[var(--labu)]" id="luckyRate">87%</div>
                    <div class="text-xs text-slate-600">æŠ½å¥–å¤§å‰ï¼</div>
                </div>
            </div>
        </section>

        <div class="grid md:grid-cols-3 gap-6">
            <!-- å·¦ä¾§ - ç»Ÿè®¡ä¿¡æ¯ -->
            <div class="md:col-span-1 space-y-6">
                <!-- ä¸ªäººç»Ÿè®¡ -->
                <div class="bg-white rounded-3xl p-6 shadow-sm">
                    <h3 class="font-semibold mb-4 flex items-center gap-2">
                        ğŸ“Š ä¸ªäººç»Ÿè®¡
                    </h3>
                    <div class="space-y-4">
                        <div class="stat-card flex items-center justify-between p-3 bg-slate-50 rounded-xl">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">ğŸ¯</div>
                                <div>
                                    <div class="text-sm text-slate-600">æ€»æŠ½å¥–æ¬¡æ•°</div>
                                    <div class="font-semibold" id="totalDraws">156</div>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card flex items-center justify-between p-3 bg-slate-50 rounded-xl">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">ğŸ†</div>
                                <div>
                                    <div class="text-sm text-slate-600">è·å¾—å¥–å“</div>
                                    <div class="font-semibold" id="totalPrizes">89</div>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card flex items-center justify-between p-3 bg-slate-50 rounded-xl">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">ğŸ’</div>
                                <div>
                                    <div class="text-sm text-slate-600">ç¨€æœ‰åº¦æ€»åˆ†</div>
                                    <div class="font-semibold" id="rarityScore">2,345</div>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card flex items-center justify-between p-3 bg-slate-50 rounded-xl">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">ğŸ”¥</div>
                                <div>
                                    <div class="text-sm text-slate-600">è¿ç»­ç­¾åˆ°</div>
                                    <div class="font-semibold" id="streakDays">23å¤©</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å¿«é€Ÿæ“ä½œ -->
                <div class="bg-white rounded-3xl p-6 shadow-sm">
                    <h3 class="font-semibold mb-4 flex items-center gap-2">
                        âš¡ å¿«é€Ÿæ“ä½œ
                    </h3>
                    <div class="space-y-3">
                        <button
                            class="enhanced-btn w-full p-3 bg-[var(--labu)] text-white rounded-xl flex items-center justify-center gap-2">
                            ğŸ¯ ç«‹å³æŠ½å¥–
                        </button>
                        <button
                            class="enhanced-btn w-full p-3 bg-slate-100 rounded-xl flex items-center justify-center gap-2">
                            ğŸ›’ å‰å¾€å•†åŸ
                        </button>
                        <button
                            class="enhanced-btn w-full p-3 bg-slate-100 rounded-xl flex items-center justify-center gap-2">
                            ğŸ“‹ æŸ¥çœ‹ä»»åŠ¡
                        </button>
                        <button
                            class="enhanced-btn w-full p-3 bg-slate-100 rounded-xl flex items-center justify-center gap-2">
                            ğŸ® å°æ¸¸æˆ
                        </button>
                    </div>
                </div>
            </div>

            <!-- ä¸­é—´ - ä¸»è¦å†…å®¹ -->
            <div class="md:col-span-2 space-y-6">
                <!-- æˆå°±ç³»ç»Ÿ -->
                <div class="bg-white rounded-3xl p-6 shadow-sm">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-semibold flex items-center gap-2">
                            ğŸ… æˆå°±å¾½ç« 
                        </h3>
                        <span class="text-sm text-slate-500" id="achievementCount">8/15 å·²è§£é”</span>
                    </div>

                    <div class="grid grid-cols-5 gap-4" id="achievementGrid">
                        <!-- æˆå°±å¾½ç« å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                    </div>
                </div>

                <!-- Labubuæ”¶è—å†Œ -->
                <div class="bg-white rounded-3xl p-6 shadow-sm">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-semibold flex items-center gap-2">
                            ğŸ“š Labubu æ”¶è—å†Œ
                        </h3>
                        <span class="text-sm text-slate-500" id="collectionCount">12/24 å·²æ”¶é›†</span>
                    </div>

                    <div class="grid grid-cols-6 gap-4" id="collectionGrid">
                        <!-- æ”¶è—å“å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                    </div>
                </div>

                <!-- æœ€è¿‘è·å¾— -->
                <div class="bg-white rounded-3xl p-6 shadow-sm">
                    <h3 class="font-semibold mb-4 flex items-center gap-2">
                        â­ æœ€è¿‘è·å¾—
                    </h3>

                    <div class="space-y-3" id="recentPrizes">
                        <!-- æœ€è¿‘å¥–å“å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                    </div>
                </div>

                <!-- æ¯æ—¥ç­¾åˆ°æ—¥å† -->
                <div class="bg-white rounded-3xl p-6 shadow-sm">
                    <h3 class="font-semibold mb-4 flex items-center gap-2">
                        ğŸ“… ç­¾åˆ°æ—¥å†
                        <span class="text-sm font-normal text-slate-500">æœ¬æœˆå·²ç­¾åˆ° <span id="monthlyCheckins">15</span>
                            å¤©</span>
                    </h3>

                    <div class="grid grid-cols-7 gap-2 text-center">
                        <div class="text-xs text-slate-500 p-2">æ—¥</div>
                        <div class="text-xs text-slate-500 p-2">ä¸€</div>
                        <div class="text-xs text-slate-500 p-2">äºŒ</div>
                        <div class="text-xs text-slate-500 p-2">ä¸‰</div>
                        <div class="text-xs text-slate-500 p-2">å››</div>
                        <div class="text-xs text-slate-500 p-2">äº”</div>
                        <div class="text-xs text-slate-500 p-2">å…­</div>

                        <div id="calendarGrid" class="col-span-7 grid grid-cols-7 gap-2">
                            <!-- æ—¥å†å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç™»å½•/æ³¨å†Œæ¨¡æ€æ¡† -->
    <div id="authModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl max-w-md w-full mx-4 overflow-hidden">
            <div class="p-6 border-b border-slate-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-bold text-slate-800" id="authModalTitle">ç™»å½•è´¦æˆ·</h3>
                    <button id="closeAuthModal" class="text-slate-400 hover:text-slate-600 text-2xl">Ã—</button>
                </div>
            </div>

            <div class="p-6">
                <!-- ç™»å½•è¡¨å• -->
                <form id="loginForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">é‚®ç®±åœ°å€</label>
                        <input type="email" id="loginEmail" required
                            class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:border-[var(--labu)] focus:outline-none transition-colors">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">å¯†ç </label>
                        <input type="password" id="loginPassword" required
                            class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:border-[var(--labu)] focus:outline-none transition-colors">
                    </div>
                    <button type="submit"
                        class="w-full py-3 bg-[var(--labu)] text-white rounded-xl font-medium hover:bg-opacity-90 transition-colors">
                        ç™»å½•
                    </button>
                </form>

                <!-- æ³¨å†Œè¡¨å• -->
                <form id="registerForm" class="space-y-4 hidden">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">ç”¨æˆ·å</label>
                        <input type="text" id="registerName" required
                            class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:border-[var(--labu)] focus:outline-none transition-colors">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">é‚®ç®±åœ°å€</label>
                        <input type="email" id="registerEmail" required
                            class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:border-[var(--labu)] focus:outline-none transition-colors">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">å¯†ç </label>
                        <input type="password" id="registerPassword" required minlength="6"
                            class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:border-[var(--labu)] focus:outline-none transition-colors">
                    </div>
                    <button type="submit"
                        class="w-full py-3 bg-[var(--labu)] text-white rounded-xl font-medium hover:bg-opacity-90 transition-colors">
                        æ³¨å†Œ
                    </button>
                </form>

                <div class="mt-4 text-center">
                    <button id="switchAuthMode" class="text-[var(--labu)] hover:underline">
                        è¿˜æ²¡æœ‰è´¦æˆ·ï¼Ÿç«‹å³æ³¨å†Œ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘èµ„æ–™æ¨¡æ€æ¡† -->
    <div id="editProfileModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-slate-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-bold text-slate-800">ç¼–è¾‘ä¸ªäººèµ„æ–™</h3>
                    <button id="closeProfileModal" class="text-slate-400 hover:text-slate-600 text-2xl">Ã—</button>
                </div>
            </div>

            <form id="profileForm" class="p-6 space-y-6">
                <!-- å¤´åƒä¸Šä¼  -->
                <div class="text-center">
                    <div class="relative inline-block">
                        <div id="avatarPreview"
                            class="w-24 h-24 rounded-2xl bg-slate-100 grid place-content-center text-4xl mx-auto mb-4 overflow-hidden cursor-pointer">
                            ğŸ§¸
                        </div>
                        <input type="file" id="avatarUpload" accept="image/*" class="hidden">
                        <button type="button" id="uploadAvatarBtn"
                            class="absolute -bottom-1 -right-1 w-8 h-8 bg-[var(--labu)] text-white rounded-full flex items-center justify-center text-sm">
                            ğŸ“·
                        </button>
                    </div>
                    <p class="text-xs text-slate-500">ç‚¹å‡»ä¸Šä¼ å¤´åƒï¼ˆæœ€å¤§2MBï¼‰</p>
                </div>

                <!-- åŸºæœ¬ä¿¡æ¯ -->
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">ç”¨æˆ·å</label>
                        <input type="text" id="profileName" required
                            class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:border-[var(--labu)] focus:outline-none transition-colors">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">ä¸ªäººç®€ä»‹</label>
                        <textarea id="profileBio" rows="3" placeholder="å†™ç‚¹ä»€ä¹ˆä»‹ç»ä¸€ä¸‹è‡ªå·±..."
                            class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:border-[var(--labu)] focus:outline-none transition-colors resize-none"></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">ä¸ªæ€§ç­¾å</label>
                        <input type="text" id="profileSignature" placeholder="ä¾‹å¦‚ï¼šLabubuæ”¶é›†å®¶ ğŸ§¸"
                            class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:border-[var(--labu)] focus:outline-none transition-colors">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">ç”Ÿæ—¥</label>
                        <input type="date" id="profileBirthday"
                            class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:border-[var(--labu)] focus:outline-none transition-colors">
                    </div>
                </div>

                <!-- æŒ‰é’®ç»„ -->
                <div class="flex gap-3 pt-4">
                    <button type="button" id="cancelProfile"
                        class="flex-1 py-3 px-4 border border-slate-300 text-slate-700 rounded-xl hover:bg-slate-50 transition-colors">
                        å–æ¶ˆ
                    </button>
                    <button type="submit"
                        class="flex-1 py-3 px-4 bg-[var(--labu)] text-white rounded-xl hover:bg-opacity-90 transition-colors font-medium">
                        ä¿å­˜
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // å·¥å…·å‡½æ•°
        const $ = (selector) => document.querySelector(selector);
        const $$ = (selector) => document.querySelectorAll(selector);

        // Firebaseé…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyAPUti6enwvI57jiOqE3kC9SMBG4GL2FfE",
            authDomain: "labubu-lottery.firebaseapp.com",
            projectId: "llabubu- lottery - b8cfd",
            storageBucket: "labubu-lottery.appspot.com",
            messagingSenderId: "1040839447881",
            appId: "1:1040839447881:web:a25f503a3182e9b020b698"
        };

        // åˆå§‹åŒ–Firebase
        let app, auth, db, storage;
        try {
            app = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            storage = firebase.storage();
        } catch (error) {
            console.warn('Firebaseåˆå§‹åŒ–å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ¨¡å¼:', error);
        }

        // å½“å‰ç”¨æˆ·
        let currentUser = null;
        let isLoggedIn = false;

        // é»˜è®¤ç”¨æˆ·æ•°æ®
        let userData = {
            uid: null,
            name: 'Labubuæ”¶é›†å®¶',
            avatar: null,
            bio: '',
            signature: 'Labubuæ”¶é›†å®¶ ğŸ§¸',
            birthday: null,
            level: 5,
            exp: 350,
            maxExp: 1000,
            joinDays: 127,
            totalDraws: 156,
            totalPrizes: 89,
            rarityScore: 2345,
            streakDays: 23,
            luckyRate: 87,
            createdAt: new Date(),
            updatedAt: new Date()
        };

        // æˆå°±æ•°æ®
        const achievements = [
            { id: 1, name: 'åˆå¿ƒè€…', icon: 'ğŸ”°', description: 'å®Œæˆç¬¬ä¸€æ¬¡æŠ½å¥–', unlocked: true },
            { id: 2, name: 'å¹¸è¿å„¿', icon: 'ğŸ€', description: 'è¿ç»­3æ¬¡æŠ½ä¸­å¥–å“', unlocked: true },
            { id: 3, name: 'æ”¶é›†å®¶', icon: 'ğŸ“¦', description: 'æ”¶é›†10ç§ä¸åŒå¥–å“', unlocked: true },
            { id: 4, name: 'åšæŒè€…', icon: 'ğŸ’ª', description: 'è¿ç»­ç­¾åˆ°7å¤©', unlocked: true },
            { id: 5, name: 'åœŸè±ª', icon: 'ğŸ’°', description: 'å•æ—¥æŠ½å¥–è¶…è¿‡20æ¬¡', unlocked: true },
            { id: 6, name: 'ä¼ è¯´', icon: 'ğŸŒŸ', description: 'æŠ½ä¸­ä¼ è¯´çº§å¥–å“', unlocked: true },
            { id: 7, name: 'ç¤¾äº¤è¾¾äºº', icon: 'ğŸ’¬', description: 'å‘è¡¨10æ¡ç•™è¨€', unlocked: true },
            { id: 8, name: 'è´­ç‰©ç‹‚', icon: 'ğŸ›’', description: 'å•†åŸè´­ä¹°æ»¡500å…ƒ', unlocked: true },
            { id: 9, name: 'å®Œç¾ä¸»ä¹‰', icon: 'ğŸ’', description: 'æ”¶é›†é½å…¨å¥—Labubu', unlocked: false },
            { id: 10, name: 'æœˆåº¦ä¹‹æ˜Ÿ', icon: 'ğŸŒ™', description: 'æœˆåº¦æŠ½å¥–æ¬¡æ•°ç¬¬ä¸€', unlocked: false },
            { id: 11, name: 'åˆ†äº«è¾¾äºº', icon: 'ğŸ“¤', description: 'åˆ†äº«ç»™10ä½å¥½å‹', unlocked: false },
            { id: 12, name: 'è¯„è®ºå®¶', icon: 'ğŸ“', description: 'ç»™å•†å“å†™50æ¡è¯„ä»·', unlocked: false },
            { id: 13, name: 'æ¸¸æˆé«˜æ‰‹', icon: 'ğŸ®', description: 'å°æ¸¸æˆè·å¾—æ»¡åˆ†', unlocked: false },
            { id: 14, name: 'æ…ˆå–„å®¶', icon: 'â¤ï¸', description: 'å‚ä¸æ…ˆå–„æŠ½å¥–æ´»åŠ¨', unlocked: false },
            { id: 15, name: 'Labubuä¹‹ç‹', icon: 'ğŸ‘‘', description: 'è¾¾æˆæ‰€æœ‰æˆå°±', unlocked: false }
        ];

        // æ”¶è—å“æ•°æ®
        const collections = [
            { id: 1, name: 'ç»å…¸æ¬¾', emoji: 'ğŸ§¸', owned: true, rarity: 'common' },
            { id: 2, name: 'ç²‰è‰²æ¢¦å¹»', emoji: 'ğŸ’–', owned: true, rarity: 'common' },
            { id: 3, name: 'è“è‰²æµ·æ´‹', emoji: 'ğŸŒŠ', owned: true, rarity: 'common' },
            { id: 4, name: 'ç»¿è‰²æ£®æ—', emoji: 'ğŸŒ²', owned: true, rarity: 'common' },
            { id: 5, name: 'å½©è™¹ç³»åˆ—', emoji: 'ğŸŒˆ', owned: true, rarity: 'rare' },
            { id: 6, name: 'å¤æ—¥æµ·æ»©', emoji: 'ğŸ–ï¸', owned: true, rarity: 'rare' },
            { id: 7, name: 'å®‡å®™æ˜Ÿç©º', emoji: 'ğŸŒŒ', owned: true, rarity: 'rare' },
            { id: 8, name: 'åœ£è¯ç‰¹åˆ«', emoji: 'ğŸ„', owned: true, rarity: 'epic' },
            { id: 9, name: 'ä¸‡åœ£èŠ‚', emoji: 'ğŸƒ', owned: true, rarity: 'epic' },
            { id: 10, name: 'å’–å•¡ä¸»é¢˜', emoji: 'â˜•', owned: true, rarity: 'epic' },
            { id: 11, name: 'é»„é‡‘é™å®š', emoji: 'ğŸ†', owned: true, rarity: 'legendary' },
            { id: 12, name: 'é’»çŸ³å…¸è—', emoji: 'ğŸ’', owned: true, rarity: 'legendary' },
            { id: 13, name: 'ç‹¬è§’å…½', emoji: 'ğŸ¦„', owned: false, rarity: 'rare' },
            { id: 14, name: 'é¾™å¹´ç‰¹åˆ«', emoji: 'ğŸ‰', owned: false, rarity: 'epic' },
            { id: 15, name: 'å¤ªç©ºæ¼«æ¸¸', emoji: 'ğŸš€', owned: false, rarity: 'epic' },
            { id: 16, name: 'é­”æ³•å¸ˆ', emoji: 'ğŸ§™', owned: false, rarity: 'rare' },
            { id: 17, name: 'æœºå™¨äºº', emoji: 'ğŸ¤–', owned: false, rarity: 'common' },
            { id: 18, name: 'è¶…çº§è‹±é›„', emoji: 'ğŸ¦¸', owned: false, rarity: 'epic' },
            { id: 19, name: 'å…¬ä¸»ç³»åˆ—', emoji: 'ğŸ‘¸', owned: false, rarity: 'rare' },
            { id: 20, name: 'æ­¦å£«é“', emoji: 'ğŸ¥·', owned: false, rarity: 'epic' },
            { id: 21, name: 'å¤©ä½¿ä¹‹ç¿¼', emoji: 'ğŸ‘¼', owned: false, rarity: 'legendary' },
            { id: 22, name: 'æ¶é­”ä¹‹è§’', emoji: 'ğŸ˜ˆ', owned: false, rarity: 'legendary' },
            { id: 23, name: 'æ—¶å…‰æ—…è€…', emoji: 'â°', owned: false, rarity: 'legendary' },
            { id: 24, name: 'ç»ˆæå½¢æ€', emoji: 'ğŸŒŸ', owned: false, rarity: 'mythic' }
        ];

        // æœ€è¿‘è·å¾—å¥–å“
        const recentPrizes = [
            { name: 'é’»çŸ³å…¸è— Labubu', emoji: 'ğŸ’', rarity: 'legendary', time: '2å°æ—¶å‰' },
            { name: 'å’–å•¡ä¸»é¢˜ Labubu', emoji: 'â˜•', rarity: 'epic', time: '1å¤©å‰' },
            { name: '3Uå¸', emoji: 'ğŸª™', rarity: 'common', time: '2å¤©å‰' },
            { name: 'å½©è™¹ç³»åˆ— Labubu', emoji: 'ğŸŒˆ', rarity: 'rare', time: '3å¤©å‰' },
            { name: 'çƒ¤è‚‰åˆ¸', emoji: 'ğŸ¥©', rarity: 'common', time: '4å¤©å‰' }
        ];

        // ç”¨æˆ·è®¤è¯å’Œæ•°æ®ç®¡ç†ç±»
        class UserManager {
            constructor() {
                this.authModal = $('#authModal');
                this.editProfileModal = $('#editProfileModal');
                this.isLoginMode = true;
                this.initAuthListeners();
                this.initProfileListeners();
                this.setupAuthStateListener();
            }

            // è®¾ç½®è®¤è¯çŠ¶æ€ç›‘å¬
            setupAuthStateListener() {
                if (auth) {
                    auth.onAuthStateChanged((user) => {
                        currentUser = user;
                        isLoggedIn = !!user;
                        this.updateUIForAuthState(user);

                        if (user) {
                            this.loadUserData(user.uid);
                        } else {
                            this.loadLocalData();
                        }
                    });
                } else {
                    // å¦‚æœFirebaseä¸å¯ç”¨ï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®
                    this.loadLocalData();
                    this.showAuthModal();
                }
            }

            // æ›´æ–°UIä»¥åæ˜ è®¤è¯çŠ¶æ€
            updateUIForAuthState(user) {
                const statusIndicator = $('#userStatus');
                const statusText = $('#userStatusText');
                const logoutBtn = $('#logoutBtn');
                const editBtn = $('#editProfileBtn');

                if (user) {
                    statusIndicator.className = 'w-3 h-3 bg-green-400 rounded-full';
                    statusText.textContent = 'å·²ç™»å½•';
                    logoutBtn.classList.remove('hidden');
                    editBtn.textContent = 'âœï¸ ç¼–è¾‘èµ„æ–™';
                } else {
                    statusIndicator.className = 'w-3 h-3 bg-gray-400 rounded-full';
                    statusText.textContent = 'æœªç™»å½•';
                    logoutBtn.classList.add('hidden');
                    editBtn.textContent = 'ğŸ”‘ ç™»å½•è´¦æˆ·';
                }
            }

            // æ˜¾ç¤ºè®¤è¯æ¨¡æ€æ¡†
            showAuthModal() {
                this.authModal.classList.remove('hidden');
                this.switchToLogin();
            }

            // éšè—è®¤è¯æ¨¡æ€æ¡†
            hideAuthModal() {
                this.authModal.classList.add('hidden');
            }

            // åˆ‡æ¢åˆ°ç™»å½•æ¨¡å¼
            switchToLogin() {
                this.isLoginMode = true;
                $('#authModalTitle').textContent = 'ç™»å½•è´¦æˆ·';
                $('#loginForm').classList.remove('hidden');
                $('#registerForm').classList.add('hidden');
                $('#switchAuthMode').textContent = 'è¿˜æ²¡æœ‰è´¦æˆ·ï¼Ÿç«‹å³æ³¨å†Œ';
            }

            // åˆ‡æ¢åˆ°æ³¨å†Œæ¨¡å¼
            switchToRegister() {
                this.isLoginMode = false;
                $('#authModalTitle').textContent = 'æ³¨å†Œè´¦æˆ·';
                $('#loginForm').classList.add('hidden');
                $('#registerForm').classList.remove('hidden');
                $('#switchAuthMode').textContent = 'å·²æœ‰è´¦æˆ·ï¼Ÿç«‹å³ç™»å½•';
            }

            // ç™»å½•
            async login(email, password) {
                try {
                    if (!auth) throw new Error('Firebaseæœªåˆå§‹åŒ–');

                    const result = await auth.signInWithEmailAndPassword(email, password);
                    this.hideAuthModal();
                    this.showSuccess('ç™»å½•æˆåŠŸï¼');
                    return result.user;
                } catch (error) {
                    this.showError('ç™»å½•å¤±è´¥: ' + error.message);
                    throw error;
                }
            }

            // æ³¨å†Œ
            async register(email, password, displayName) {
                try {
                    if (!auth) throw new Error('Firebaseæœªåˆå§‹åŒ–');

                    const result = await auth.createUserWithEmailAndPassword(email, password);

                    // æ›´æ–°ç”¨æˆ·æ˜¾ç¤ºå
                    await result.user.updateProfile({
                        displayName: displayName
                    });

                    // åˆ›å»ºç”¨æˆ·æ•°æ®
                    await this.createUserData(result.user.uid, displayName);

                    this.hideAuthModal();
                    this.showSuccess('æ³¨å†ŒæˆåŠŸï¼');
                    return result.user;
                } catch (error) {
                    this.showError('æ³¨å†Œå¤±è´¥: ' + error.message);
                    throw error;
                }
            }

            // é€€å‡ºç™»å½•
            async logout() {
                try {
                    if (auth) {
                        await auth.signOut();
                    }
                    this.showSuccess('å·²é€€å‡ºç™»å½•');
                } catch (error) {
                    this.showError('é€€å‡ºå¤±è´¥: ' + error.message);
                }
            }

            // åˆ›å»ºç”¨æˆ·æ•°æ®
            async createUserData(uid, displayName) {
                if (!db) return;

                const newUserData = {
                    ...userData,
                    uid: uid,
                    name: displayName,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                try {
                    await db.collection('users').doc(uid).set(newUserData);
                    userData = newUserData;
                } catch (error) {
                    console.error('åˆ›å»ºç”¨æˆ·æ•°æ®å¤±è´¥:', error);
                }
            }

            // åŠ è½½ç”¨æˆ·æ•°æ®
            async loadUserData(uid) {
                if (!db) return this.loadLocalData();

                try {
                    const doc = await db.collection('users').doc(uid).get();

                    if (doc.exists) {
                        userData = { ...userData, ...doc.data() };
                    } else {
                        // å¦‚æœç”¨æˆ·æ•°æ®ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°çš„
                        await this.createUserData(uid, currentUser.displayName || 'Labubuæ”¶é›†å®¶');
                    }

                    renderUserData();
                } catch (error) {
                    console.error('åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:', error);
                    this.loadLocalData();
                }
            }

            // åŠ è½½æœ¬åœ°æ•°æ®
            loadLocalData() {
                const savedData = localStorage.getItem('userData');
                if (savedData) {
                    userData = { ...userData, ...JSON.parse(savedData) };
                }
                renderUserData();
            }

            // ä¿å­˜ç”¨æˆ·æ•°æ®
            async saveUserData() {
                userData.updatedAt = new Date();

                // ä¿å­˜åˆ°æœ¬åœ°
                localStorage.setItem('userData', JSON.stringify(userData));

                // ä¿å­˜åˆ°äº‘ç«¯
                if (db && currentUser) {
                    try {
                        await db.collection('users').doc(currentUser.uid).update({
                            ...userData,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        this.showSuccess('æ•°æ®ä¿å­˜æˆåŠŸï¼');
                    } catch (error) {
                        console.error('ä¿å­˜åˆ°äº‘ç«¯å¤±è´¥:', error);
                        this.showSuccess('æ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°');
                    }
                } else {
                    this.showSuccess('æ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°');
                }
            }

            // ä¸Šä¼ å¤´åƒ
            async uploadAvatar(file) {
                if (!storage || !currentUser) {
                    // å¦‚æœæ²¡æœ‰Firebaseï¼Œä½¿ç”¨Base64å­˜å‚¨åˆ°æœ¬åœ°
                    return new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            userData.avatar = e.target.result;
                            resolve(e.target.result);
                        };
                        reader.readAsDataURL(file);
                    });
                }

                try {
                    const storageRef = storage.ref(`avatars/${currentUser.uid}`);
                    const snapshot = await storageRef.put(file);
                    const downloadURL = await snapshot.ref.getDownloadURL();

                    userData.avatar = downloadURL;
                    return downloadURL;
                } catch (error) {
                    console.error('å¤´åƒä¸Šä¼ å¤±è´¥:', error);
                    throw error;
                }
            }

            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            showSuccess(message) {
                this.showNotification(message, 'success');
            }

            // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
            showError(message) {
                this.showNotification(message, 'error');
            }

            // æ˜¾ç¤ºé€šçŸ¥
            showNotification(message, type = 'success') {
                const notification = document.createElement('div');
                const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
                notification.className = `fixed top-4 right-4 ${bgColor} text-white px-6 py-3 rounded-xl z-50 transform translate-x-full transition-transform duration-300`;
                notification.textContent = message;
                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.style.transform = 'translateX(0)';
                }, 100);

                setTimeout(() => {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (document.body.contains(notification)) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            }

            // åˆå§‹åŒ–è®¤è¯äº‹ä»¶ç›‘å¬
            initAuthListeners() {
                // å…³é—­è®¤è¯æ¨¡æ€æ¡†
                $('#closeAuthModal').addEventListener('click', () => {
                    this.hideAuthModal();
                });

                // åˆ‡æ¢ç™»å½•/æ³¨å†Œæ¨¡å¼
                $('#switchAuthMode').addEventListener('click', () => {
                    if (this.isLoginMode) {
                        this.switchToRegister();
                    } else {
                        this.switchToLogin();
                    }
                });

                // ç™»å½•è¡¨å•æäº¤
                $('#loginForm').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const email = $('#loginEmail').value;
                    const password = $('#loginPassword').value;

                    try {
                        await this.login(email, password);
                    } catch (error) {
                        console.error('ç™»å½•å¤±è´¥:', error);
                    }
                });

                // æ³¨å†Œè¡¨å•æäº¤
                $('#registerForm').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const name = $('#registerName').value;
                    const email = $('#registerEmail').value;
                    const password = $('#registerPassword').value;

                    try {
                        await this.register(email, password, name);
                    } catch (error) {
                        console.error('æ³¨å†Œå¤±è´¥:', error);
                    }
                });

                // é€€å‡ºç™»å½•
                $('#logoutBtn').addEventListener('click', () => {
                    if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                        this.logout();
                    }
                });
            }

            // åˆå§‹åŒ–ä¸ªäººèµ„æ–™äº‹ä»¶ç›‘å¬
            initProfileListeners() {
                // æ‰“å¼€ç¼–è¾‘èµ„æ–™æ¨¡æ€æ¡†
                $('#editProfileBtn').addEventListener('click', () => {
                    if (isLoggedIn) {
                        this.showEditProfileModal();
                    } else {
                        this.showAuthModal();
                    }
                });

                // å¤´åƒç‚¹å‡»ç¼–è¾‘
                $('#avatarContainer').addEventListener('click', () => {
                    if (isLoggedIn) {
                        this.showEditProfileModal();
                    } else {
                        this.showAuthModal();
                    }
                });

                // å…³é—­ç¼–è¾‘èµ„æ–™æ¨¡æ€æ¡†
                $('#closeProfileModal').addEventListener('click', () => {
                    this.hideEditProfileModal();
                });

                $('#cancelProfile').addEventListener('click', () => {
                    this.hideEditProfileModal();
                });

                // å¤´åƒä¸Šä¼ 
                $('#uploadAvatarBtn').addEventListener('click', () => {
                    $('#avatarUpload').click();
                });

                $('#avatarPreview').addEventListener('click', () => {
                    $('#avatarUpload').click();
                });

                $('#avatarUpload').addEventListener('change', async (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        await this.handleAvatarUpload(file);
                    }
                });

                // ä¸ªäººèµ„æ–™è¡¨å•æäº¤
                $('#profileForm').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    await this.handleProfileUpdate();
                });
            }

            // æ˜¾ç¤ºç¼–è¾‘èµ„æ–™æ¨¡æ€æ¡†
            showEditProfileModal() {
                // å¡«å……å½“å‰æ•°æ®
                $('#profileName').value = userData.name;
                $('#profileBio').value = userData.bio || '';
                $('#profileSignature').value = userData.signature || '';
                $('#profileBirthday').value = userData.birthday || '';

                // è®¾ç½®å¤´åƒé¢„è§ˆ
                this.updateAvatarPreview(userData.avatar);

                this.editProfileModal.classList.remove('hidden');
            }

            // éšè—ç¼–è¾‘èµ„æ–™æ¨¡æ€æ¡†
            hideEditProfileModal() {
                this.editProfileModal.classList.add('hidden');
            }

            // å¤„ç†å¤´åƒä¸Šä¼ 
            async handleAvatarUpload(file) {
                if (file.size > 2 * 1024 * 1024) {
                    this.showError('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡2MB');
                    return;
                }

                try {
                    const avatarUrl = await this.uploadAvatar(file);
                    this.updateAvatarPreview(avatarUrl);
                    this.showSuccess('å¤´åƒä¸Šä¼ æˆåŠŸï¼');
                } catch (error) {
                    this.showError('å¤´åƒä¸Šä¼ å¤±è´¥: ' + error.message);
                }
            }

            // æ›´æ–°å¤´åƒé¢„è§ˆ
            updateAvatarPreview(avatarUrl) {
                const preview = $('#avatarPreview');
                const userAvatar = $('#userAvatar');

                if (avatarUrl) {
                    const img = `<img src="${avatarUrl}" alt="å¤´åƒ" class="w-full h-full object-cover">`;
                    preview.innerHTML = img;
                    userAvatar.innerHTML = img;
                } else {
                    preview.innerHTML = 'ğŸ§¸';
                    userAvatar.innerHTML = 'ğŸ§¸';
                }
            }

            // å¤„ç†ä¸ªäººèµ„æ–™æ›´æ–°
            async handleProfileUpdate() {
                userData.name = $('#profileName').value;
                userData.bio = $('#profileBio').value;
                userData.signature = $('#profileSignature').value;
                userData.birthday = $('#profileBirthday').value;

                try {
                    await this.saveUserData();
                    renderUserData();
                    this.hideEditProfileModal();
                } catch (error) {
                    this.showError('ä¿å­˜å¤±è´¥: ' + error.message);
                }
            }
        }

        // åˆ›å»ºç”¨æˆ·ç®¡ç†å®ä¾‹
        const userManager = new UserManager();

        // åˆå§‹åŒ–
        function init() {
            renderUserData();
            renderAchievements();
            renderCollection();
            renderRecentPrizes();
            renderCalendar();
            initEventListeners();
            initCustomCursor();
        }

        // æ¸²æŸ“ç”¨æˆ·æ•°æ®
        function renderUserData() {
            $('#userName').textContent = userData.name;
            $('#userLevel').textContent = userData.level;
            $('#joinDays').textContent = userData.joinDays;
            $('#totalDraws').textContent = userData.totalDraws;
            $('#totalPrizes').textContent = userData.totalPrizes;
            $('#rarityScore').textContent = userData.rarityScore.toLocaleString();
            $('#streakDays').textContent = userData.streakDays + 'å¤©';
            $('#luckyRate').textContent = userData.luckyRate + '%';
            $('#expNeeded').textContent = `${userData.exp}/${userData.maxExp} EXP`;

            // æ›´æ–°è¿›åº¦æ¡
            const progressBar = $('.level-progress');
            progressBar.style.width = (userData.exp / userData.maxExp * 100) + '%';

            // æ›´æ–°å¤´åƒæ˜¾ç¤º
            userManager.updateAvatarPreview(userData.avatar);
        }

        // æ¸²æŸ“æˆå°±
        function renderAchievements() {
            const grid = $('#achievementGrid');
            const unlockedCount = achievements.filter(a => a.unlocked).length;

            $('#achievementCount').textContent = `${unlockedCount}/${achievements.length} å·²è§£é”`;

            grid.innerHTML = achievements.map(achievement => `
                <div class="achievement-badge ${achievement.unlocked ? 'achievement-unlocked' : 'achievement-locked'} 
                           w-16 h-16 rounded-2xl flex flex-col items-center justify-center text-center p-2"
                     title="${achievement.name}: ${achievement.description}">
                    <div class="text-2xl">${achievement.icon}</div>
                    <div class="text-xs font-medium mt-1">${achievement.name}</div>
                </div>
            `).join('');
        }

        // æ¸²æŸ“æ”¶è—å†Œ
        function renderCollection() {
            const grid = $('#collectionGrid');
            const ownedCount = collections.filter(c => c.owned).length;

            $('#collectionCount').textContent = `${ownedCount}/${collections.length} å·²æ”¶é›†`;

            grid.innerHTML = collections.map(item => `
                <div class="collection-item ${item.owned ? 'owned' : 'not-owned'} 
                           bg-slate-50 rounded-xl p-3 text-center border ${getRarityBorder(item.rarity)}"
                     title="${item.name} - ${getRarityName(item.rarity)}">
                    <div class="text-3xl mb-1">${item.emoji}</div>
                    <div class="text-xs font-medium">${item.name}</div>
                    <div class="text-xs text-slate-500 mt-1">${getRarityName(item.rarity)}</div>
                </div>
            `).join('');
        }

        // è·å–ç¨€æœ‰åº¦åç§°
        function getRarityName(rarity) {
            const names = {
                'common': 'æ™®é€š',
                'rare': 'ç¨€æœ‰',
                'epic': 'å²è¯—',
                'legendary': 'ä¼ è¯´',
                'mythic': 'ç¥è¯'
            };
            return names[rarity] || 'æœªçŸ¥';
        }

        // è·å–ç¨€æœ‰åº¦è¾¹æ¡†
        function getRarityBorder(rarity) {
            const borders = {
                'common': 'border-slate-300',
                'rare': 'border-blue-400',
                'epic': 'border-purple-400',
                'legendary': 'border-yellow-400',
                'mythic': 'border-red-400'
            };
            return borders[rarity] || 'border-slate-300';
        }

        // æ¸²æŸ“æœ€è¿‘å¥–å“
        function renderRecentPrizes() {
            const container = $('#recentPrizes');

            container.innerHTML = recentPrizes.map(prize => `
                <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl">
                    <div class="text-2xl">${prize.emoji}</div>
                    <div class="flex-1">
                        <div class="font-medium">${prize.name}</div>
                        <div class="text-sm text-slate-500">${getRarityName(prize.rarity)} â€¢ ${prize.time}</div>
                    </div>
                </div>
            `).join('');
        }

        // æ¸²æŸ“ç­¾åˆ°æ—¥å†
        function renderCalendar() {
            const grid = $('#calendarGrid');
            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const firstDay = new Date(year, month, 1).getDay();

            // è·å–ç­¾åˆ°è®°å½•
            const checkinHistory = JSON.parse(localStorage.getItem('checkinHistory') || '{}');
            const todayString = today.toDateString();
            const lastCheckin = localStorage.getItem('lastCheckin');

            let html = '';
            let signedCount = 0;

            // å¡«å……ç©ºç™½æ—¥æœŸ
            for (let i = 0; i < firstDay; i++) {
                html += '<div></div>';
            }

            // å¡«å……å®é™…æ—¥æœŸ
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateString = date.toDateString();
                const isToday = day === today.getDate();
                const isSigned = checkinHistory[dateString] || (dateString === lastCheckin);

                if (isSigned) signedCount++;

                html += `
                    <div class="calendar-day w-8 h-8 rounded-lg flex items-center justify-center text-sm font-medium
                               ${isToday ? 'today' : ''} ${isSigned ? 'signed' : 'bg-slate-100'}">
                        ${day}
                    </div>
                `;
            }

            grid.innerHTML = html;

            // æ›´æ–°ç­¾åˆ°ç»Ÿè®¡
            $('#monthlyCheckins').textContent = signedCount;
        }

        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
        function initEventListeners() {
            // æ¯æ—¥ç­¾åˆ°æŒ‰é’®
            $('#dailyCheckinBtn').addEventListener('click', () => {
                performDailyCheckin();
            });

            // å¿«é€Ÿæ“ä½œæŒ‰é’®
            $$('.enhanced-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (btn.textContent.includes('ç«‹å³æŠ½å¥–')) {
                        window.location.href = 'index.html#draw';
                    } else if (btn.textContent.includes('å‰å¾€å•†åŸ')) {
                        window.location.href = 'shop.html';
                    } else if (btn.textContent.includes('æŸ¥çœ‹ä»»åŠ¡')) {
                        window.location.href = 'tasks.html';
                    } else if (btn.textContent.includes('å°æ¸¸æˆ')) {
                        window.location.href = 'games.html';
                    }
                });
            });

            // æˆå°±æ‚¬æµ®æ•ˆæœ
            $$('.achievement-badge').forEach(badge => {
                badge.addEventListener('mouseenter', () => {
                    createMagicParticles(badge.getBoundingClientRect().left + 32, badge.getBoundingClientRect().top + 32);
                });
            });
        }

        // æ‰§è¡Œæ¯æ—¥ç­¾åˆ°
        async function performDailyCheckin() {
            // æ£€æŸ¥ä»Šæ—¥æ˜¯å¦å·²ç­¾åˆ°
            const today = new Date().toDateString();
            const lastCheckin = localStorage.getItem('lastCheckin');

            if (lastCheckin === today) {
                userManager.showError('ä»Šæ—¥å·²ç­¾åˆ°ï¼Œè¯·æ˜å¤©å†æ¥ï¼');
                return;
            }

            // æ›´æ–°ç”¨æˆ·ç»éªŒ
            userData.exp += 10;
            userData.streakDays += 1;

            let leveledUp = false;
            if (userData.exp >= userData.maxExp) {
                userData.level++;
                userData.exp = userData.exp - userData.maxExp;
                userData.maxExp = Math.floor(userData.maxExp * 1.2);
                leveledUp = true;
            }

            // ä¿å­˜ç­¾åˆ°è®°å½•
            localStorage.setItem('lastCheckin', today);

            // ä¿å­˜åˆ°ç­¾åˆ°å†å²
            const checkinHistory = JSON.parse(localStorage.getItem('checkinHistory') || '{}');
            checkinHistory[today] = true;
            localStorage.setItem('checkinHistory', JSON.stringify(checkinHistory));

            // ä¿å­˜ç”¨æˆ·æ•°æ®
            try {
                await userManager.saveUserData();
            } catch (error) {
                console.error('ä¿å­˜ç­¾åˆ°æ•°æ®å¤±è´¥:', error);
            }

            // æ˜¾ç¤ºç­¾åˆ°æˆåŠŸæç¤º
            userManager.showSuccess('âœ… ç­¾åˆ°æˆåŠŸï¼è·å¾— 10 EXP');

            // å¦‚æœå‡çº§äº†ï¼Œæ˜¾ç¤ºå‡çº§æç¤º
            if (leveledUp) {
                setTimeout(() => {
                    const levelUp = document.createElement('div');
                    levelUp.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
                    levelUp.innerHTML = `
                        <div class="bg-white rounded-3xl p-8 text-center animate-bounce">
                            <div class="text-6xl mb-4">ğŸ‰</div>
                            <div class="text-2xl font-bold text-[var(--labu)] mb-2">æ­å–œå‡çº§ï¼</div>
                            <div class="text-lg">æ‚¨ç°åœ¨æ˜¯ Lv.${userData.level} äº†ï¼</div>
                        </div>
                    `;
                    document.body.appendChild(levelUp);

                    setTimeout(() => {
                        if (document.body.contains(levelUp)) {
                            document.body.removeChild(levelUp);
                        }
                    }, 3000);
                }, 1000);
            }

            renderUserData();
            renderCalendar(); // é‡æ–°æ¸²æŸ“æ—¥å†ä»¥æ˜¾ç¤ºä»Šæ—¥ç­¾åˆ°
        }

        // è‡ªå®šä¹‰é¼ æ ‡æ•ˆæœ
        function initCustomCursor() {
            const cursor = $('.custom-cursor');
            let mouseX = 0, mouseY = 0;

            document.addEventListener('mousemove', (e) => {
                mouseX = e.clientX;
                mouseY = e.clientY;
                cursor.style.left = mouseX + 'px';
                cursor.style.top = mouseY + 'px';

                createCursorTrail(mouseX, mouseY);
            });

            document.addEventListener('mousedown', () => {
                cursor.classList.add('clicking');
            });

            document.addEventListener('mouseup', () => {
                cursor.classList.remove('clicking');
            });
        }

        function createCursorTrail(x, y) {
            const trail = document.createElement('div');
            trail.className = 'cursor-trail';
            trail.style.left = (x - 4) + 'px';
            trail.style.top = (y - 4) + 'px';
            document.body.appendChild(trail);

            setTimeout(() => {
                if (document.body.contains(trail)) {
                    document.body.removeChild(trail);
                }
            }, 500);
        }

        function createMagicParticles(x, y) {
            for (let i = 0; i < 6; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'magic-particle';
                    particle.style.left = (x + Math.random() * 40 - 20) + 'px';
                    particle.style.top = (y + Math.random() * 40 - 20) + 'px';
                    document.body.appendChild(particle);

                    setTimeout(() => {
                        if (document.body.contains(particle)) {
                            document.body.removeChild(particle);
                        }
                    }, 2000);
                }, i * 50);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>