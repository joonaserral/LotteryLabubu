# 📱 手机验证码登录使用指南

## 🎯 功能概述

现在您的Labubu抽奖网站已经集成了完整的手机验证码登录系统，用户可以通过手机号验证身份，并将所有抽奖数据同步到云端！

---

## ✨ 主要功能

### 🔐 **手机验证码登录**
- **支持多国家/地区**：中国大陆(+86)、美国(+1)、英国(+44)、日本(+81)、韩国(+82)
- **安全验证**：Google reCAPTCHA + 短信验证码双重验证
- **智能验证**：手机号格式自动检查，错误提示详细

### ☁️ **云端数据同步**
- **自动备份**：登录后自动将本地数据上传到云端
- **智能合并**：云端和本地数据智能合并，保留最完整的记录
- **实时同步**：数据变更时自动同步到云端

### 📊 **同步的数据类型**
- 🎯 **抽奖历史记录**
- 🏆 **用户积分**
- 🎁 **收藏品记录**
- 🛒 **兑换记录**
- ⚙️ **用户设置**（音效、音量等）
- 📈 **抽奖次数统计**

---

## 🚀 使用方法

### 1️⃣ **开始登录**
1. 打开网站后，在左上角找到用户状态面板
2. 点击 **⚙️ 设置按钮**
3. 选择 **📱 手机登录**

### 2️⃣ **输入手机号**
1. 选择正确的国家/地区代码
2. 输入有效的手机号码
3. 完成 reCAPTCHA 验证
4. 点击 **📤 发送验证码**

### 3️⃣ **验证码确认**
1. 查收手机短信验证码（6位数字）
2. 在输入框中输入验证码
3. 点击 **✅ 验证登录**
4. 等待登录成功提示

### 4️⃣ **数据同步**
- 登录成功后，系统会自动：
  - 📥 下载云端数据
  - 🔄 合并本地和云端数据
  - 📤 上传最新数据到云端
  - ✅ 显示同步完成

---

## 🎮 界面说明

### 📍 **用户状态面板**（左上角）
- **未登录状态**：显示紫色头像 👤，"未登录"
- **已登录状态**：显示绿色头像 ✅，脱敏手机号

### 🎛️ **用户菜单选项**
- **📱 手机登录**：打开登录窗口
- **☁️ 同步数据**：手动同步数据到云端
- **🚪 退出登录**：安全退出当前账户

### 🔔 **状态通知**
系统会通过右上角通知显示各种状态：
- ✅ **成功**：绿色通知（登录成功、同步完成等）
- ℹ️ **信息**：蓝色通知（正在发送验证码、正在同步等）
- ❌ **错误**：红色通知（验证码错误、网络问题等）

---

## 🛡️ 安全特性

### 🔒 **数据安全**
- **Firebase Authentication**：谷歌级别的安全认证
- **Firestore 数据库**：企业级云数据库，数据加密存储
- **手机号脱敏**：界面显示中隐藏部分数字保护隐私

### 🚫 **防滥用机制**
- **频率限制**：防止短时间内多次发送验证码
- **reCAPTCHA**：防止机器人攻击
- **错误重试**：验证码错误有重试机制，但有次数限制

### 🔄 **数据完整性**
- **智能合并**：云端和本地数据冲突时，保留较新的数据
- **去重处理**：自动去除重复的抽奖记录
- **备份保护**：本地数据会在云端同步前保留副本

---

## 🐛 常见问题解决

### ❓ **收不到验证码**
1. 检查手机号是否正确
2. 检查手机信号和短信功能
3. 查看垃圾短信文件夹
4. 等待1-2分钟，有时会有延迟
5. 尝试点击"重新发送"

### ❓ **验证码错误**
1. 确保输入6位数字验证码
2. 检查验证码是否过期（通常5分钟有效）
3. 重新获取验证码
4. 确保没有多余的空格

### ❓ **登录后数据丢失**
1. 系统会自动合并数据，不会丢失
2. 云端数据下载可能需要几秒钟
3. 刷新页面查看是否恢复
4. 查看控制台日志了解同步状态

### ❓ **同步失败**
1. 检查网络连接
2. 确保已成功登录
3. 尝试手动点击"☁️ 同步数据"
4. 重新登录再次尝试

---

## 🔧 Firebase 配置说明

### 📋 **当前配置**
```javascript
const firebaseConfig = {
    apiKey: "AIzaSyAPUti6enwvI57jiOqE3kC9SMBG4GL2FfE",
    authDomain: "labubu-lottery.firebaseapp.com",
    projectId: "labubu-lottery",
    storageBucket: "labubu-lottery.appspot.com",
    messagingSenderId: "1040839447881",
    appId: "1:1040839447881:web:a25f503a3182e9b020b698"
};
```

### ⚠️ **注意事项**
1. **项目ID更正**：已将错误的项目ID修复为正确格式
2. **SDK版本**：使用Firebase v10.7.1，稳定可靠
3. **认证方法**：仅启用手机号认证，更安全
4. **数据库规则**：需要在Firebase控制台配置适当的安全规则

---

## 📈 数据结构说明

### 👤 **用户文档结构**
```javascript
{
  phoneNumber: "+86138****8888",        // 手机号
  history: [...],                      // 抽奖历史
  points: 150,                         // 用户积分
  drawCount: 5,                        // 抽奖次数
  collection: {...},                   // 收藏品
  exchanges: [...],                    // 兑换记录
  settings: {                          // 用户设置
    soundEnabled: true,
    musicVolume: "50"
  },
  lastUpdated: Timestamp              // 最后更新时间
}
```

---

## 🎉 完成！

您的手机验证码登录系统现在已经完全就绪！用户可以：

1. ✅ **安全登录**：手机验证码 + reCAPTCHA 双重验证
2. ☁️ **云端同步**：所有数据自动备份到云端
3. 📱 **跨设备使用**：在任何设备上登录都能获取数据
4. 🔒 **隐私保护**：手机号脱敏显示，数据加密存储
5. 🚀 **无缝体验**：登录后自动同步，无需手动操作

现在您的用户可以放心地使用抽奖系统，不用担心数据丢失，还能在多个设备间无缝切换！🎊